{"sha": "ca5af06a86cf85220edebc4bcc29a0302590d1db", "log": "Add better support for omitting filtered fields for position formats like CSV", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/databind/ser/BeanPropertyWriter.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ser/BeanPropertyWriter.java\n     }\n \n     /**\n+     * Method called to indicate that serialization of a field was omitted\n+     * due to filtering, in cases where backend data format does not allow\n+     * basic omission.\n+     * \n+     * @since 2.3\n+     */\n+    public void serializeAsOmittedField(Object bean, JsonGenerator jgen, SerializerProvider prov)\n+        throws Exception\n+    {\n+        if (!jgen.canOmitFields()) {\n+            jgen.writeOmittedField(_name.getValue());\n+        }\n+    }\n+    \n+    /**\n      * Alternative to {@link #serializeAsField} that is used when a POJO\n      * is serialized as JSON Array; the difference is that no field names\n      * are written.\n--- a/src/main/java/com/fasterxml/jackson/databind/ser/impl/FilteredBeanPropertyWriter.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ser/impl/FilteredBeanPropertyWriter.java\n             Class<?> activeView = prov.getActiveView();\n             if (activeView == null || _view.isAssignableFrom(activeView)) {\n                 _delegate.serializeAsField(bean, jgen, prov);\n+            } else {\n+                _delegate.serializeAsOmittedField(bean, jgen, prov);\n             }\n         }\n \n                 }\n                 // not included, bail out:\n                 if (i == len) {\n+                    _delegate.serializeAsOmittedField(bean, jgen, prov);\n                     return;\n                 }\n             }\n--- a/src/main/java/com/fasterxml/jackson/databind/ser/impl/SimpleBeanPropertyFilter.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ser/impl/SimpleBeanPropertyFilter.java\n         if (include(writer)) {\n             writer.serializeAsField(bean, jgen, provider);\n         } else if (!jgen.canOmitFields()) { // since 2.3\n-            writer.serializeAsPlaceholder(bean, jgen, provider);\n+            writer.serializeAsOmittedField(bean, jgen, provider);\n         }\n     }\n ", "timestamp": 1376186049, "metainfo": ""}