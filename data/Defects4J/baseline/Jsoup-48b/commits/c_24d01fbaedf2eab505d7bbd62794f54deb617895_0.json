{"sha": "24d01fbaedf2eab505d7bbd62794f54deb617895", "log": "Merge pull request #479 from hannibal218bc/fix-element-classnames  Element.classNames() must not be cached", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Element.java\n+++ b/src/main/java/org/jsoup/nodes/Element.java\n  */\n public class Element extends Node {\n     private Tag tag;\n-    private Set<String> classNames;\n-    \n     /**\n      * Create a new, standalone Element. (Standalone in that is has no parent.)\n      * \n      * @return set of classnames, empty if no class attribute\n      */\n     public Set<String> classNames() {\n-        if (classNames == null) {\n-            String[] names = className().split(\"\\\\s+\");\n-            classNames = new LinkedHashSet<String>(Arrays.asList(names));\n-            classNames.remove(\"\"); // if classNames() was empty, would include an empty class\n-        }\n+    \tString[] names = className().split(\"\\\\s+\");\n+    \tSet<String> classNames = new LinkedHashSet<String>(Arrays.asList(names));\n+    \tclassNames.remove(\"\"); // if classNames() was empty, would include an empty class\n+\n         return classNames;\n     }\n \n     @Override\n     public Element clone() {\n         Element clone = (Element) super.clone();\n-        clone.classNames = null; // derived on first hit, otherwise gets a pointer to source classnames\n         return clone;\n     }\n }\n--- a/src/test/java/org/jsoup/nodes/ElementTest.java\n+++ b/src/test/java/org/jsoup/nodes/ElementTest.java\n import static org.junit.Assert.*;\n \n import java.util.ArrayList;\n+import java.util.LinkedHashSet;\n import java.util.List;\n import java.util.Set;\n import java.util.Map;\n         assertTrue(divC == doc.select(divC.cssSelector()).first());\n     }\n \n+\n+    @Test\n+    public void testClassNames() {\n+        Document doc = Jsoup.parse(\"<div class=\\\"c1 c2\\\">C</div>\");\n+        Element div = doc.select(\"div\").get(0);\n+\n+        assertEquals(\"c1 c2\", div.className());\n+\n+        final Set<String> set1 = div.classNames();\n+        final Object[] arr1 = set1.toArray();\n+        assertTrue(arr1.length==2);\n+        assertEquals(\"c1\", arr1[0]);\n+        assertEquals(\"c2\", arr1[1]);\n+\n+        // Changes to the set should not be reflected in the Elements getters\n+       \tset1.add(\"c3\");\n+        assertTrue(2==div.classNames().size());\n+        assertEquals(\"c1 c2\", div.className());\n+\n+        // Update the class names to a fresh set\n+        final Set<String> newSet = new LinkedHashSet<String>(3);\n+        newSet.addAll(set1);\n+        newSet.add(\"c3\");\n+        \n+        div.classNames(newSet);\n+\n+        \n+        assertEquals(\"c1 c2 c3\", div.className());\n+\n+        final Set<String> set2 = div.classNames();\n+        final Object[] arr2 = set2.toArray();\n+        assertTrue(arr2.length==3);\n+        assertEquals(\"c1\", arr2[0]);\n+        assertEquals(\"c2\", arr2[1]);\n+        assertEquals(\"c3\", arr2[2]);\n+    }\n }", "timestamp": 1413679095, "metainfo": ""}