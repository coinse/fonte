{"sha": "b43f0c52ad5d3dc161efd24e5df13788971a9950", "log": "Start implementing support for unwrapped Lists, serialization works", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/XmlBeanSerializerModifier.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/XmlBeanSerializerModifier.java\n \n                 QName wrappedName = new QName(ns, bpw.getName());\n                 QName wrapperName = AnnotationUtil.findWrapperName(intr, member);\n+                \n                 if (wrapperName != null) {\n                     localName = wrapperName.getLocalPart();\n                     wrapperNs = wrapperName.getNamespaceURI();\n                 }\n-                /* Empty/missing localName means \"use property name as wrapper\"; later on\n-                 * should probably make missing (null) mean \"don't add a wrapper\"\n+                /* 21-Aug-2012, tatu: Missing localName means \"use property name as wrapper\",\n+                 *   empty \"no wrapper\"\n                  */\n-                if (localName == null || localName.length() == 0) {\n+                if (localName == null) {\n                     wrapperName = wrappedName;\n+                } else if (localName.length() == 0) {\n+                    // Empty wrapper name is explicit \"DO NOT wrap\" Lists indicator, so:\n+                    continue;\n                 } else {\n                     wrapperName = new QName((wrapperNs == null) ? \"\" : wrapperNs, localName);\n                 }\n--- /dev/null\n+++ b/src/test/java/com/fasterxml/jackson/dataformat/xml/failing/TestUnwrappedLists.java\n+package com.fasterxml.jackson.dataformat.xml.failing;\n+\n+import java.io.*;\n+\n+import javax.xml.bind.JAXBContext;\n+import javax.xml.bind.Marshaller;\n+import javax.xml.bind.annotation.*;\n+\n+import com.fasterxml.jackson.annotation.JsonRootName;\n+import com.fasterxml.jackson.dataformat.xml.XmlMapper;\n+import com.fasterxml.jackson.dataformat.xml.XmlTestBase;\n+import com.fasterxml.jackson.dataformat.xml.annotation.*;\n+\n+public class TestUnwrappedLists extends XmlTestBase\n+{\n+    static class Value {\n+        public String v;\n+\n+        public Value() { }\n+        public Value(String str) { v = str; }\n+    }\n+\n+    @XmlRootElement(name=\"list\")\n+    @JsonRootName(\"list\")\n+    static class WrappedList {\n+        @XmlElementWrapper(name=\"WRAP\")\n+        @JacksonXmlElementWrapper(localName = \"WRAP\")\n+        public Value[] value;\n+    }\n+\n+    @XmlRootElement(name=\"list\")\n+    @JsonRootName(\"list\")\n+    static class UnwrappedList {\n+//        @XmlElementWrapper(name=\"\")\n+        @JacksonXmlElementWrapper(localName = \"\")\n+        public Value[] value;\n+    }\n+    \n+    /*\n+    /**********************************************************************\n+    /* Unit tests\n+    /**********************************************************************\n+     */\n+\n+    public void testWrappedLists() throws Exception\n+    {\n+        XmlMapper mapper = new XmlMapper();\n+        WrappedList list = new WrappedList();\n+        list.value = new Value[] { new Value(\"a\"), new Value(\"b\") };\n+\n+        String json = mapper.writeValueAsString(list);\n+        \n+        System.out.println(\"Wrapped   == \"+json);\n+        \n+//      withJAXB(list);\n+\n+        assertEquals(\"<list><WRAP><value><v>a</v></value><value><v>b</v></value></WRAP></list>\", json);\n+    }\n+    \n+    public void testUnwrappedLists() throws Exception\n+    {\n+        XmlMapper mapper = new XmlMapper();\n+        UnwrappedList list = new UnwrappedList();\n+        list.value = new Value[] { new Value(\"c\"), new Value(\"d\") };\n+\n+        String json = mapper.writeValueAsString(list);\n+        \n+        System.out.println(\"Unwrapped == \"+json);\n+\n+//        withJAXB(list);\n+        \n+        assertEquals(\"<list><value><v>c</v></value><value><v>d</v></value></list>\", json);\n+    }\n+\n+    void withJAXB(Object ob) throws Exception\n+    {\n+        JAXBContext jc = JAXBContext.newInstance(ob.getClass());\n+        Marshaller m = jc.createMarshaller();\n+        System.out.print(\"JAXB      -> \");\n+        StringWriter sw = new StringWriter();\n+        m.marshal(ob, sw);\n+        String xml = sw.toString();\n+        if (xml.indexOf(\"<?xml\") == 0) {\n+            xml = xml.substring(xml.indexOf(\"?>\")+2);\n+        }\n+        System.out.println(xml);\n+    }\n+}", "timestamp": 1345607254, "metainfo": ""}