{"sha": "a025d87deb9cc4cda49ae1b77feb0f29805dd7c5", "log": "Escape < in XML attributes  Fixes #528", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Entities.java\n+++ b/src/main/java/org/jsoup/nodes/Entities.java\n                             accum.append(\"&#xa0;\");\n                         break;\n                     case '<':\n-                        if (!inAttribute)\n+                        // escape when in character data or when in a xml attribue val; not needed in html attr val\n+                        if (!inAttribute || escapeMode == EscapeMode.xhtml)\n                             accum.append(\"&lt;\");\n                         else\n                             accum.append(c);\n--- a/src/test/java/org/jsoup/nodes/EntitiesTest.java\n+++ b/src/test/java/org/jsoup/nodes/EntitiesTest.java\n         String escapedAscii = Entities.escape(text, new OutputSettings().charset(\"ascii\").escapeMode(base));\n         String escapedAsciiFull = Entities.escape(text, new OutputSettings().charset(\"ascii\").escapeMode(extended));\n         String escapedAsciiXhtml = Entities.escape(text, new OutputSettings().charset(\"ascii\").escapeMode(xhtml));\n-        String escapedUtfFull = Entities.escape(text, new OutputSettings().charset(\"UTF-8\").escapeMode(base));\n+        String escapedUtfFull = Entities.escape(text, new OutputSettings().charset(\"UTF-8\").escapeMode(extended));\n         String escapedUtfMin = Entities.escape(text, new OutputSettings().charset(\"UTF-8\").escapeMode(xhtml));\n \n         assertEquals(\"Hello &amp;&lt;&gt; &Aring; &aring; &#x3c0; &#x65b0; there &frac34; &copy; &raquo;\", escapedAscii);\n         String string = \"http://www.foo.com?a=1&num_rooms=1&children=0&int=VA&b=2\";\n         assertEquals(string, Entities.unescape(string));\n     }\n+\n+    @Test public void escapesGtInXmlAttributesButNotInHtml() {\n+        // https://github.com/jhy/jsoup/issues/528 - < is OK in HTML attribute values, but not in XML\n+\n+\n+        String docHtml = \"<a title='<p>One</p>'>One</a>\";\n+        Document doc = Jsoup.parse(docHtml);\n+        Element element = doc.select(\"a\").first();\n+\n+        doc.outputSettings().escapeMode(base);\n+        assertEquals(\"<a title=\\\"<p>One</p>\\\">One</a>\", element.outerHtml());\n+\n+        doc.outputSettings().escapeMode(xhtml);\n+        assertEquals(\"<a title=\\\"&lt;p>One&lt;/p>\\\">One</a>\", element.outerHtml());\n+    }\n }", "timestamp": 1436854281, "metainfo": ""}