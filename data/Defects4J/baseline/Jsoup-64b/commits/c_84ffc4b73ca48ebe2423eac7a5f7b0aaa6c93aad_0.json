{"sha": "84ffc4b73ca48ebe2423eac7a5f7b0aaa6c93aad", "log": "Don't override request content-type if set  Fixes #756", "commit": "\n--- a/src/main/java/org/jsoup/helper/HttpConnection.java\n+++ b/src/main/java/org/jsoup/helper/HttpConnection.java\n \n         private static String setOutputContentType(final Connection.Request req) {\n             String bound = null;\n-            if (needsMultipart(req)) {\n+            if (req.hasHeader(CONTENT_TYPE)) {\n+                // no-op; don't add content type as already set (e.g. for requestBody())\n+                // todo - if content type already set, we could add charset or boundary if those aren't included\n+            }\n+            else if (needsMultipart(req)) {\n                 bound = DataUtil.mimeBoundary();\n                 req.header(CONTENT_TYPE, MULTIPART_FORM_DATA + \"; boundary=\" + bound);\n             } else {\n--- a/src/test/java/org/jsoup/integration/UrlConnectTest.java\n+++ b/src/test/java/org/jsoup/integration/UrlConnectTest.java\n     }\n \n     @Test\n+    public void sendsRequestBodyJsonWithData() throws IOException {\n+        final String body = \"{key:value}\";\n+        Document doc = Jsoup.connect(echoURL)\n+            .requestBody(body)\n+            .header(\"Content-Type\", \"application/json\")\n+            .userAgent(browserUa)\n+            .data(\"foo\", \"true\")\n+            .post();\n+        assertEquals(\"POST\", ihVal(\"REQUEST_METHOD\", doc));\n+        assertEquals(\"application/json\", ihVal(\"CONTENT_TYPE\", doc));\n+        assertEquals(\"foo=true\", ihVal(\"QUERY_STRING\", doc));\n+        assertEquals(body, doc.select(\"th:contains(POSTDATA) ~ td\").text());\n+    }\n+\n+    @Test\n+    public void sendsRequestBodyJsonWithoutData() throws IOException {\n+        final String body = \"{key:value}\";\n+        Document doc = Jsoup.connect(echoURL)\n+            .requestBody(body)\n+            .header(\"Content-Type\", \"application/json\")\n+            .userAgent(browserUa)\n+            .post();\n+        assertEquals(\"POST\", ihVal(\"REQUEST_METHOD\", doc));\n+        assertEquals(\"application/json\", ihVal(\"CONTENT_TYPE\", doc));\n+        assertEquals(body, doc.select(\"th:contains(POSTDATA) ~ td\").text());\n+    }\n+\n+    @Test\n     public void sendsRequestBody() throws IOException {\n         final String body = \"{key:value}\";\n         Document doc = Jsoup.connect(echoURL)\n             .userAgent(browserUa)\n             .post();\n         assertEquals(\"POST\", ihVal(\"REQUEST_METHOD\", doc));\n-        assertEquals(body, ihVal(\"keywords\", doc));\n+        assertEquals(\"text/plain\", ihVal(\"CONTENT_TYPE\", doc));\n+        assertEquals(body, doc.select(\"th:contains(POSTDATA) ~ td\").text());\n     }\n \n     @Test", "timestamp": 1472161061, "metainfo": ""}