{"sha": "35407bb1557e2ee11e27cff552d561b3d83266ae", "log": "1. add unit test to verify wok of disabling security 2. adjust class instance check", "commit": "\n--- a/src/main/java/org/jsoup/helper/HttpConnection.java\n+++ b/src/main/java/org/jsoup/helper/HttpConnection.java\n         private boolean ignoreHttpErrors = false;\n         private boolean ignoreContentType = false;\n         private Parser parser;\n+//      always default to secure connections in https\n         private boolean secure = true;\n \n         private Request() {\n             conn.setReadTimeout(req.timeout());\n             if (!req.isSecure()) {\n                 initUnSecureSSL();\n-                ( (HttpsURLConnection) conn ).setSSLSocketFactory(sslSocketFactory);\n+                if (conn instanceof HttpsURLConnection) {\n+                    ((HttpsURLConnection)conn).setSSLSocketFactory(sslSocketFactory);\n+                }\n             }\n             if (req.method() == Method.POST)\n                 conn.setDoOutput(true);\n             return conn;\n         }\n \n+        /**\n+         * Initialise Trust manager that does not validate certificate chains and\n+         * add it to current SSLContext.\n+         *\n+         * @throws IOException\n+         */\n         private static void initUnSecureSSL() throws IOException {\n             if ( sslSocketFactory == null) {\n                 // Create a trust manager that does not validate certificate chains\n--- a/src/test/java/org/jsoup/integration/UrlConnectTest.java\n+++ b/src/test/java/org/jsoup/integration/UrlConnectTest.java\n import org.jsoup.UnsupportedMimeTypeException;\n import org.junit.Test;\n import org.junit.Ignore;\n+\n+import static org.hamcrest.core.Is.is;\n import static org.junit.Assert.*;\n import org.jsoup.nodes.Document;\n import org.jsoup.Jsoup;\n  Tests the URL connection. Not enabled by default, so tests don't require network connection.\n \n  @author Jonathan Hedley, jonathan@hedley.net */\n-@Ignore // ignored by default so tests don't require network access. comment out to enable.\n+ // ignored by default so tests don't require network access. comment out to enable.\n public class UrlConnectTest {\n     private static String echoURL = \"http://direct.infohound.net/tools/q.pl\";\n \n         assertEquals(actualDocText, largeRes.parse().text().length());\n         assertEquals(actualDocText, unlimitedRes.parse().text().length());\n     }\n+\n+    @Test\n+    public void testUnsafe() throws Exception {\n+        String url = \"https://certs.cac.washington.edu/CAtest/\";\n+\n+        try {\n+            Connection.Response defaultRes = Jsoup.connect(url).execute();\n+        } catch (IOException e) {\n+//          that's expected exception\n+        }\n+        Connection.Response  defaultRes = Jsoup.connect(url).setSecure(false).execute();\n+        assertThat(defaultRes.statusCode(),is(200));\n+    }\n }", "timestamp": 1384156286, "metainfo": ""}