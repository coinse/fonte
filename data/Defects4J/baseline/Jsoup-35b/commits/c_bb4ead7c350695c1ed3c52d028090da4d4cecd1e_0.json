{"sha": "bb4ead7c350695c1ed3c52d028090da4d4cecd1e", "log": "Clean up the parse stack correctly when parsing data-nodes.  Fixes #22.", "commit": "\n--- a/src/main/java/org/jsoup/parser/Parser.java\n+++ b/src/main/java/org/jsoup/parser/Parser.java\n         } else {\n             tq.matchChomp(\">\");\n         }\n+        addChildToParent(child, isEmptyElement);\n \n         // pc data only tags (textarea, script): chomp to end tag, add content as text node\n         if (tag.isData()) {\n             String data = tq.chompTo(\"</\" + tagName);\n             tq.chompTo(\">\");\n+            popStackToClose(tag);\n             \n             Node dataNode;\n             if (tag.equals(titleTag) || tag.equals(textareaTag)) // want to show as text, but not contain inside tags (so not a data tag?)\n                 doc.setBaseUri(href); // set on the doc so doc.createElement(Tag) will get updated base\n             }\n         }\n-\n-        addChildToParent(child, isEmptyElement);\n     }\n \n     private Attribute parseAttribute() {\n--- a/src/test/java/org/jsoup/parser/ParserTest.java\n+++ b/src/test/java/org/jsoup/parser/ParserTest.java\n         assertEquals(\"Hello There\", doc.text());\n         assertEquals(\"Nope\", doc.data());\n     }\n+\n+    @Test public void handlesTextAfterData() {\n+        String h = \"<html><body>pre <script>inner</script> aft</body></html>\";\n+        Document doc = Jsoup.parse(h);\n+        assertEquals(\"<html><head></head><body>pre <script>inner</script> aft</body></html>\", TextUtil.stripNewlines(doc.html()));\n+    }\n     \n     @Test public void handlesTextArea() {\n         Document doc = Jsoup.parse(\"<textarea>Hello</textarea>\");", "timestamp": 1309605113, "metainfo": ""}