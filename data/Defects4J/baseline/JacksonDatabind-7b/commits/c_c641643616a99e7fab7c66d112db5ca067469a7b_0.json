{"sha": "c641643616a99e7fab7c66d112db5ca067469a7b", "log": "Merge fix for #259 from 2.2 branch", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/databind/ser/std/JsonValueSerializer.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ser/std/JsonValueSerializer.java\n     public JsonNode getSchema(SerializerProvider provider, Type typeHint)\n         throws JsonMappingException\n     {\n-        return (_valueSerializer instanceof SchemaAware) ?\n-                ((SchemaAware) _valueSerializer).getSchema(provider, null) :\n-                    com.fasterxml.jackson.databind.jsonschema.JsonSchema.getDefaultSchemaNode();\n+        if (_valueSerializer instanceof SchemaAware) {\n+            return ((SchemaAware)_valueSerializer).getSchema(provider, null);\n+        }\n+        return com.fasterxml.jackson.databind.jsonschema.JsonSchema.getDefaultSchemaNode();\n     }\n     \n     @Override\n     public void acceptJsonFormatVisitor(JsonFormatVisitorWrapper visitor, JavaType typeHint)\n         throws JsonMappingException\n     {\n-        if (_valueSerializer != null) {\n-            _valueSerializer.acceptJsonFormatVisitor(visitor, null); \n-        } else {\n-            visitor.expectAnyFormat(typeHint);\n-    \t}\n+        JsonSerializer<Object> ser = _valueSerializer;\n+        if (ser == null) {\n+            if (typeHint == null) {\n+                if (_property != null) {\n+                    typeHint = _property.getType();\n+                }\n+                if (typeHint == null) {\n+                    typeHint = visitor.getProvider().constructType(_accessorMethod.getReturnType());\n+                }\n+            }\n+            ser = visitor.getProvider().findTypedValueSerializer(typeHint, false, _property);\n+            if (ser == null) {\n+                visitor.expectAnyFormat(typeHint);\n+                return;\n+            }\n+        }\n+        ser.acceptJsonFormatVisitor(visitor, null); \n     }\n \n     protected boolean isNaturalTypeWithStdHandling(Class<?> rawType, JsonSerializer<?> ser)", "timestamp": 1373839792, "metainfo": ""}