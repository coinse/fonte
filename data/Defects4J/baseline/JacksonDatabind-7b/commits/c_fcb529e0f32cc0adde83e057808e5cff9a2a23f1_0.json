{"sha": "fcb529e0f32cc0adde83e057808e5cff9a2a23f1", "log": "Fix [JACKSON-845]", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\n         {\n             switch (_appliesFor) {\n             case NON_CONCRETE_AND_ARRAYS:\n-                if (t.isArrayType()) {\n+                while (t.isArrayType()) {\n                     t = t.getContentType();\n                 }\n                 // fall through\n             case OBJECT_AND_NON_CONCRETE:\n                 return (t.getRawClass() == Object.class) || !t.isConcrete();\n             case NON_FINAL:\n-                if (t.isArrayType()) {\n+                while (t.isArrayType()) {\n                     t = t.getContentType();\n                 }\n                 return !t.isFinal(); // includes Object.class\n--- a/src/test/java/com/fasterxml/jackson/databind/jsontype/TestDefaultForArrays.java\n+++ b/src/test/java/com/fasterxml/jackson/databind/jsontype/TestDefaultForArrays.java\n package com.fasterxml.jackson.databind.jsontype;\n \n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n import com.fasterxml.jackson.databind.*;\n import com.fasterxml.jackson.databind.ObjectMapper.DefaultTyping;\n \n         Object ob = result[0];\n         assertTrue(ob instanceof JsonNode);\n     }\n+\n+    // test for [JACKSON-845]\n+    public void testArraysOfArrays() throws Exception\n+    {\n+        ObjectMapper mapper = new ObjectMapper();\n+        mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);\n+\n+        Object value = new Object[][] { new Object[] {} };\n+        String json = mapper.writeValueAsString(value);\n+\n+        // try with different (but valid) nominal types:\n+        _testArraysAs(mapper, json, Object[][].class);\n+        _testArraysAs(mapper, json, Object[].class);\n+        _testArraysAs(mapper, json, Object.class);\n+    }\n+\n+    /*\n+    /**********************************************************\n+    /* Helper methods\n+    /**********************************************************\n+     */\n+    \n+    protected void _testArraysAs(ObjectMapper mapper, String json, Class<?> type)\n+        throws Exception\n+    {\n+        Object o = mapper.readValue(json, type);\n+        assertNotNull(o);\n+        assertTrue(o instanceof Object[]);\n+        Object[] main = (Object[]) o;\n+        assertEquals(1, main.length);\n+        Object element = main[0];\n+        assertNotNull(element);\n+        assertTrue(element instanceof Object[]);\n+        assertEquals(0, ((Object[]) element).length);\n+    }\n }", "timestamp": 1340927848, "metainfo": ""}