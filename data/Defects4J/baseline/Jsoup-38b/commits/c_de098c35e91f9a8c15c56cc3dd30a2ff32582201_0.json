{"sha": "de098c35e91f9a8c15c56cc3dd30a2ff32582201", "log": "Performance: reduced String[] allocations in Builder  Reduces GC load of tag searchers from 15% of objects to 2%. A little harder to read but worth it.", "commit": "\n--- a/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java\n+++ b/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java\n  * HTML Tree Builder; creates a DOM from Tokens.\n  */\n class HtmlTreeBuilder extends TreeBuilder {\n+    // tag searches\n+    private static final String[] TagsScriptStyle = new String[]{\"script\", \"style\"};\n+    public static final String[] TagsSearchInScope = new String[]{\"applet\", \"caption\", \"html\", \"table\", \"td\", \"th\", \"marquee\", \"object\"};\n+    private static final String[] TagSearchList = new String[]{\"ol\", \"ul\"};\n+    private static final String[] TagSearchButton = new String[]{\"button\"};\n+    private static final String[] TagSearchTableScope = new String[]{\"html\", \"table\"};\n+    private static final String[] TagSearchSelectScope = new String[]{\"optgroup\", \"option\"};\n+    private static final String[] TagSearchEndTags = new String[]{\"dd\", \"dt\", \"li\", \"option\", \"optgroup\", \"p\", \"rp\", \"rt\"};\n+    private static final String[] TagSearchSpecial = new String[]{\"address\", \"applet\", \"area\", \"article\", \"aside\", \"base\", \"basefont\", \"bgsound\",\n+            \"blockquote\", \"body\", \"br\", \"button\", \"caption\", \"center\", \"col\", \"colgroup\", \"command\", \"dd\",\n+            \"details\", \"dir\", \"div\", \"dl\", \"dt\", \"embed\", \"fieldset\", \"figcaption\", \"figure\", \"footer\", \"form\",\n+            \"frame\", \"frameset\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"head\", \"header\", \"hgroup\", \"hr\", \"html\",\n+            \"iframe\", \"img\", \"input\", \"isindex\", \"li\", \"link\", \"listing\", \"marquee\", \"menu\", \"meta\", \"nav\",\n+            \"noembed\", \"noframes\", \"noscript\", \"object\", \"ol\", \"p\", \"param\", \"plaintext\", \"pre\", \"script\",\n+            \"section\", \"select\", \"style\", \"summary\", \"table\", \"tbody\", \"td\", \"textarea\", \"tfoot\", \"th\", \"thead\",\n+            \"title\", \"tr\", \"ul\", \"wbr\", \"xmp\"};\n \n     private HtmlTreeBuilderState state; // the current state\n     private HtmlTreeBuilderState originalState; // original / marked state\n     void insert(Token.Character characterToken) {\n         Node node;\n         // characters in script and style go in as datanodes, not text nodes\n-        if (StringUtil.in(currentElement().tagName(), \"script\", \"style\"))\n+        if (StringUtil.in(currentElement().tagName(), TagsScriptStyle))\n             node = new DataNode(characterToken.getData(), baseUri);\n         else\n             node = new TextNode(characterToken.getData(), baseUri);\n     }\n \n     boolean inScope(String[] targetNames) {\n-        return inSpecificScope(targetNames, new String[]{\"applet\", \"caption\", \"html\", \"table\", \"td\", \"th\", \"marquee\", \"object\"}, null);\n+        return inSpecificScope(targetNames, TagsSearchInScope, null);\n     }\n \n     boolean inScope(String targetName) {\n     }\n \n     boolean inScope(String targetName, String[] extras) {\n-        return inSpecificScope(targetName, new String[]{\"applet\", \"caption\", \"html\", \"table\", \"td\", \"th\", \"marquee\", \"object\"}, extras);\n+        return inSpecificScope(targetName, TagsSearchInScope , extras);\n         // todo: in mathml namespace: mi, mo, mn, ms, mtext annotation-xml\n         // todo: in svg namespace: forignOjbect, desc, title\n     }\n \n     boolean inListItemScope(String targetName) {\n-        return inScope(targetName, new String[]{\"ol\", \"ul\"});\n+        return inScope(targetName, TagSearchList);\n     }\n \n     boolean inButtonScope(String targetName) {\n-        return inScope(targetName, new String[]{\"button\"});\n+        return inScope(targetName, TagSearchButton);\n     }\n \n     boolean inTableScope(String targetName) {\n-        return inSpecificScope(targetName, new String[]{\"html\", \"table\"}, null);\n+        return inSpecificScope(targetName, TagSearchTableScope, null);\n     }\n \n     boolean inSelectScope(String targetName) {\n             String elName = el.nodeName();\n             if (elName.equals(targetName))\n                 return true;\n-            if (!StringUtil.in(elName, \"optgroup\", \"option\")) // all elements except\n+            if (!StringUtil.in(elName, TagSearchSelectScope)) // all elements except\n                 return false;\n         }\n         Validate.fail(\"Should not be reachable\");\n      */\n     void generateImpliedEndTags(String excludeTag) {\n         while ((excludeTag != null && !currentElement().nodeName().equals(excludeTag)) &&\n-                StringUtil.in(currentElement().nodeName(), \"dd\", \"dt\", \"li\", \"option\", \"optgroup\", \"p\", \"rp\", \"rt\"))\n+                StringUtil.in(currentElement().nodeName(), TagSearchEndTags))\n             pop();\n     }\n \n         // todo: mathml's mi, mo, mn\n         // todo: svg's foreigObject, desc, title\n         String name = el.nodeName();\n-        return StringUtil.in(name, \"address\", \"applet\", \"area\", \"article\", \"aside\", \"base\", \"basefont\", \"bgsound\",\n-                \"blockquote\", \"body\", \"br\", \"button\", \"caption\", \"center\", \"col\", \"colgroup\", \"command\", \"dd\",\n-                \"details\", \"dir\", \"div\", \"dl\", \"dt\", \"embed\", \"fieldset\", \"figcaption\", \"figure\", \"footer\", \"form\",\n-                \"frame\", \"frameset\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"head\", \"header\", \"hgroup\", \"hr\", \"html\",\n-                \"iframe\", \"img\", \"input\", \"isindex\", \"li\", \"link\", \"listing\", \"marquee\", \"menu\", \"meta\", \"nav\",\n-                \"noembed\", \"noframes\", \"noscript\", \"object\", \"ol\", \"p\", \"param\", \"plaintext\", \"pre\", \"script\",\n-                \"section\", \"select\", \"style\", \"summary\", \"table\", \"tbody\", \"td\", \"textarea\", \"tfoot\", \"th\", \"thead\",\n-                \"title\", \"tr\", \"ul\", \"wbr\", \"xmp\");\n+        return StringUtil.in(name, TagSearchSpecial);\n     }\n \n     // active formatting elements", "timestamp": 1384117820, "metainfo": ""}