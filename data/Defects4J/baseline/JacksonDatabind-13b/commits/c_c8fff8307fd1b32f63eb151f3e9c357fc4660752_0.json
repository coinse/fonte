{"sha": "c8fff8307fd1b32f63eb151f3e9c357fc4660752", "log": "Merge pull request #74 from pgelinas/single-prop-pojo-as-array  Excellent!", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/databind/ser/impl/BeanAsArraySerializer.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ser/impl/BeanAsArraySerializer.java\n import com.fasterxml.jackson.core.JsonGenerator;\n import com.fasterxml.jackson.databind.JsonMappingException;\n import com.fasterxml.jackson.databind.JsonSerializer;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n import com.fasterxml.jackson.databind.SerializerProvider;\n import com.fasterxml.jackson.databind.jsontype.TypeSerializer;\n import com.fasterxml.jackson.databind.ser.BeanPropertyWriter;\n     public final void serialize(Object bean, JsonGenerator jgen, SerializerProvider provider)\n         throws IOException, JsonGenerationException\n     {\n+        // [JACKSON-805]\n+        if (provider.isEnabled(SerializationFeature.WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED)\n+                && hasSingleElement(provider)) {\n+            serializeAsArray(bean, jgen, provider);\n+            return;\n+        }\n         /* note: it is assumed here that limitations (type id, object id,\n          * any getter, filtering) have already been checked; so code here\n          * is trivial.\n     /* Field serialization methods\n     /**********************************************************\n      */\n+    private boolean hasSingleElement(SerializerProvider provider) {\n+        final BeanPropertyWriter[] props;\n+        if (_filteredProps != null && provider.getSerializationView() != null) {\n+            props = _filteredProps;\n+        } else {\n+            props = _props;\n+        }\n+        return props.length == 1;\n+    }\n \n     protected final void serializeAsArray(Object bean, JsonGenerator jgen, SerializerProvider provider)\n         throws IOException, JsonGenerationException\n--- a/src/test/java/com/fasterxml/jackson/databind/deser/TestBeanDeserializer.java\n+++ b/src/test/java/com/fasterxml/jackson/databind/deser/TestBeanDeserializer.java\n import java.io.IOException;\n \n \n+import com.fasterxml.jackson.annotation.JsonFormat;\n+import com.fasterxml.jackson.annotation.JsonFormat.Shape;\n import com.fasterxml.jackson.core.*;\n import com.fasterxml.jackson.databind.*;\n import com.fasterxml.jackson.databind.deser.BeanDeserializer;\n         }        \n     }\n     \n+    @JsonFormat(shape=Shape.ARRAY)\n+    class SingleBean {\n+        public String name;\n+    }\n+    \n     /*\n     /********************************************************\n     /* Unit tests\n         Bean result = mapper.readValue(quote(\"\"), Bean.class);\n         assertNull(result);\n     }\n+    \n+    public void testBeanAsArrayUnwrapped() throws Exception {\n+        ObjectMapper mapper = new ObjectMapper();\n+        mapper.enable(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY);\n+        SingleBean result = mapper.readValue(quote(\"foo\"), SingleBean.class);\n+        assertNotNull(result);\n+        assertEquals(\"foo\", result.name);\n+    }\n }\n--- a/src/test/java/com/fasterxml/jackson/databind/ser/TestBeanSerializer.java\n+++ b/src/test/java/com/fasterxml/jackson/databind/ser/TestBeanSerializer.java\n import java.util.*;\n \n import com.fasterxml.jackson.annotation.*;\n+import com.fasterxml.jackson.annotation.JsonFormat.Shape;\n import com.fasterxml.jackson.core.*;\n \n import com.fasterxml.jackson.databind.*;\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n import com.fasterxml.jackson.databind.introspect.AnnotatedField;\n import com.fasterxml.jackson.databind.introspect.POJOPropertyBuilder;\n import com.fasterxml.jackson.databind.module.SimpleModule;\n     static class EmptyBean {\n         @JsonIgnore\n         public String name = \"foo\";\n+    }\n+    \n+    // for [JACKSON-805]\n+    @JsonFormat(shape=Shape.ARRAY)\n+    static class SingleBean {\n+        public String name =\"foo\";\n     }\n     \n     static class EmptyBeanModifier extends BeanSerializerModifier\n         String json = mapper.writeValueAsString(new EmptyBean());\n         assertEquals(\"{\\\"bogus\\\":\\\"foo\\\"}\", json);\n     }\n+    \n+    // for [JACKSON-805]\n+    public void testBeanAsArrayWithSingleProperty() throws Exception {\n+        ObjectMapper mapper = new ObjectMapper();\n+        mapper.enable(SerializationFeature.WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED);\n+        String json = mapper.writeValueAsString(new SingleBean());\n+        assertEquals(\"\\\"foo\\\"\", json);\n+    }\n \n     /*\n     /********************************************************", "timestamp": 1348279621, "metainfo": ""}