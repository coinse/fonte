{"sha": "4882e4423ae7bfb80c65da4aa547ef5aed16a007", "log": "[JXPATH-115] enable attribute::node()  ", "commit": "\n--- a/src/java/org/apache/commons/jxpath/ri/axes/AttributeContext.java\n+++ b/src/java/org/apache/commons/jxpath/ri/axes/AttributeContext.java\n  */\n package org.apache.commons.jxpath.ri.axes;\n \n+import org.apache.commons.jxpath.ri.Compiler;\n import org.apache.commons.jxpath.ri.EvalContext;\n import org.apache.commons.jxpath.ri.QName;\n import org.apache.commons.jxpath.ri.compiler.NodeNameTest;\n import org.apache.commons.jxpath.ri.compiler.NodeTest;\n+import org.apache.commons.jxpath.ri.compiler.NodeTypeTest;\n import org.apache.commons.jxpath.ri.model.NodeIterator;\n import org.apache.commons.jxpath.ri.model.NodePointer;\n \n  * @version $Revision$ $Date$\n  */\n public class AttributeContext extends EvalContext {\n+    private static final NodeNameTest WILDCARD_TEST = new NodeNameTest(new QName(null, \"*\"));\n+\n     private NodeTest nodeTest;\n     private boolean setStarted = false;\n     private NodeIterator iterator;\n         super.setPosition(getCurrentPosition() + 1);\n         if (!setStarted) {\n             setStarted = true;\n-            if (!(nodeTest instanceof NodeNameTest)) {\n+            NodeNameTest nodeNameTest = null;\n+            if (nodeTest instanceof NodeTypeTest) {\n+                if (((NodeTypeTest) nodeTest).getNodeType() == Compiler.NODE_TYPE_NODE) {\n+                    nodeNameTest = WILDCARD_TEST;\n+                }\n+            }\n+            else if (nodeTest instanceof NodeNameTest) {\n+                nodeNameTest = (NodeNameTest) nodeTest;\n+            }\n+            if (nodeNameTest == null) {\n                 return false;\n             }\n-            QName name = ((NodeNameTest) nodeTest).getNodeName();\n-            iterator =\n-                parentContext.getCurrentNodePointer().attributeIterator(name);\n+            iterator = parentContext.getCurrentNodePointer().attributeIterator(\n+                    nodeNameTest.getNodeName());\n         }\n-\n         if (iterator == null) {\n             return false;\n         }\n--- a/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java\n+++ b/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java\n                 //use a set because DOM returns attrs sorted by name, JDOM by occurrence order:\n                 set(\"10%\", \"20%\"));\n \n+        // attribute::node()\n+        assertXPathValueIterator(\n+                context,\n+                \"vendor/product/price:amount/attribute::node()\",\n+                //use a set because DOM returns attrs sorted by name, JDOM by occurrence order:\n+                set(\"10%\", \"20%\"));\n+        \n         // attribute:: select non-ns'd attributes only\n         assertXPathValueIterator(\n             context,", "timestamp": 1202009761, "metainfo": ""}