{"sha": "8a04f62fa755ec165152a03a516c186d20e8cd46", "log": "[JXPATH-102] Core rounding functions don't handle NaN or infinite values correctly; from Sergey Vladimirov  ", "commit": "\n--- a/src/java/org/apache/commons/jxpath/ri/compiler/CoreFunction.java\n+++ b/src/java/org/apache/commons/jxpath/ri/compiler/CoreFunction.java\n     protected Object functionFloor(EvalContext context) {\n         assertArgCount(1);\n         double v = InfoSetUtil.doubleValue(getArg1().computeValue(context));\n+        if (Double.isNaN(v) || Double.isInfinite(v)) {\n+        \treturn new Double(v);\n+        }\n         return new Double(Math.floor(v));\n     }\n \n     protected Object functionCeiling(EvalContext context) {\n         assertArgCount(1);\n         double v = InfoSetUtil.doubleValue(getArg1().computeValue(context));\n+        if (Double.isNaN(v) || Double.isInfinite(v)) {\n+        \treturn new Double(v);\n+        }\n         return new Double(Math.ceil(v));\n     }\n \n     protected Object functionRound(EvalContext context) {\n         assertArgCount(1);\n         double v = InfoSetUtil.doubleValue(getArg1().computeValue(context));\n+        if (Double.isNaN(v) || Double.isInfinite(v)) {\n+        \treturn new Double(v);\n+        }\n         return new Double(Math.round(v));\n     }\n \n--- a/src/test/org/apache/commons/jxpath/ri/compiler/CoreFunctionTest.java\n+++ b/src/test/org/apache/commons/jxpath/ri/compiler/CoreFunctionTest.java\n         assertXPathValue(context, \"ceiling(-1.5)\", new Double(-1));\n         assertXPathValue(context, \"round(1.5)\", new Double(2));\n         assertXPathValue(context, \"round(-1.5)\", new Double(-1));\n+\n+        assertXPathValue(context, \"floor('NaN')\", new Double(Double.NaN));\n+        assertXPathValue(context, \"floor(-2 div 0)\", new Double(Double.NEGATIVE_INFINITY));\n+        assertXPathValue(context, \"floor(2 div 0)\", new Double(Double.POSITIVE_INFINITY));\n+        assertXPathValue(context, \"ceiling('NaN')\", new Double(Double.NaN));\n+        assertXPathValue(context, \"ceiling(-2 div 0)\", new Double(Double.NEGATIVE_INFINITY));\n+        assertXPathValue(context, \"ceiling(2 div 0)\", new Double(Double.POSITIVE_INFINITY));\n+        assertXPathValue(context, \"round('NaN')\", new Double(Double.NaN));\n+        assertXPathValue(context, \"round(-2 div 0)\", new Double(Double.NEGATIVE_INFINITY));\n+        assertXPathValue(context, \"round(2 div 0)\", new Double(Double.POSITIVE_INFINITY));\n     }\n \n     public void testIDFunction() {", "timestamp": 1188233368, "metainfo": ""}