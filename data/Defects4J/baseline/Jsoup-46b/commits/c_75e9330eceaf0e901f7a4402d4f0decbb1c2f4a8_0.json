{"sha": "75e9330eceaf0e901f7a4402d4f0decbb1c2f4a8", "log": "Obsolete meta charset elements are removed on update.", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Document.java\n+++ b/src/main/java/org/jsoup/nodes/Document.java\n             \n             if( metaCharset != null ) {\n                 metaCharset.attr(\"charset\", outputSettings.charset().displayName());\n-                // TODO: Remove other charset tags / handle duplicates (?)\n             }\n             else {\n                 Element head = head();\n                     head.appendElement(\"meta\").attr(\"charset\", outputSettings.charset().displayName());\n                 }\n             }\n+            \n+            // Remove obsolete elements\n+            select(\"meta[name=charset]\").remove();\n         }\n     }\n     \n--- a/src/test/java/org/jsoup/nodes/DocumentTest.java\n+++ b/src/test/java/org/jsoup/nodes/DocumentTest.java\n         \n         final String charsetUtf8 = \"UTF-8\";\n         doc.charset(Charset.forName(charsetUtf8));\n-        Element metaCharset = doc.select(\"meta[charset]\").first();\n+        Element selectedElement = doc.select(\"meta[charset]\").first();\n         \n         final String htmlCharsetUTF8 = \"<html>\\n\" +\n                                         \" <head>\\n\" +\n                                         \" <body></body>\\n\" +\n                                         \"</html>\";\n         \n-        assertNotNull(metaCharset);\n+        assertNotNull(selectedElement);\n         assertEquals(charsetUtf8, doc.charset().displayName());\n-        assertEquals(charsetUtf8, metaCharset.attr(\"charset\"));\n+        assertEquals(charsetUtf8, selectedElement.attr(\"charset\"));\n         assertEquals(htmlCharsetUTF8, doc.toString());\n         assertEquals(doc.charset(), doc.outputSettings().charset());\n         \n         final String charsetIso8859 = \"ISO-8859-1\";\n         doc.charset(Charset.forName(charsetIso8859));\n-        metaCharset = doc.select(\"meta[charset]\").first();\n+        selectedElement = doc.select(\"meta[charset]\").first();\n         \n         final String htmlCharsetISO = \"<html>\\n\" +\n                                         \" <head>\\n\" +\n                                         \" <body></body>\\n\" +\n                                         \"</html>\";\n         \n-        assertNotNull(metaCharset);\n+        assertNotNull(selectedElement);\n         assertEquals(charsetIso8859, doc.charset().displayName());\n-        assertEquals(charsetIso8859, metaCharset.attr(\"charset\"));\n+        assertEquals(charsetIso8859, selectedElement.attr(\"charset\"));\n         assertEquals(htmlCharsetISO, doc.toString());\n         assertEquals(doc.charset(), doc.outputSettings().charset());\n         \n         final String htmlCharset = \"<html>\\n\" +\n                                     \" <head>\\n\" +\n                                     \"  <meta charset=\\\"dontTouch\\\">\\n\" +\n+                                    \"  <meta name=\\\"charset\\\" content=\\\"dontTouch\\\">\\n\" +\n                                     \" </head>\\n\" +\n                                     \" <body></body>\\n\" +\n                                     \"</html>\";\n         \n         docDisabled.head().appendElement(\"meta\").attr(\"charset\", \"dontTouch\");\n+        docDisabled.head().appendElement(\"meta\").attr(\"name\", \"charset\").attr(\"content\", \"dontTouch\");\n+        \n         assertEquals(htmlCharset, docDisabled.toString());\n         \n-        metaCharset = docDisabled.select(\"meta[charset]\").first();\n-        assertNotNull(metaCharset);\n-        assertEquals(\"dontTouch\", metaCharset.attr(\"charset\"));\n+        selectedElement = docDisabled.select(\"meta[charset]\").first();\n+        assertNotNull(selectedElement);\n+        assertEquals(\"dontTouch\", selectedElement.attr(\"charset\"));\n+        selectedElement = docDisabled.select(\"meta[name=charset]\").first();\n+        assertNotNull(selectedElement);\n+        assertEquals(\"dontTouch\", selectedElement.attr(\"content\"));\n         \n         doc.charset(Charset.forName(charsetUtf8));\n-        metaCharset = docDisabled.select(\"meta[charset]\").first();\n-        assertNotNull(metaCharset);\n-        assertEquals(\"dontTouch\", metaCharset.attr(\"charset\"));\n+        selectedElement = docDisabled.select(\"meta[charset]\").first();\n+        assertNotNull(selectedElement);\n+        assertEquals(\"dontTouch\", selectedElement.attr(\"charset\"));\n+        selectedElement = docDisabled.select(\"meta[name=charset]\").first();\n+        assertNotNull(selectedElement);\n+        assertEquals(\"dontTouch\", selectedElement.attr(\"content\"));\n+        \n+        \n+        // Remove obsolete charset definitions\n+        final Document docCleanup = Document.createShell(\"\");\n+        docCleanup.updateMetaCharset(true);\n+        docCleanup.head().appendElement(\"meta\").attr(\"charset\", \"dontTouch\");\n+        docCleanup.head().appendElement(\"meta\").attr(\"name\", \"charset\").attr(\"content\", \"dontTouch\");\n+        \n+        assertEquals(htmlCharsetUTF8, doc.toString());\n     }\n }", "timestamp": 1414615606, "metainfo": ""}