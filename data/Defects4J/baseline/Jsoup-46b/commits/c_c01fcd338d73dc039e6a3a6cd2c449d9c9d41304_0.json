{"sha": "c01fcd338d73dc039e6a3a6cd2c449d9c9d41304", "log": "Form data submission fix  Don\u2019t submit disabled elements Set checkbox and radio to default val \u2018on\u2019 if unset  Fixes #489", "commit": "\n--- a/src/main/java/org/jsoup/nodes/FormElement.java\n+++ b/src/main/java/org/jsoup/nodes/FormElement.java\n         // iterate the form control elements and accumulate their values\n         for (Element el: elements) {\n             if (!el.tag().isFormSubmittable()) continue; // contents are form listable, superset of submitable\n+            if (el.hasAttr(\"disabled\")) continue; // skip disabled form inputs\n             String name = el.attr(\"name\");\n             if (name.length() == 0) continue;\n             String type = el.attr(\"type\");\n                 }\n             } else if (\"checkbox\".equalsIgnoreCase(type) || \"radio\".equalsIgnoreCase(type)) {\n                 // only add checkbox or radio if they have the checked attribute\n-                if (el.hasAttr(\"checked\"))\n-                    data.add(HttpConnection.KeyVal.create(name, el.val()));\n+                if (el.hasAttr(\"checked\")) {\n+                    final String val = el.val().length() >  0 ? el.val() : \"on\";\n+                    data.add(HttpConnection.KeyVal.create(name, val));\n+                }\n             } else {\n                 data.add(HttpConnection.KeyVal.create(name, el.val()));\n             }\n--- a/src/test/java/org/jsoup/nodes/FormElementTest.java\n+++ b/src/test/java/org/jsoup/nodes/FormElementTest.java\n                 \"<option value='four' selected><option value='five' selected><textarea name=six>seven</textarea>\" +\n                 \"<input name='seven' type='radio' value='on' checked><input name='seven' type='radio' value='off'>\" +\n                 \"<input name='eight' type='checkbox' checked><input name='nine' type='checkbox' value='unset'>\" +\n+                \"<input name='ten' value='text' disabled>\" +\n                 \"</form>\";\n         Document doc = Jsoup.parse(html);\n         FormElement form = (FormElement) doc.select(\"form\").first();\n         assertEquals(\"three=four\", data.get(1).toString());\n         assertEquals(\"three=five\", data.get(2).toString());\n         assertEquals(\"six=seven\", data.get(3).toString());\n-        assertEquals(\"seven=on\", data.get(4).toString());\n-        assertEquals(\"eight=\", data.get(5).toString());\n+        assertEquals(\"seven=on\", data.get(4).toString()); // set\n+        assertEquals(\"eight=on\", data.get(5).toString()); // default\n+        // nine should not appear, not checked checkbox\n+        // ten should not appear, disabled\n     }\n \n     @Test public void createsSubmitableConnection() {\n         List<Connection.KeyVal> data = form.formData();\n         assertEquals(\"foo=bar\", data.get(0).toString());\n     }\n+\n+    @Test public void usesOnForCheckboxValueIfNoValueSet() {\n+        Document doc = Jsoup.parse(\"<form><input type=checkbox checked name=foo></form>\");\n+        FormElement form = (FormElement) doc.select(\"form\").first();\n+        List<Connection.KeyVal> data = form.formData();\n+        assertEquals(\"on\", data.get(0).value());\n+        assertEquals(\"foo\", data.get(0).key());\n+    }\n }", "timestamp": 1428027263, "metainfo": ""}