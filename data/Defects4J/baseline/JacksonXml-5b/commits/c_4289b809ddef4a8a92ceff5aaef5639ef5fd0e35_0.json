{"sha": "4289b809ddef4a8a92ceff5aaef5639ef5fd0e35", "log": "Merge branch '2.8'", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/deser/XmlReadContext.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/deser/XmlReadContext.java\n \n     protected String _currentName;\n \n+    /**\n+     * @since 2.9\n+     */\n+    protected Object _currentValue;\n+\n     protected Set<String> _namesToWrap;\n \n     /**\n      * Name of property that requires wrapping\n      */\n     protected String _wrappedName;\n-    \n+\n     /*\n     /**********************************************************\n     /* Simple instance reuse slots; speeds up things\n         _lineNr = lineNr;\n         _columnNr = colNr;\n         _currentName = null;\n+        _currentValue = null;\n         _namesToWrap = null;\n     }\n-    \n-    // // // Factory methods\n+\n+    @Override\n+    public Object getCurrentValue() {\n+        return _currentValue;\n+    }\n+\n+    @Override\n+    public void setCurrentValue(Object v) {\n+        _currentValue = v;\n+    }\n+\n+    /*\n+    /**********************************************************\n+    /* Factory methods\n+    /**********************************************************\n+     */\n \n     public static XmlReadContext createRootContext(int lineNr, int colNr) {\n         return new XmlReadContext(null, TYPE_ROOT, lineNr, colNr);\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/XmlSerializerProvider.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/XmlSerializerProvider.java\n         final JsonSerializer<Object> ser = findTypedValueSerializer(cls, true, null);\n         try {\n             ser.serialize(value, gen, this);\n-        } catch (IOException ioe) { // As per [JACKSON-99], pass IOException and subtypes as-is\n-            throw ioe;\n         } catch (Exception e) { // but wrap RuntimeExceptions, to get path information\n-            String msg = e.getMessage();\n-            if (msg == null) {\n-                msg = \"[no message for \"+e.getClass().getName()+\"]\";\n-            }\n-            throw JsonMappingException.from(gen, msg, e);\n+            throw _wrapAsIOE(gen, e);\n         }\n         // end of super-class implementation\n \n         }\n     }\n \n+    // @since 2.1\n     @SuppressWarnings(\"resource\")\n     @Override\n-    public void serializeValue(JsonGenerator gen, Object value, JavaType rootType)\n-        throws IOException\n+    public void serializeValue(JsonGenerator gen, Object value, JavaType rootType,\n+            JsonSerializer<Object> ser) throws IOException\n     {\n         if (value == null) {\n             _serializeXmlNull(gen);\n                 _startRootArray(xgen, rootName);\n             }\n         }\n-\n-        final JsonSerializer<Object> ser = findTypedValueSerializer(rootType, true, null);\n+        if (ser == null) {\n+            ser = findTypedValueSerializer(rootType, true, null);\n+        }\n         // From super-class implementation\n         try {\n             ser.serialize(value, gen, this);\n-        } catch (IOException ioe) { // no wrapping for IO (and derived)\n-            throw ioe;\n         } catch (Exception e) { // but others do need to be, to get path etc\n-            String msg = e.getMessage();\n-            if (msg == null) {\n-                msg = \"[no message for \"+e.getClass().getName()+\"]\";\n-            }\n-            throw JsonMappingException.from(gen, msg, e);\n-        }\n-        // end of super-class implementation\n-\n-        if (asArray) {\n-            gen.writeEndObject();\n-        }\n-    }\n-    \n-    // @since 2.1\n-    @SuppressWarnings(\"resource\")\n-    @Override\n-    public void serializeValue(JsonGenerator gen, Object value, JavaType rootType,\n-            JsonSerializer<Object> ser) throws IOException\n-    {\n-        if (value == null) {\n-            _serializeXmlNull(gen);\n-            return;\n-        }\n-        final boolean asArray;\n-        final ToXmlGenerator xgen = _asXmlGenerator(gen);\n-        if (xgen == null) { // called by convertValue()\n-            asArray = false;\n-        } else {\n-            QName rootName = _rootNameFromConfig();\n-            if (rootName == null) {\n-                rootName = _rootNameLookup.findRootName(rootType, _config);\n-            }\n-            _initWithRootName(xgen, rootName);\n-            asArray = TypeUtil.isIndexedType(rootType);\n-            if (asArray) {\n-                _startRootArray(xgen, rootName);\n-            }\n-        }\n-        if (ser == null) {\n-            ser = findTypedValueSerializer(rootType, true, null);\n-        }\n-        // From super-class implementation\n-        try {\n-            ser.serialize(value, gen, this);\n-        } catch (IOException ioe) { // no wrapping for IO (and derived)\n-            throw ioe;\n-        } catch (Exception e) { // but others do need to be, to get path etc\n-            String msg = e.getMessage();\n-            if (msg == null) {\n-                msg = \"[no message for \"+e.getClass().getName()+\"]\";\n-            }\n-            throw JsonMappingException.from(gen, msg, e);\n+            throw _wrapAsIOE(gen, e);\n         }\n         // end of super-class implementation\n         if (asArray) {\n         }\n         return (ToXmlGenerator) gen;\n     }    \n+\n+    protected IOException _wrapAsIOE(JsonGenerator g, Exception e) {\n+        if (e instanceof IOException) {\n+            return (IOException) e;\n+        }\n+        String msg = e.getMessage();\n+        if (msg == null) {\n+            msg = \"[no message for \"+e.getClass().getName()+\"]\";\n+        }\n+        return new JsonMappingException(g, msg, e);\n+    }\n }", "timestamp": 1491602123, "metainfo": ""}