{"sha": "dc863809ea2daad78bca8e73ff0c27ebb9527f17", "log": "Add a small robustification wrt #54", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/XmlMapper.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/XmlMapper.java\n         ((XmlFactory)_jsonFactory).configure(f, state);\n         return this;\n     }\n+\n+    public ObjectMapper enable(ToXmlGenerator.Feature f) {\n+        ((XmlFactory)_jsonFactory).enable(f);\n+        return this;\n+    }\n+\n+    public ObjectMapper enable(FromXmlParser.Feature f) {\n+        ((XmlFactory)_jsonFactory).enable(f);\n+        return this;\n+    }\n+\n+    public ObjectMapper disable(ToXmlGenerator.Feature f) {\n+        ((XmlFactory)_jsonFactory).disable(f);\n+        return this;\n+    }\n+\n+    public ObjectMapper disable(FromXmlParser.Feature f) {\n+        ((XmlFactory)_jsonFactory).disable(f);\n+        return this;\n+    }\n     \n     /*\n     /**********************************************************\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/ToXmlGenerator.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/ToXmlGenerator.java\n      */\n \n     /**\n+     * Marker set when {@link #initGenerator()} has been called or not.\n+     * \n+     * @since 2.2\n+     */\n+    protected boolean _initialized;\n+    \n+    /**\n      * Element or attribute name to use for next output call.\n      * Assigned by either code that initiates serialization\n      * or bean serializer.\n      */\n     public void initGenerator()  throws IOException, JsonGenerationException\n     {\n+        if (_initialized) {\n+            return;\n+        }\n+        _initialized = true;\n         try {\n             if ((_xmlFeatures & Feature.WRITE_XML_1_1.getMask()) != 0) {\n                 _xmlWriter.writeStartDocument(\"UTF-8\", \"1.1\");\n--- a/src/test/java/com/fasterxml/jackson/dataformat/xml/TestSerializationManual.java\n+++ b/src/test/java/com/fasterxml/jackson/dataformat/xml/TestSerializationManual.java\n     public void testIssue54() throws Exception\n     {\n         XmlMapper xmlMapper = new XmlMapper();\n+        xmlMapper.enable(ToXmlGenerator.Feature.WRITE_XML_DECLARATION);\n         StringWriter sw = new StringWriter();\n         ToXmlGenerator generator = (ToXmlGenerator) xmlMapper.getFactory().createGenerator(sw);\n-//        generator.initGenerator();\n+        generator.initGenerator();\n \n         generator.setNextName(new QName(\"items\"));\n         generator.writeStartObject();\n         generator.close();\n         \n         String xml = sw.toString();\n+        \n+        // Remove XML declaration\n+        assertTrue(xml.startsWith(\"<?xml version\"));\n+        int ix = xml.indexOf(\"?>\");\n+        xml = xml.substring(ix+2).trim();\n+        \n         assertEquals(\"<items><item><num>13</num></item><item><num>456</num></item></items>\", xml);\n    }\n }", "timestamp": 1363143918, "metainfo": ""}