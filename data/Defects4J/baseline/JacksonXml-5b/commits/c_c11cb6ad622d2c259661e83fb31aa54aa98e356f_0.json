{"sha": "c11cb6ad622d2c259661e83fb31aa54aa98e356f", "log": "Merge pull request #234 from gtrog/issue233  Issue#233 XmlMapper.copy() doesn't properly copy internal configurations", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/XmlMapper.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/XmlMapper.java\n         _serializationConfig = _serializationConfig.withDefaultPrettyPrinter(DEFAULT_XML_PRETTY_PRINTER);\n     }\n \n+    protected XmlMapper(XmlMapper mapper) {\n+        super(mapper);\n+        this._xmlModule = mapper._xmlModule;\n+    }\n+\n     @Override\n     public XmlMapper copy()\n     {\n         _checkInvalidCopy(XmlMapper.class);\n-        return new XmlMapper((XmlFactory) _jsonFactory.copy(), _xmlModule);\n+        return new XmlMapper(this);\n     }\n \n     @Override\n--- a/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/XmlSerializerProvider.java\n+++ b/src/main/java/com/fasterxml/jackson/dataformat/xml/ser/XmlSerializerProvider.java\n         _rootNameLookup  = src._rootNameLookup;\n     }\n \n+    protected XmlSerializerProvider(XmlSerializerProvider toCopy) {\n+        super(toCopy);\n+        this._rootNameLookup = toCopy._rootNameLookup;\n+    }\n+\n     /*\n     /**********************************************************************\n     /* Overridden methods\n     /**********************************************************************\n      */\n+\n+    @Override\n+    public DefaultSerializerProvider copy() {\n+        return new XmlSerializerProvider(this);\n+    }\n \n     @Override\n     public DefaultSerializerProvider createInstance(SerializationConfig config,\n--- a/src/test/java/com/fasterxml/jackson/dataformat/xml/VersionInfoTest.java\n+++ b/src/test/java/com/fasterxml/jackson/dataformat/xml/VersionInfoTest.java\n \n import com.fasterxml.jackson.core.Version;\n import com.fasterxml.jackson.core.Versioned;\n-import com.fasterxml.jackson.dataformat.xml.PackageVersion;\n-import com.fasterxml.jackson.dataformat.xml.XmlFactory;\n-import com.fasterxml.jackson.dataformat.xml.XmlMapper;\n+import com.fasterxml.jackson.databind.SerializationConfig;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n+import com.fasterxml.jackson.databind.ser.DefaultSerializerProvider;\n import com.fasterxml.jackson.dataformat.xml.ser.ToXmlGenerator;\n+import com.fasterxml.jackson.dataformat.xml.ser.XmlSerializerProvider;\n+import com.fasterxml.jackson.dataformat.xml.util.XmlRootNameLookup;\n \n public class VersionInfoTest extends XmlTestBase\n {\n         XmlMapper mapper1 = new XmlMapper();\n         mapper1.setXMLTextElementName(\"foo\");\n         mapper1.configure(ToXmlGenerator.Feature.WRITE_XML_DECLARATION, true);\n-        \n+        mapper1.disable(SerializationFeature.FAIL_ON_EMPTY_BEANS);\n+\n         XmlMapper mapper2 = mapper1.copy();\n         assertNotSame(mapper1, mapper2);\n         XmlFactory xf1 = mapper1.getFactory();\n         assertEquals(xf1.getXMLTextElementName(), xf2.getXMLTextElementName());\n         assertEquals(xf1._xmlGeneratorFeatures, xf2._xmlGeneratorFeatures);\n         assertEquals(xf1._xmlParserFeatures, xf2._xmlParserFeatures);\n+\n+        // and [Issue#233]\n+        SerializationConfig sc1 = mapper1.getSerializationConfig();\n+        SerializationConfig sc2 = mapper2.getSerializationConfig();\n+        assertNotSame(sc1, sc2);\n+        assertEquals(\n+            \"serialization features did not get copied\",\n+            sc1.getSerializationFeatures(),\n+            sc2.getSerializationFeatures()\n+        );\n+    }\n+\n+    public void testSerializerProviderCopy() {\n+        DefaultSerializerProvider provider = new XmlSerializerProvider(new XmlRootNameLookup());\n+        DefaultSerializerProvider copy = provider.copy();\n+        assertNotSame(provider, copy);\n     }\n \n     // Another test for [Issue#48]", "timestamp": 1495065939, "metainfo": ""}