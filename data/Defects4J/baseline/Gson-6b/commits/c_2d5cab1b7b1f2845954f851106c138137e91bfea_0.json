{"sha": "2d5cab1b7b1f2845954f851106c138137e91bfea", "log": "Fix hashing in LinkedHashTreeMap, but it still does not work :(", "commit": "\n--- a/gson/src/main/java/com/google/gson/internal/LinkedHashTreeMap.java\n+++ b/gson/src/main/java/com/google/gson/internal/LinkedHashTreeMap.java\n  * LinkedHashMap classes.\n  */\n public final class LinkedHashTreeMap<K, V> extends AbstractMap<K, V> implements Serializable {\n+  private static final int MAX_CAPACITY = 8192;\n+\n   @SuppressWarnings({ \"unchecked\", \"rawtypes\" }) // to avoid Comparable<Comparable<Comparable<...>>>\n   private static final Comparator<Comparable> NATURAL_ORDER = new Comparator<Comparable>() {\n     public int compare(Comparable a, Comparable b) {\n    * twice as many trees, each of (approximately) half the previous size.\n    */\n   static <K, V> Node<K, V>[] doubleCapacity(Node<K, V>[] oldTable) {\n-    // TODO: don't do anything if we're already at MAX_CAPACITY\n     int oldCapacity = oldTable.length;\n+    if (oldCapacity >= MAX_CAPACITY) {\n+      return oldTable;\n+    }\n+\n+    int newCapacity = oldCapacity * 2;\n+\n     @SuppressWarnings(\"unchecked\") // Arrays and generics don't get along.\n-    Node<K, V>[] newTable = new Node[oldCapacity * 2];\n+    Node<K, V>[] newTable = new Node[newCapacity];\n     AvlIterator<K, V> iterator = new AvlIterator<K, V>();\n     AvlBuilder<K, V> leftBuilder = new AvlBuilder<K, V>();\n     AvlBuilder<K, V> rightBuilder = new AvlBuilder<K, V>();\n       int leftSize = 0;\n       int rightSize = 0;\n       for (Node<K, V> node; (node = iterator.next()) != null; ) {\n-        if ((node.hash & oldCapacity) == 0) {\n+        if ((node.hash & (newCapacity - 1)) == i) {\n           leftSize++;\n         } else {\n           rightSize++;\n         rightBuilder.reset(rightSize);\n         iterator.reset(root);\n         for (Node<K, V> node; (node = iterator.next()) != null; ) {\n-          if ((node.hash & oldCapacity) == 0) {\n+          if ((node.hash & (newCapacity - 1)) == i) {\n             leftBuilder.add(node);\n           } else {\n             rightBuilder.add(node);", "timestamp": 1368477607, "metainfo": ""}