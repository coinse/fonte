{"sha": "364de8061173b4b91f4477a55059f68e765fc3d1", "log": "Stream to a DOM", "commit": "\n--- a/gson/src/main/java/com/google/gson/internal/bind/JsonElementWriter.java\n+++ b/gson/src/main/java/com/google/gson/internal/bind/JsonElementWriter.java\n   }\n \n   public JsonElement get() {\n+    if (stack.isEmpty()) {\n+      return JsonNull.INSTANCE; // TODO: is this really what we want?\n+    }\n     if (stack.size() != 1) {\n-      throw new IllegalStateException();\n+      throw new IllegalStateException(\"Expected one JSON element but was \" + stack);\n     }\n     return stack.get(0);\n   }\n   }\n \n   @Override public JsonWriter value(String value) throws IOException {\n+    if (value == null) {\n+      return nullValue();\n+    }\n     put(new JsonPrimitive(value));\n     return this;\n   }\n   }\n \n   @Override public JsonWriter value(Number value) throws IOException {\n+    if (value == null) {\n+      return nullValue();\n+    }\n     put(new JsonPrimitive(value));\n     return this;\n   }\n--- a/gson/src/main/java/com/google/gson/internal/bind/TypeAdapter.java\n+++ b/gson/src/main/java/com/google/gson/internal/bind/TypeAdapter.java\n \n import com.google.gson.JsonElement;\n import com.google.gson.JsonIOException;\n-import com.google.gson.internal.Streams;\n import com.google.gson.reflect.TypeToken;\n import com.google.gson.stream.JsonReader;\n import com.google.gson.stream.JsonWriter;\n-\n import java.io.IOException;\n import java.io.Reader;\n import java.io.StringReader;\n \n   public JsonElement toJsonElement(T src) {\n     try {\n-      StringWriter stringWriter = new StringWriter();\n-      JsonWriter jsonWriter = new JsonWriter(stringWriter);\n+      JsonElementWriter jsonWriter = new JsonElementWriter();\n       jsonWriter.setLenient(true);\n       write(jsonWriter, src);\n-      JsonReader reader = new JsonReader(new StringReader(stringWriter.toString()));\n-      reader.setLenient(true);\n-      return Streams.parse(reader);\n+      return jsonWriter.get();\n     } catch (IOException e) {\n       throw new JsonIOException(e);\n     }\n--- a/gson/src/test/java/com/google/gson/internal/bind/JsonElementWriterTest.java\n+++ b/gson/src/test/java/com/google/gson/internal/bind/JsonElementWriterTest.java\n \n   // TODO: more tests\n   // TODO: close support\n+  // TODO: figure out what should be returned by an empty writer\n \n   public void testArray() throws IOException {\n     JsonElementWriter writer = new JsonElementWriter();", "timestamp": 1317364353, "metainfo": ""}