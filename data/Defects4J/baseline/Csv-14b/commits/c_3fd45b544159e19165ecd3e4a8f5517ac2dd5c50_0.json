{"sha": "3fd45b544159e19165ecd3e4a8f5517ac2dd5c50", "log": "Have to check for comment after dealing with empty lines.  ", "commit": "\n--- a/src/main/java/org/apache/commons/csv/CSVLexer.java\n+++ b/src/main/java/org/apache/commons/csv/CSVLexer.java\n         //  read the next char and set eol\n         int c = in.read();\n \n-        if (isStartOfLine(lastChar) && isCommentStart(c)) {\n-            in.readLine();\n-            tkn.type = COMMENT;\n-            return tkn;\n-        }\n-\n         /* note: unfortunately isEndOfLine may consumes a character silently.\n         *       this has no effect outside of the method. so a simple workaround\n         *       is to call 'readAgain' on the stream...\n         if (isEndOfFile(lastChar) || (!isDelimiter(lastChar) && isEndOfFile(c))) {\n             tkn.type = EOF;\n             // don't set tkn.isReady here because no content\n+            return tkn;\n+        }\n+\n+        if (isStartOfLine(lastChar) && isCommentStart(c)) {\n+            in.readLine();\n+            tkn.type = COMMENT;\n             return tkn;\n         }\n \n--- a/src/test/java/org/apache/commons/csv/CSVLexerTest.java\n+++ b/src/test/java/org/apache/commons/csv/CSVLexerTest.java\n     public void testNextToken2() throws IOException {\n         final String code = \n                 \"1,2,3,\\n\"+                // 1\n+                \"\\n\"+\n+                \"\\n\"+\n                 \"a,b x,c#no-comment\\n\"+    // 2\n+                \"\\n\"+\n+                \"\\n\"+\n                 \"#foo\\n\"+                  // 3\n                 \"\\n\"+                      // 4\n                 \"d,e,#no-comment\\n\"+       // 5\n+                \"\\n\"+\n+                \"\\n\"+\n                 \"# penultimate comment\\n\"+ // 6\n+                \"\\n\"+\n+                \"\\n\"+\n                 \"# Final comment\\n\";       // 7\n         CSVFormat format = CSVFormat.DEFAULT.withCommentStart('#');\n         assertTrue(\"Should ignore empty lines\", format.isEmptyLinesIgnored());", "timestamp": 1332984264, "metainfo": ""}