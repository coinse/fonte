{"sha": "411c01ff53f56f0b84bee210ad75c8c2114efa55", "log": "Improved \"abs:\" absolute URL handling in Elements.attr(\"abs:href\") and Node.hasAttr(\"abs:href\").  Fixes #97", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Node.java\n+++ b/src/main/java/org/jsoup/nodes/Node.java\n     public String attr(String attributeKey) {\n         Validate.notNull(attributeKey);\n \n-        if (hasAttr(attributeKey))\n+        if (attributes.hasKey(attributeKey))\n             return attributes.get(attributeKey);\n         else if (attributeKey.toLowerCase().startsWith(\"abs:\"))\n             return absUrl(attributeKey.substring(\"abs:\".length()));\n      */\n     public boolean hasAttr(String attributeKey) {\n         Validate.notNull(attributeKey);\n+\n+        if (attributeKey.toLowerCase().startsWith(\"abs:\")) {\n+            String key = attributeKey.substring(\"abs:\".length());\n+            if (attributes.hasKey(key) && !absUrl(key).equals(\"\"))\n+                return true;\n+        }\n         return attributes.hasKey(attributeKey);\n     }\n \n--- a/src/test/java/org/jsoup/nodes/NodeTest.java\n+++ b/src/test/java/org/jsoup/nodes/NodeTest.java\n         Element a = doc.select(\"a\").first();\n         assertEquals(\"/foo\", a.attr(\"href\"));\n         assertEquals(\"http://jsoup.org/foo\", a.attr(\"abs:href\"));\n-        assertFalse(a.hasAttr(\"abs:href\")); // only realised on the get method, not in has or iterator\n+        assertTrue(a.hasAttr(\"abs:href\"));\n     }\n \n     @Test public void handlesAbsOnImage() {\n         Element img = doc.select(\"img\").first();\n         assertEquals(\"http://jsoup.org/rez/osi_logo.png\", img.attr(\"abs:src\"));\n         assertEquals(img.absUrl(\"src\"), img.attr(\"abs:src\"));\n+    }\n+\n+    @Test public void handlesAbsPrefixOnHasAttr() {\n+        // 1: no abs url; 2: has abs url\n+        Document doc = Jsoup.parse(\"<a id=1 href='/foo'>One</a> <a id=2 href='http://jsoup.org/'>Two</a>\");\n+        Element one = doc.select(\"#1\").first();\n+        Element two = doc.select(\"#2\").first();\n+\n+        assertFalse(one.hasAttr(\"abs:href\"));\n+        assertTrue(one.hasAttr(\"href\"));\n+        assertEquals(\"\", one.absUrl(\"href\"));\n+\n+        assertTrue(two.hasAttr(\"abs:href\"));\n+        assertTrue(two.hasAttr(\"href\"));\n+        assertEquals(\"http://jsoup.org/\", two.absUrl(\"href\"));\n+    }\n+\n+    @Test public void literalAbsPrefix() {\n+        // if there is a literal attribute \"abs:xxx\", don't try and make absolute.\n+        Document doc = Jsoup.parse(\"<a abs:href='odd'>One</a>\");\n+        Element el = doc.select(\"a\").first();\n+        assertTrue(el.hasAttr(\"abs:href\"));\n+        assertEquals(\"odd\", el.attr(\"abs:href\"));\n     }\n \n     /*\n--- a/src/test/java/org/jsoup/select/ElementsTest.java\n+++ b/src/test/java/org/jsoup/select/ElementsTest.java\n         assertTrue(ps.hasAttr(\"class\"));\n         assertFalse(ps.hasAttr(\"style\"));\n     }\n+\n+    @Test public void hasAbsAttr() {\n+        Document doc = Jsoup.parse(\"<a id=1 href='/foo'>One</a> <a id=2 href='http://jsoup.org'>Two</a>\");\n+        Elements one = doc.select(\"#1\");\n+        Elements two = doc.select(\"#2\");\n+        Elements both = doc.select(\"a\");\n+        assertFalse(one.hasAttr(\"abs:href\"));\n+        assertTrue(two.hasAttr(\"abs:href\"));\n+        assertTrue(both.hasAttr(\"abs:href\")); // hits on #2\n+    }\n     \n     @Test public void attr() {\n         Document doc = Jsoup.parse(\"<p title=foo><p title=bar><p class=foo><p class=bar>\");\n         String classVal = doc.select(\"p\").attr(\"class\");\n         assertEquals(\"foo\", classVal);\n+    }\n+\n+    @Test public void absAttr() {\n+        Document doc = Jsoup.parse(\"<a id=1 href='/foo'>One</a> <a id=2 href='http://jsoup.org'>Two</a>\");\n+        Elements one = doc.select(\"#1\");\n+        Elements two = doc.select(\"#2\");\n+        Elements both = doc.select(\"a\");\n+\n+        assertEquals(\"\", one.attr(\"abs:href\"));\n+        assertEquals(\"http://jsoup.org\", two.attr(\"abs:href\"));\n+        assertEquals(\"http://jsoup.org\", both.attr(\"abs:href\"));\n     }\n \n     @Test public void classes() {", "timestamp": 1309605128, "metainfo": ""}