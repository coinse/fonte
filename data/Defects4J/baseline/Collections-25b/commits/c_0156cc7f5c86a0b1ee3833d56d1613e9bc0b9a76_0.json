{"sha": "0156cc7f5c86a0b1ee3833d56d1613e9bc0b9a76", "log": "Merging from -r468106:814127 of collections_jdk5_branch - namely where this code was generified; mostly in r738956.  Also see the following revisions:      ------------------------------------------------------------------------     r644140 | skestle | 2008-04-02 19:42:30 -0700 (Wed, 02 Apr 2008) | 1 line          Fixed javac complier generic issues     ------------------------------------------------------------------------     r644138 | skestle | 2008-04-02 19:34:09 -0700 (Wed, 02 Apr 2008) | 1 line          Fixed javac complier generic issues     ------------------------------------------------------------------------     r643795 | skestle | 2008-04-02 01:49:57 -0700 (Wed, 02 Apr 2008) | 5 lines          Generified EqualPredicate and created individual test class moved from TestPredicateUtils          Added assertFalse() and assertTrue to BasicPredicateTestBase with (Predicate, Object) parameters          Issues: COLLECTIONS-243, COLLECTIONS-253, COLLECTIONS-293     ------------------------------------------------------------------------     r643782 | skestle | 2008-04-02 01:00:00 -0700 (Wed, 02 Apr 2008) | 5 lines          Generified NullPredicate and created individual test class moved on TestPredicateUtils          Renamed PredicateTestBase to MockPredicateTestBase to reduce confusion and added BasicPredicateTestBase.          Issues: COLLECTIONS-243, COLLECTIONS-253, COLLECTIONS-293     ------------------------------------------------------------------------     r641231 | skestle | 2008-03-26 02:58:51 -0700 (Wed, 26 Mar 2008) | 1 line          Started incorporating Edwin's patch for COLLECTIONS-253, in preparation for COLLECTIONS-290.     ------------------------------------------------------------------------   ", "commit": "\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/BasicPredicateTestBase.java\n+package org.apache.commons.collections.functors;\n+\n+import org.apache.commons.collections.Predicate;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public abstract class BasicPredicateTestBase {\n+    protected Object cObject;\n+    protected String cString;\n+    protected Integer cInteger;\n+\n+    @Before\n+    public void initialiseTestObjects() throws Exception {\n+        cObject = new Object();\n+        cString = \"Hello\";\n+        cInteger = new Integer(6);\n+    }\n+    \n+    @Test\n+    public void predicateSanityTests() throws Exception {\n+        Predicate<?> predicate = generatePredicate();\n+        Assert.assertNotNull(predicate);\n+    }\n+\n+    /**\n+     * @return a predicate for general sanity tests.\n+     */\n+    protected abstract Predicate<?> generatePredicate();\n+\n+    protected <T> void assertFalse(Predicate<T> predicate, T testObject) {\n+        Assert.assertFalse(predicate.evaluate(testObject));\n+    }\n+\n+    protected <T> void assertTrue(Predicate<T> predicate, T testObject) {\n+        Assert.assertTrue(predicate.evaluate(testObject));\n+    }\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/MockPredicateTestBase.java\n+package org.apache.commons.collections.functors;\n+\n+import static org.easymock.EasyMock.verify;\n+import static org.easymock.EasyMock.replay;\n+import org.junit.Before;\n+import org.junit.After;\n+import org.apache.commons.collections.Predicate;\n+import org.easymock.EasyMock;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Base class for tests of predicates which delegate to other predicates when evaluating an object.  This class\n+ * provides methods to create and verify mock predicates to which to delegate.\n+ *\n+ * @since Commons Collections 3.0\n+ * @version $Revision: 468603 $ $Date: 2006-10-27 17:52:37 -0700 (Fri, 27 Oct 2006) $\n+ *\n+ * @author Edwin Tellman\n+ */\n+public abstract class MockPredicateTestBase<T> {\n+    /**\n+     * Mock predicates created by a single test case which need to be verified after the test completes.\n+     */\n+    private List<Predicate<? super T>> mockPredicatesToVerify;\n+    \n+    /**\n+     * The value to pass to mocks.\n+     */\n+    private final T testValue;\n+\n+    /**\n+     * Creates a new <code>PredicateTestBase</code>.\n+     *\n+     * @param testValue the value to pass to mock predicates.\n+     */\n+    protected MockPredicateTestBase(final T testValue) {\n+        this.testValue = testValue;\n+    }\n+\n+    /**\n+     * Creates the list of predicates to verify.\n+     */\n+    @Before\n+    public final void createVerifyList()\n+    {\n+        mockPredicatesToVerify = new ArrayList<Predicate<? super T>>();\n+    }\n+\n+    /**\n+     * Verifies all the mock predicates created for the test.\n+     */\n+    @After\n+    public final void verifyPredicates()\n+    {\n+        for (Predicate<? super T> predicate : mockPredicatesToVerify) {\n+            verify(predicate);\n+        }\n+    }\n+\n+    /**\n+     * Gets the value which will be passed to the mock predicates.\n+     *\n+     * @return the test value.\n+     */\n+    protected final T getTestValue() {\n+        return testValue;\n+    }\n+\n+    /**\n+     * Creates a single mock predicate.\n+     *\n+     * @param returnValue the return value for the mock predicate, or null if the mock is not expected to be called.\n+     *\n+     * @return a single mock predicate.\n+     */\n+    @SuppressWarnings({\"unchecked\"})\n+    protected final Predicate<T> createMockPredicate(final Boolean returnValue) {\n+        final Predicate<T> mockPredicate = EasyMock.createMock(Predicate.class);\n+        if (returnValue != null) {\n+            EasyMock.expect(mockPredicate.evaluate(testValue)).andReturn(returnValue);\n+        }\n+        replay(mockPredicate);\n+        mockPredicatesToVerify.add(mockPredicate);\n+\n+        return mockPredicate;\n+    }\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/TestAll.java\n+package org.apache.commons.collections.functors;\n+\n+import junit.framework.TestCase;\n+\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Suite;\n+import org.junit.runners.Suite.SuiteClasses;\n+\n+/**\n+ * Entry point for all Functors package tests.\n+ *\n+ * @version $Revision: 471163 $ $Date: 2006-11-04 02:56:39 -0800 (Sat, 04 Nov 2006) $\n+ *\n+ * @author Edwin Tellman\n+ */\n+@RunWith(Suite.class)\n+@SuiteClasses({TestAllPredicate.class,\n+    TestEqualPredicate.class,\n+    TestNullPredicate.class})\n+public class TestAll extends TestCase {\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/TestAllPredicate.java\n+package org.apache.commons.collections.functors;\n+\n+import junit.framework.JUnit4TestAdapter;\n+import org.apache.commons.collections.Predicate;\n+\n+import static org.apache.commons.collections.functors.AllPredicate.allPredicate;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+import org.junit.Test;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+/**\n+ * Tests the org.apache.commons.collections.functors.AllPredicate class.\n+ *\n+ * @since Commons Collections 3.0\n+ * @version $Revision: 468603 $ $Date: 2006-10-27 17:52:37 -0700 (Fri, 27 Oct 2006) $\n+ *\n+ * @author Edwin Tellman\n+ */\n+public class TestAllPredicate extends TestAnyAllOnePredicate<Integer> {\n+\n+    /**\n+     * Creates a JUnit3 test suite.\n+     *\n+     * @return a JUnit3 test suite\n+     */\n+    public static junit.framework.Test suite() {\n+        return new JUnit4TestAdapter(TestAllPredicate.class);\n+    }\n+    \n+    /**\n+     * Creates a new <code>TestAllPredicate</code>.\n+     */\n+    public TestAllPredicate() {\n+        super(42);\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    protected final Predicate<Integer> getPredicateInstance(final Predicate<? super Integer> ... predicates) {\n+        return AllPredicate.allPredicate(predicates);\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */    \n+    @Override\n+    protected final Predicate<Integer> getPredicateInstance(final Collection<Predicate<Integer>> predicates) {\n+        return AllPredicate.allPredicate(predicates);\n+    }\n+\n+    /**\n+     * Verifies that providing an empty predicate array evaluates to true.\n+     */\n+    @SuppressWarnings({\"unchecked\"})\n+    @Test\n+    public void emptyArrayToGetInstance() {\n+        assertTrue(\"empty array not true\", getPredicateInstance(new Predicate[] {}).evaluate(null));\n+    }\n+\n+    /**\n+     * Verifies that providing an empty predicate collection evaluates to true.\n+     */\n+    @Test\n+    public void emptyCollectionToGetInstance() {\n+        final Predicate<Integer> allPredicate = getPredicateInstance(\n+                Collections.<Predicate<Integer>>emptyList());\n+        assertTrue(\"empty collection not true\", allPredicate.evaluate(getTestValue()));\n+    }\n+\n+    /**\n+     * Tests whether a single true predicate evaluates to true.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Test\n+    public void oneTruePredicate() {\n+        // use the constructor directly, as getInstance() returns the original predicate when passed\n+        // an array of size one.\n+        final Predicate<Integer> predicate = createMockPredicate(true);\n+        \n+        assertTrue(\"single true predicate evaluated to false\",\n+                allPredicate(predicate).evaluate(getTestValue()));\n+    }\n+\n+    /**\n+     * Tests whether a single false predicate evaluates to true.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Test\n+    public void oneFalsePredicate() {\n+        // use the constructor directly, as getInstance() returns the original predicate when passed\n+        // an array of size one.\n+        final Predicate<Integer> predicate = createMockPredicate(false);\n+        assertFalse(\"single false predicate evaluated to true\",\n+                allPredicate(predicate).evaluate(getTestValue()));\n+    }\n+\n+    /**\n+     * Tests whether multiple true predicates evaluates to true.\n+     */\n+    @Test\n+    public void allTrue() {\n+        assertTrue(\"multiple true predicates evaluated to false\",\n+                getPredicateInstance(true, true).evaluate(getTestValue()));\n+        assertTrue(\"multiple true predicates evaluated to false\",\n+                getPredicateInstance(true, true, true).evaluate(getTestValue()));\n+    }\n+\n+    /**\n+     * Tests whether combining some true and one false evalutes to false.  Also verifies that only the first\n+     * false predicate is actually evaluated\n+     */\n+    @Test\n+    public void trueAndFalseCombined() {\n+        assertFalse(\"false predicate evaluated to true\",\n+                getPredicateInstance(false, null).evaluate(getTestValue()));\n+        assertFalse(\"false predicate evaluated to true\",\n+                getPredicateInstance(false, null, null).evaluate(getTestValue()));\n+        assertFalse(\"false predicate evaluated to true\",\n+                getPredicateInstance(true, false, null).evaluate(getTestValue()));\n+        assertFalse(\"false predicate evaluated to true\",\n+                getPredicateInstance(true, true, false).evaluate(getTestValue()));\n+        assertFalse(\"false predicate evaluated to true\",\n+                getPredicateInstance(true, true, false, null).evaluate(getTestValue()));\n+    }\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/TestAnyAllOnePredicate.java\n+/*\n+ *  Licensed to the Apache Software Foundation (ASF) under one or more\n+ *  contributor license agreements.  See the NOTICE file distributed with\n+ *  this work for additional information regarding copyright ownership.\n+ *  The ASF licenses this file to You under the Apache License, Version 2.0\n+ *  (the \"License\"); you may not use this file except in compliance with\n+ *  the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.apache.commons.collections.functors;\n+\n+import org.apache.commons.collections.Predicate;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import org.junit.Test;\n+\n+import java.util.Collections;\n+\n+/**\n+ * Base class for tests of AnyPredicate, AllPredicate, and OnePredicate.\n+ *\n+ * @since Commons Collections 3.0\n+ * @version $Revision: 468603 $ $Date: 2006-10-27 17:52:37 -0700 (Fri, 27 Oct 2006) $\n+ *\n+ * @author Edwin Tellman\n+ */\n+public abstract class TestAnyAllOnePredicate<T> extends TestCompositePredicate<T> {\n+\n+    /**\n+     * Creates a new <code>TestCompositePredicate</code>.\n+     *\n+     * @param testValue the value which the mock predicates should expect to see (may be null).\n+     */\n+    protected TestAnyAllOnePredicate(final T testValue) {\n+        super(testValue);\n+    }\n+\n+    /**\n+     * Tests whether <code>getInstance</code> with a one element array returns the first element in the array.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Test\n+    public final void singleElementArrayToGetInstance() {\n+        final Predicate<T> predicate = createMockPredicate(null);\n+        final Predicate<T> allPredicate = getPredicateInstance(predicate);\n+        assertSame(\"expected argument to be returned by getInstance()\", predicate, allPredicate);\n+    }\n+\n+    /**\n+     * Tests that passing a singleton collection to <code>getInstance</code> returns the single element in the\n+     * collection.\n+     */\n+    @Test\n+    public final void singletonCollectionToGetInstance() {\n+        final Predicate<T> predicate = createMockPredicate(null);\n+        final Predicate<T> allPredicate = getPredicateInstance(\n+                Collections.<Predicate<T>>singleton(predicate));\n+        assertSame(\"expected singleton collection member to be returned by getInstance()\",\n+                predicate, allPredicate);\n+    }\n+\n+    /**\n+     * Tests creating composite predicate instances with single predicates and verifies that the composite returns\n+     * the same value as the single predicate does. \n+     */\n+    public final void singleValues() {\n+        assertTrue(getPredicateInstance(true).evaluate(null));\n+        assertFalse(getPredicateInstance(false).evaluate(null));\n+    }\n+\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/TestCompositePredicate.java\n+package org.apache.commons.collections.functors;\n+\n+import org.apache.commons.collections.Predicate;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+\n+\n+/**\n+ * Base class for tests of composite predicates.\n+ *\n+ * @since Commons Collections 3.0\n+ * @version $Revision: 468603 $ $Date: 2006-10-27 17:52:37 -0700 (Fri, 27 Oct 2006) $\n+ *\n+ * @author Edwin Tellman\n+ */\n+public abstract class TestCompositePredicate<T> extends MockPredicateTestBase<T> {\n+\n+    /**\n+     * Creates a new <code>TestCompositePredicate</code>.\n+     *\n+     * @param testValue the value which the mock predicates should expect to see (may be null).\n+     */\n+    protected TestCompositePredicate(final T testValue) {\n+        super(testValue);\n+    }\n+\n+    /**\n+     * Creates an instance of the predicate to test.\n+     *\n+     * @param predicates the arguments to <code>getInstance</code>.\n+     *\n+     * @return a predicate to test.\n+     */\n+    protected abstract Predicate<T> getPredicateInstance(final Predicate<? super T> ... predicates);\n+\n+    /**\n+     * Creates an instance of the predicate to test.\n+     *\n+     * @param predicates the argument to <code>getInstance</code>.\n+     *\n+     * @return a predicate to test.\n+     */\n+    protected abstract Predicate<T> getPredicateInstance(final Collection<Predicate<T>> predicates);\n+\n+    /**\n+     * Creates an instance of the predicate to test.\n+     *\n+     * @param mockReturnValues the return values for the mock predicates, or null if that mock is not expected\n+     *                         to be called\n+     *\n+     * @return a predicate to test.\n+     */\n+    protected final Predicate<T> getPredicateInstance(final Boolean... mockReturnValues) {\n+        final List<Predicate<T>> predicates = new ArrayList<Predicate<T>>();\n+        for (Boolean returnValue : mockReturnValues) {\n+            predicates.add(createMockPredicate(returnValue));\n+        }\n+        return getPredicateInstance(predicates);\n+    }\n+\n+    /**\n+     * Tests whether <code>getInstance</code> with a one element array returns the first element in the array.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    public void singleElementArrayToGetInstance() {\n+        final Predicate<T> predicate = createMockPredicate(null);\n+        final Predicate<T> allPredicate = getPredicateInstance(predicate);\n+        Assert.assertSame(\"expected argument to be returned by getInstance()\", predicate, allPredicate);\n+    }\n+\n+    /**\n+     * Tests that passing a singleton collection to <code>getInstance</code> returns the single element in the\n+     * collection.\n+     */\n+    public void singletonCollectionToGetInstance() {\n+        final Predicate<T> predicate = createMockPredicate(null);\n+        final Predicate<T> allPredicate = getPredicateInstance(\n+                Collections.<Predicate<T>>singleton(predicate));\n+        Assert.assertSame(\"expected argument to be returned by getInstance()\", predicate, allPredicate);\n+    }\n+\n+    /**\n+     * Tests <code>getInstance</code> with a null predicate array.\n+     */\n+    @Test(expected = IllegalArgumentException.class)\n+    public final void nullArrayToGetInstance() {\n+        getPredicateInstance((Predicate<T>[]) null);\n+    }\n+\n+    /**\n+     * Tests <code>getInstance</code> with a single null element in the predicate array.\n+     */\n+    @SuppressWarnings({\"unchecked\"})\n+    @Test(expected = IllegalArgumentException.class)\n+    public final void nullElementInArrayToGetInstance() {\n+        getPredicateInstance(new Predicate[] { null });\n+    }\n+\n+    /**\n+     * Tests <code>getInstance</code> with two null elements in the predicate array.\n+     */\n+    @SuppressWarnings({\"unchecked\"})\n+    @Test(expected = IllegalArgumentException.class)\n+    public final void nullElementsInArrayToGetInstance() {\n+        getPredicateInstance(new Predicate[] { null, null });\n+    }\n+\n+\n+    /**\n+     * Tests <code>getInstance</code> with a null predicate collection\n+     */\n+    @Test(expected = IllegalArgumentException.class)\n+    public final void nullCollectionToGetInstance() {\n+        getPredicateInstance((Collection<Predicate<T>>) null);\n+    }\n+\n+    /**\n+     * Tests <code>getInstance</code> with a predicate collection that contains null elements\n+     */\n+    @Test(expected = IllegalArgumentException.class)\n+    public final void nullElementsInCollectionToGetInstance() {\n+        final Collection<Predicate<T>> coll = new ArrayList<Predicate<T>>();\n+        coll.add(null);\n+        coll.add(null);\n+        getPredicateInstance(coll);\n+    }\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/TestEqualPredicate.java\n+package org.apache.commons.collections.functors;\n+\n+import static org.apache.commons.collections.functors.EqualPredicate.equalPredicate;\n+import static org.apache.commons.collections.functors.NullPredicate.nullPredicate;\n+import static org.junit.Assert.assertSame;\n+\n+import org.apache.commons.collections.Predicate;\n+import org.junit.Test;\n+\n+\n+public class TestEqualPredicate extends BasicPredicateTestBase {\n+    private static final EqualsTestObject FALSE_OBJECT = new EqualsTestObject(false);\n+    private static final EqualsTestObject TRUE_OBJECT = new EqualsTestObject(true);\n+\n+    @Override\n+    protected Predicate<Object> generatePredicate() {\n+       return equalPredicate(null);\n+    }\n+    \n+    @Test\n+    public void testNullArgumentEqualsNullPredicate() throws Exception {\n+        assertSame(nullPredicate(), equalPredicate(null));\n+    }\n+    \n+    @Test\n+    public void objectFactoryUsesEqualsForTest() throws Exception {\n+        Predicate<EqualsTestObject> predicate = equalPredicate(FALSE_OBJECT);\n+        assertFalse(predicate, FALSE_OBJECT);\n+        assertTrue(equalPredicate(TRUE_OBJECT), TRUE_OBJECT);\n+    }\n+    \n+    @Test\n+    public void testPredicateTypeCanBeSuperClassOfObject() throws Exception {\n+        Predicate<Number> predicate = equalPredicate((Number) 4);\n+        assertTrue(predicate, 4);\n+    }\n+\n+    public static class EqualsTestObject {\n+        private final boolean b;\n+\n+        public EqualsTestObject(boolean b) {\n+            this.b = b;\n+        }\n+        \n+        @Override\n+        public boolean equals(Object obj) {\n+            return b;\n+        }\n+    }\n+}\n--- /dev/null\n+++ b/src/test/org/apache/commons/collections/functors/TestNullPredicate.java\n+package org.apache.commons.collections.functors;\n+\n+import static org.apache.commons.collections.functors.NullPredicate.nullPredicate;\n+import static org.junit.Assert.assertSame;\n+\n+import org.apache.commons.collections.Predicate;\n+import org.junit.Test;\n+\n+\n+public class TestNullPredicate extends BasicPredicateTestBase {\n+    @Test\n+    public void testNullPredicate() {\n+        assertSame(NullPredicate.nullPredicate(), NullPredicate.nullPredicate());\n+        assertTrue(nullPredicate(), null);\n+    }\n+    \n+    public void ensurePredicateCanBeTypedWithoutWarning() throws Exception {\n+        Predicate<String> predicate = NullPredicate.nullPredicate();\n+        assertFalse(predicate, cString);\n+    }\n+\n+    @Override\n+    protected Predicate<?> generatePredicate() {\n+        return nullPredicate();\n+    }    \n+}", "timestamp": 1252994225, "metainfo": ""}