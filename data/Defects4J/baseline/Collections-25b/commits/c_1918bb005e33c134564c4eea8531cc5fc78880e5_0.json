{"sha": "1918bb005e33c134564c4eea8531cc5fc78880e5", "log": "[COLLECTIONS-556] Added method SetUtils.identityHashSet.  ", "commit": "\n--- a/src/main/java/org/apache/commons/collections4/SetUtils.java\n+++ b/src/main/java/org/apache/commons/collections4/SetUtils.java\n \n import java.util.Collection;\n import java.util.Collections;\n+import java.util.IdentityHashMap;\n import java.util.Set;\n import java.util.SortedSet;\n import java.util.TreeSet;\n             }\n         }\n         return hashCode;\n+    }\n+\n+    /**\n+     * Returns a new hash set that matches elements based on <code>==</code> not\n+     * <code>equals()</code>.\n+     * <p>\n+     * <strong>This set will violate the detail of various Set contracts.</note>\n+     * As a general rule, don't compare this set to other sets. In particular, you can't\n+     * use decorators like {@link ListOrderedSet} on it, which silently assume that these\n+     * contracts are fulfilled.</strong>\n+     * <p>\n+     * <strong>Note that the returned set is not synchronized and is not thread-safe.</strong>\n+     * If you wish to use this set from multiple threads concurrently, you must use\n+     * appropriate synchronization. The simplest approach is to wrap this map\n+     * using {@link java.util.Collections#synchronizedSet(Set)}. This class may throw\n+     * exceptions when accessed by concurrent threads without synchronization.\n+     *\n+     * @return a new identity hash set\n+     * @since 4.1\n+     */\n+    public static <E> Set<E> identityHashSet() {\n+        return Collections.newSetFromMap(new IdentityHashMap<E, Boolean>());\n     }\n \n     //-----------------------------------------------------------------------\n      * avoid non-deterministic behavior:\n      *\n      * <pre>\n-     * Set s = SetUtils.synchronizedSet(mySet);\n+     * Set s = SetUtils.synchronizedSortedSet(mySet);\n      * synchronized (s) {\n      *     Iterator i = s.iterator();\n      *     while (i.hasNext()) {\n--- a/src/test/java/org/apache/commons/collections4/SetUtilsTest.java\n+++ b/src/test/java/org/apache/commons/collections4/SetUtilsTest.java\n         assertEquals(0, SetUtils.hashCodeForSet(null));\n     }\n \n+    public void testIdentityHashSet() {\n+        Set<String> set = SetUtils.identityHashSet();\n+        String a = new String(\"a\");\n+        set.add(a);\n+        set.add(new String(\"b\"));\n+        set.add(a);\n+        \n+        assertEquals(2, set.size());\n+        \n+        set.add(new String(\"a\"));\n+        assertEquals(3, set.size());\n+        \n+        set.remove(a);\n+        assertEquals(2, set.size());\n+    }\n }", "timestamp": 1432581530, "metainfo": ""}