{"sha": "3c1749c51b1aa4ab029922d6f4d2129b15fab9a8", "log": "Make unmodifiable maps Serializable [18815]   ", "commit": "\n--- a/src/java/org/apache/commons/collections/map/UnmodifiableOrderedMap.java\n+++ b/src/java/org/apache/commons/collections/map/UnmodifiableOrderedMap.java\n  */\n package org.apache.commons.collections.map;\n \n+import java.io.IOException;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n+import java.io.Serializable;\n import java.util.Collection;\n import java.util.Map;\n import java.util.Set;\n \n /**\n  * Decorates another <code>OrderedMap</code> to ensure it can't be altered.\n+ * <p>\n+ * This class is Serializable from Commons Collections 3.1.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.7 $ $Date: 2004/02/18 01:13:19 $\n+ * @version $Revision: 1.8 $ $Date: 2004/04/09 10:46:32 $\n  * \n  * @author Stephen Colebourne\n  */\n public final class UnmodifiableOrderedMap\n-        extends AbstractOrderedMapDecorator implements Unmodifiable {\n+        extends AbstractOrderedMapDecorator\n+        implements Unmodifiable, Serializable {\n+\n+    /** Serialization version */\n+    private static final long serialVersionUID = 8136428161720526266L;\n \n     /**\n      * Factory method to create an unmodifiable sorted map.\n      */\n     private UnmodifiableOrderedMap(OrderedMap map) {\n         super(map);\n+    }\n+\n+    //-----------------------------------------------------------------------\n+    /**\n+     * Write the map out using a custom routine.\n+     * \n+     * @param out  the output stream\n+     * @throws IOException\n+     * @since Commons Collections 3.1\n+     */\n+    private void writeObject(ObjectOutputStream out) throws IOException {\n+        out.defaultWriteObject();\n+        out.writeObject(map);\n+    }\n+\n+    /**\n+     * Read the map in using a custom routine.\n+     * \n+     * @param in  the input stream\n+     * @throws IOException\n+     * @throws ClassNotFoundException\n+     * @since Commons Collections 3.1\n+     */\n+    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n+        in.defaultReadObject();\n+        map = (Map) in.readObject();\n     }\n \n     //-----------------------------------------------------------------------\n--- a/src/java/org/apache/commons/collections/map/UnmodifiableSortedMap.java\n+++ b/src/java/org/apache/commons/collections/map/UnmodifiableSortedMap.java\n  */\n package org.apache.commons.collections.map;\n \n+import java.io.IOException;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n+import java.io.Serializable;\n import java.util.Collection;\n import java.util.Comparator;\n import java.util.Map;\n \n /**\n  * Decorates another <code>SortedMap</code> to ensure it can't be altered.\n+ * <p>\n+ * This class is Serializable from Commons Collections 3.1.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.6 $ $Date: 2004/02/18 01:13:19 $\n+ * @version $Revision: 1.7 $ $Date: 2004/04/09 10:46:32 $\n  * \n  * @author Stephen Colebourne\n  */\n public final class UnmodifiableSortedMap\n-        extends AbstractSortedMapDecorator implements Unmodifiable {\n+        extends AbstractSortedMapDecorator\n+        implements Unmodifiable, Serializable {\n+\n+    /** Serialization version */\n+    private static final long serialVersionUID = 5805344239827376360L;\n \n     /**\n      * Factory method to create an unmodifiable sorted map.\n      */\n     private UnmodifiableSortedMap(SortedMap map) {\n         super(map);\n+    }\n+\n+    //-----------------------------------------------------------------------\n+    /**\n+     * Write the map out using a custom routine.\n+     * \n+     * @param out  the output stream\n+     * @throws IOException\n+     * @since Commons Collections 3.1\n+     */\n+    private void writeObject(ObjectOutputStream out) throws IOException {\n+        out.defaultWriteObject();\n+        out.writeObject(map);\n+    }\n+\n+    /**\n+     * Read the map in using a custom routine.\n+     * \n+     * @param in  the input stream\n+     * @throws IOException\n+     * @throws ClassNotFoundException\n+     * @since Commons Collections 3.1\n+     */\n+    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n+        in.defaultReadObject();\n+        map = (Map) in.readObject();\n     }\n \n     //-----------------------------------------------------------------------\n--- a/src/test/org/apache/commons/collections/map/TestUnmodifiableMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestUnmodifiableMap.java\n  * {@link UnmodifiableMap} implementation.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.9 $ $Date: 2004/04/09 10:32:25 $\n+ * @version $Revision: 1.10 $ $Date: 2004/04/09 10:46:32 $\n  * \n  * @author Phil Steitz\n  */\n         return \"3.1\";\n     }\n \n-    public void testCreate() throws Exception {\n-        resetEmpty();\n-        writeExternalFormToDisk(\n-            (java.io.Serializable) map,\n-            \"D:/dev/collections/data/test/UnmodifiableMap.emptyCollection.version3.1.obj\");\n-        resetFull();\n-        writeExternalFormToDisk(\n-            (java.io.Serializable) map,\n-            \"D:/dev/collections/data/test/UnmodifiableMap.fullCollection.version3.1.obj\");\n-    }\n+//    public void testCreate() throws Exception {\n+//        resetEmpty();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/UnmodifiableMap.emptyCollection.version3.1.obj\");\n+//        resetFull();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/UnmodifiableMap.fullCollection.version3.1.obj\");\n+//    }\n }\n--- a/src/test/org/apache/commons/collections/map/TestUnmodifiableOrderedMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestUnmodifiableOrderedMap.java\n  * {@link UnmodifiableOrderedMap} implementation.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.4 $ $Date: 2004/02/18 01:20:38 $\n+ * @version $Revision: 1.5 $ $Date: 2004/04/09 10:46:32 $\n  * \n  * @author Stephen Colebourne\n  */\n         } catch (IllegalArgumentException ex) {}\n     }\n \n+    public String getCompatibilityVersion() {\n+        return \"3.1\";\n+    }\n+\n+//    public void testCreate() throws Exception {\n+//        resetEmpty();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/UnmodifiableOrderedMap.emptyCollection.version3.1.obj\");\n+//        resetFull();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/UnmodifiableOrderedMap.fullCollection.version3.1.obj\");\n+//    }\n }\n--- a/src/test/org/apache/commons/collections/map/TestUnmodifiableSortedMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestUnmodifiableSortedMap.java\n  * {@link UnmodifiableSortedMap} implementation.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.3 $ $Date: 2004/02/18 01:20:37 $\n+ * @version $Revision: 1.4 $ $Date: 2004/04/09 10:46:32 $\n  * \n  * @author Stephen Colebourne\n  */\n         } catch (IllegalArgumentException ex) {}\n     }\n \n+    public String getCompatibilityVersion() {\n+        return \"3.1\";\n+    }\n+\n+//    public void testCreate() throws Exception {\n+//        resetEmpty();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/UnmodifiableSortedMap.emptyCollection.version3.1.obj\");\n+//        resetFull();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/UnmodifiableSortedMap.fullCollection.version3.1.obj\");\n+//    }\n }", "timestamp": 1081507592, "metainfo": ""}