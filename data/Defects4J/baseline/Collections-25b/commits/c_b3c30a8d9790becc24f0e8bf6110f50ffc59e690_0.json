{"sha": "b3c30a8d9790becc24f0e8bf6110f50ffc59e690", "log": "Make FixedSizeSortedMap Serializable [18815]   ", "commit": "\n--- a/src/java/org/apache/commons/collections/map/FixedSizeSortedMap.java\n+++ b/src/java/org/apache/commons/collections/map/FixedSizeSortedMap.java\n  */\n package org.apache.commons.collections.map;\n \n+import java.io.IOException;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n+import java.io.Serializable;\n import java.util.Collection;\n import java.util.Iterator;\n import java.util.Map;\n  * is not always unsupported.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.5 $ $Date: 2004/02/18 01:13:19 $\n+ * @version $Revision: 1.6 $ $Date: 2004/04/02 23:12:34 $\n  * \n  * @author Stephen Colebourne\n  * @author Paul Jack\n  */\n public class FixedSizeSortedMap\n-        extends AbstractSortedMapDecorator implements SortedMap, BoundedMap {\n+        extends AbstractSortedMapDecorator\n+        implements SortedMap, BoundedMap, Serializable {\n \n     /**\n      * Factory method to create a fixed size sorted map.\n         super(map);\n     }\n \n+    //-----------------------------------------------------------------------\n     /**\n-     * Gets the map being decorated.\n-     * \n-     * @return the decorated map\n+     * Write the map out using a custom routine.\n      */\n-    protected SortedMap getSortedMap() {\n-        return (SortedMap) map;\n+    private void writeObject(ObjectOutputStream out) throws IOException {\n+        out.defaultWriteObject();\n+        out.writeObject(map);\n+    }\n+\n+    /**\n+     * Read the map in using a custom routine.\n+     */\n+    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n+        in.defaultReadObject();\n+        map = (Map) in.readObject();\n     }\n \n     //-----------------------------------------------------------------------\n--- a/src/test/org/apache/commons/collections/map/TestFixedSizeSortedMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestFixedSizeSortedMap.java\n  * implementation.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.5 $ $Date: 2004/02/18 01:20:38 $\n+ * @version $Revision: 1.6 $ $Date: 2004/04/02 23:12:34 $\n  * \n  * @author Stephen Colebourne\n  */\n         return false;\n     }\n \n+    public String getCompatibilityVersion() {\n+        return \"3.1\";\n+    }\n+    \n+    public String[] ignoredTests() {\n+        // TreeMap has a bug (it doesn't deserialize SubMaps properly), thus ignore...\n+        return new String [] {\n+            \"TestFixedSizeSortedMap.bulkTestHeadMap.testEmptyMapCompatibility\",\n+            \"TestFixedSizeSortedMap.bulkTestHeadMap.testFullMapCompatibility\",\n+            \"TestFixedSizeSortedMap.bulkTestHeadMap.testSerializeDeserializeThenCompare\",\n+            \"TestFixedSizeSortedMap.bulkTestTailMap.testEmptyMapCompatibility\",\n+            \"TestFixedSizeSortedMap.bulkTestTailMap.testFullMapCompatibility\",\n+            \"TestFixedSizeSortedMap.bulkTestTailMap.testSerializeDeserializeThenCompare\",\n+            \"TestFixedSizeSortedMap.bulkTestSubMap.testEmptyMapCompatibility\",\n+            \"TestFixedSizeSortedMap.bulkTestSubMap.testFullMapCompatibility\",\n+            \"TestFixedSizeSortedMap.bulkTestSubMap.testSerializeDeserializeThenCompare\",\n+        };\n+    }\n+\n+//    public void testCreate() throws Exception {\n+//        resetEmpty();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/FixedSizeSortedMap.emptyCollection.version3.1.obj\");\n+//        resetFull();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/FixedSizeSortedMap.fullCollection.version3.1.obj\");\n+//    }\n }", "timestamp": 1080947554, "metainfo": ""}