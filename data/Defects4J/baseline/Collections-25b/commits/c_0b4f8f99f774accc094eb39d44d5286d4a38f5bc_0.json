{"sha": "0b4f8f99f774accc094eb39d44d5286d4a38f5bc", "log": "Fixed bug in iterator remove. Shift operation was not incrementing indexes properly.  Also improved documentation. BZ #33071 Reported by: Amir Tahvildaran   ", "commit": "\n--- a/src/java/org/apache/commons/collections/buffer/BoundedFifoBuffer.java\n+++ b/src/java/org/apache/commons/collections/buffer/BoundedFifoBuffer.java\n  * This class is Serializable from Commons Collections 3.1.\n  *\n  * @since Commons Collections 3.0 (previously in main package v2.1)\n- * @version $Revision: 1.9 $ $Date: 2004/10/16 22:23:40 $\n+ * @version $Revision: 1.10 $ $Date: 2005/01/15 22:47:40 $\n  * \n  * @author Avalon\n  * @author Berin Loritsch\n     /** Serialization version */\n     private static final long serialVersionUID = 5603722811189451017L;\n \n+    /** Underlying storage array */\n     private transient Object[] elements;\n+    \n+    /** Array index of first (oldest) buffer element */\n     private transient int start = 0;\n+    \n+    /** \n+     * Index mod maxElements of the array position following the last buffer\n+     * element.  Buffer elements start at elements[start] and \"wrap around\"\n+     * elements[maxElements-1], ending at elements[decrement(end)].  \n+     * For example, elements = {c,a,b}, start=1, end=1 corresponds to \n+     * the buffer [a,b,c].\n+     */\n     private transient int end = 0;\n+    \n     private transient boolean full = false;\n+    \n+    /** Capacity of the buffer */\n     private final int maxElements;\n \n     /**\n                         elements[i - 1] = elements[0];\n                         i = 0;\n                     } else {\n-                        elements[i - 1] = elements[i];\n-                        i++;\n+                        elements[decrement(i)] = elements[i];\n+                        i = increment(i);\n                     }\n                 }\n \n--- a/src/test/org/apache/commons/collections/buffer/TestBoundedFifoBuffer.java\n+++ b/src/test/org/apache/commons/collections/buffer/TestBoundedFifoBuffer.java\n /**\n  * Test cases for BoundedFifoBuffer.\n  * \n- * @version $Revision: 1.4 $ $Date: 2004/06/02 23:12:45 $\n+ * @version $Revision: 1.5 $ $Date: 2005/01/15 22:47:40 $\n  * \n  * @author Paul Jack\n  */\n     public String getCompatibilityVersion() {\n         return \"3.1\";\n     }\n+    \n+    // BZ 33071 -- gets start=end=1 before removal of interior element\n+    public void testShift() {\n+        BoundedFifoBuffer fifo = new BoundedFifoBuffer(3);\n+        fifo.add(\"a\");\n+        fifo.add(\"b\");\n+        fifo.add(\"c\");\n+        fifo.remove();\n+        fifo.add(\"e\");\n+        fifo.remove(\"c\");\n+    }\n \n //    public void testCreate() throws Exception {\n //        resetEmpty();", "timestamp": 1105829261, "metainfo": ""}