{"sha": "1e85878fe008f6c651c348dd1d5b2edf713f63bb", "log": "In HTML whitelists, when defining allowed attributes for a tag, automatically add the tag to the allowed list.  Fixes #192.", "commit": "\n--- a/src/main/java/org/jsoup/safety/Whitelist.java\n+++ b/src/main/java/org/jsoup/safety/Whitelist.java\n     /**\n      Add a list of allowed attributes to a tag. (If an attribute is not allowed on an element, it will be removed.)\n      <p/>\n+     E.g.: <code>addAttributes(\"a\", \"href\", \"class\")</code> allows <code>href</code> and <code>class</code> attributes\n+     on <code>a</code> tags.\n+     <p/>\n      To make an attribute valid for <b>all tags</b>, use the pseudo tag <code>:all</code>, e.g.\n      <code>addAttributes(\":all\", \"class\")</code>.\n \n-     @param tag  The tag the attributes are for\n+     @param tag  The tag the attributes are for. The tag will be added to the allowed tag list if necessary.\n      @param keys List of valid attributes for the tag\n      @return this (for chaining)\n      */\n     public Whitelist addAttributes(String tag, String... keys) {\n         Validate.notEmpty(tag);\n         Validate.notNull(keys);\n+        Validate.isTrue(keys.length > 0, \"No attributes supplied.\");\n \n         TagName tagName = TagName.valueOf(tag);\n+        if (!tagNames.contains(tagName))\n+            tagNames.add(tagName);\n         Set<AttributeKey> attributeSet = new HashSet<AttributeKey>();\n         for (String key : keys) {\n             Validate.notEmpty(key);\n      E.g.: <code>addEnforcedAttribute(\"a\", \"rel\", \"nofollow\")</code> will make all <code>a</code> tags output as\n      <code>&lt;a href=\"...\" rel=\"nofollow\"></code>\n \n-     @param tag   The tag the enforced attribute is for\n+     @param tag   The tag the enforced attribute is for. The tag will be added to the allowed tag list if necessary.\n      @param key   The attribute key\n      @param value The enforced attribute value\n      @return this (for chaining)\n         Validate.notEmpty(value);\n \n         TagName tagName = TagName.valueOf(tag);\n+        if (!tagNames.contains(tagName))\n+            tagNames.add(tagName);\n         AttributeKey attrKey = AttributeKey.valueOf(key);\n         AttributeValue attrVal = AttributeValue.valueOf(value);\n \n--- a/src/test/java/org/jsoup/safety/CleanerTest.java\n+++ b/src/test/java/org/jsoup/safety/CleanerTest.java\n         String clean = Jsoup.clean(html, whitelist);\n         assertEquals(\"<p class=\\\"foo\\\"><a class=\\\"qux\\\">link</a></p>\", clean);\n     }\n+\n+    @Test public void addsTagOnAttributesIfNotSet() {\n+        String html = \"<p class='foo' src='bar'>One</p>\";\n+        Whitelist whitelist = new Whitelist()\n+            .addAttributes(\"p\", \"class\");\n+        // ^^ whitelist does not have explicit tag add for p, inferred from add attributes.\n+        String clean = Jsoup.clean(html, whitelist);\n+        assertEquals(\"<p class=\\\"foo\\\">One</p>\", clean);\n+    }\n }", "timestamp": 1338068428, "metainfo": ""}