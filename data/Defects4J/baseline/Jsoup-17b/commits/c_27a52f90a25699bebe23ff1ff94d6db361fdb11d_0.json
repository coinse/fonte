{"sha": "27a52f90a25699bebe23ff1ff94d6db361fdb11d", "log": "Fix an issue where text order was incorrect when parsing pre-document HTML.  Fixes #23", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Document.java\n+++ b/src/main/java/org/jsoup/nodes/Document.java\n         if (body() == null)\n             select(\"html\").first().appendElement(\"body\");\n \n-        normalise(this);\n+        // pull text nodes out of root, html, and head els, and push into body. non-text nodes are already taken care\n+        // of. do in inverse order to maintain text order.\n+        normalise(head());\n         normalise(select(\"html\").first());\n-        normalise(head());\n+        normalise(this);        \n \n         return this;\n     }\n \n-    // does not recurse. the result order isn't great here (not intuitive); they are in the body though.\n+    // does not recurse.\n     private void normalise(Element element) {\n         List<Node> toMove = new ArrayList<Node>();\n         for (Node node: element.childNodes) {\n \n         for (Node node: toMove) {\n             element.removeChild(node);\n-            body().appendChild(new TextNode(\" \", \"\"));\n-            body().appendChild(node);\n+            body().prependChild(node);\n+            body().prependChild(new TextNode(\" \", \"\"));\n         }\n     }\n \n--- a/src/test/java/org/jsoup/parser/ParserTest.java\n+++ b/src/test/java/org/jsoup/parser/ParserTest.java\n         assertEquals(\"Hello world\", body.children().get(0).text());\n     }\n \n+    @Test public void createsStructureFromBodySnippet() {\n+        // the bar baz stuff naturally goes into the body, but the 'foo' goes into root, and the normalisation routine\n+        // needs to move into the start of the body\n+        String html = \"foo <b>bar</b> baz\";\n+        Document doc = Jsoup.parse(html);\n+        assertEquals (\"foo bar baz\", doc.text());\n+\n+    }\n+\n     @Test public void handlesEscapedData() {\n         String html = \"<div title='Surf &amp; Turf'>Reef &amp; Beef</div>\";\n         Document doc = Jsoup.parse(html);", "timestamp": 1309605113, "metainfo": ""}