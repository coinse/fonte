{"sha": "3a7cf58e48ee6d7cd63c030002777d9ee1ca4446", "log": "Fix [JACKSON-757]", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/databind/introspect/AnnotatedClass.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/introspect/AnnotatedClass.java\n          * (for non-static inner classes) are NOT included, but type is? Strange, sounds like\n          * a bug. Alas, we can't really fix that...\n          */\n-        AnnotationMap[] resolvedAnnotations;\n+        // Also: [JACKSON-767] (enum value constructors)\n+        AnnotationMap[] resolvedAnnotations = null;\n         if (paramCount != paramAnns.length) {\n-            // only cover one \"missing\" annotation, and only for member classes; to try to avoid\n-            // false \"fixes\" for possible other error cases\n-            if (ctor.getDeclaringClass().isMemberClass() &&  paramCount == (paramAnns.length + 1)) {\n-                // hack attack: prepend a null entry to make things match\n-                Annotation[][] old = paramAnns;\n-                paramAnns = new Annotation[old.length+1][];\n-                System.arraycopy(old, 0, paramAnns, 1, old.length);\n-                resolvedAnnotations = _collectRelevantAnnotations(paramAnns);\n-            } else {\n+            // Limits of the work-around (to avoid hiding real errors):\n+            // first, only applicable for member classes and then either:\n+\n+            Class<?> dc = ctor.getDeclaringClass();\n+            if (dc.isMemberClass()) {\n+                // (a) just one annotation (for non-static inner classes)\n+                if (paramCount == (paramAnns.length + 1)) {\n+                    // hack attack: prepend a null entry to make things match\n+                    Annotation[][] old = paramAnns;\n+                    paramAnns = new Annotation[old.length+1][];\n+                    System.arraycopy(old, 0, paramAnns, 1, old.length);\n+                    resolvedAnnotations = _collectRelevantAnnotations(paramAnns);\n+\n+                    // (b) or is enum, which have two extra hidden params (but not for annotations!)\n+                } else if (dc.isEnum() && (paramCount == paramAnns.length + 2)) {\n+                    Annotation[][] old = paramAnns;\n+                    paramAnns = new Annotation[old.length+2][];\n+                    System.arraycopy(old, 0, paramAnns, 2, old.length);\n+                    resolvedAnnotations = _collectRelevantAnnotations(paramAnns);\n+                }\n+            }\n+            if (resolvedAnnotations == null) {\n                 throw new IllegalStateException(\"Internal error: constructor for \"+ctor.getDeclaringClass().getName()\n                         +\" has mismatch: \"+paramCount+\" parameters; \"+paramAnns.length+\" sets of annotations\");\n             }", "timestamp": 1326838150, "metainfo": ""}