{"sha": "bc483d1f562814ffd3b37bd8c74d5ca5e615865b", "log": "Fix [JACKSON-851], problems with ObjectWriter, DefaultPrettyPrinter", "commit": "\n--- a/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\n \n     protected final static VisibilityChecker<?> STD_VISIBILITY_CHECKER = VisibilityChecker.Std.defaultInstance();\n \n+    protected final static PrettyPrinter _defaultPrettyPrinter = new DefaultPrettyPrinter();\n+    \n     /**\n      * Base settings contain defaults used for all {@link ObjectMapper}\n      * instances.\n      * to use default pretty printer.\n      */\n     protected PrettyPrinter _defaultPrettyPrinter() {\n-        return new DefaultPrettyPrinter();\n+        return _defaultPrettyPrinter;\n     }\n     \n     /**\n--- a/src/main/java/com/fasterxml/jackson/databind/ObjectWriter.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ObjectWriter.java\n import com.fasterxml.jackson.core.type.TypeReference;\n import com.fasterxml.jackson.core.util.ByteArrayBuilder;\n import com.fasterxml.jackson.core.util.DefaultPrettyPrinter;\n+import com.fasterxml.jackson.core.util.Instantiatable;\n import com.fasterxml.jackson.core.util.MinimalPrettyPrinter;\n import com.fasterxml.jackson.databind.cfg.DatabindVersion;\n import com.fasterxml.jackson.databind.ser.DefaultSerializerProvider;\n     {\n         if (_prettyPrinter != null) {\n             PrettyPrinter pp = _prettyPrinter;\n-            jgen.setPrettyPrinter((pp == NULL_PRETTY_PRINTER) ? null : pp);\n+            if (pp == NULL_PRETTY_PRINTER) {\n+                jgen.setPrettyPrinter(null);\n+            } else {\n+                /* [JACKSON-851]: Better take care of stateful PrettyPrinters...\n+                 *   like the DefaultPrettyPrinter.\n+                 */\n+                if (pp instanceof Instantiatable<?>) {\n+                    pp = (PrettyPrinter) ((Instantiatable<?>) pp).createInstance();\n+                }\n+                jgen.setPrettyPrinter(pp);\n+            }\n         } else if (_config.isEnabled(SerializationFeature.INDENT_OUTPUT)) {\n             jgen.useDefaultPrettyPrinter();\n         }", "timestamp": 1343889359, "metainfo": ""}