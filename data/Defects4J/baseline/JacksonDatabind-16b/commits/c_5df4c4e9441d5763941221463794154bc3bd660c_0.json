{"sha": "5df4c4e9441d5763941221463794154bc3bd660c", "log": "Update notes wrt #353", "commit": "\n--- a/src/test/java/com/fasterxml/jackson/databind/node/TestTreeWithType.java\n+++ b/src/test/java/com/fasterxml/jackson/databind/node/TestTreeWithType.java\n import com.fasterxml.jackson.annotation.JsonTypeInfo;\n import com.fasterxml.jackson.core.*;\n import com.fasterxml.jackson.databind.*;\n+import com.fasterxml.jackson.databind.jsontype.TypeDeserializer;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n \n public class TestTreeWithType extends BaseMapTest\n {\n         }\n     }\n \n+    // [Issue#353]\n+    public class SavedCookie {\n+        public String name, value;\n+\n+        public SavedCookie() { }\n+        public SavedCookie(String n, String v) {\n+            name = n;\n+            value = v;\n+        }\n+    }\n+\n+    public class SavedCookieDeserializer extends JsonDeserializer<SavedCookie> {\n+        @Override\n+        public SavedCookie deserialize(JsonParser jsonParser, DeserializationContext ctxt)\n+                throws IOException {\n+           ObjectCodec oc = jsonParser.getCodec();\n+           JsonNode node = oc.readTree(jsonParser);\n+           return new SavedCookie(node.path(\"name\").textValue(),\n+                   node.path(\"value\").textValue());\n+        }\n+\n+        @Override\n+        public SavedCookie deserializeWithType(JsonParser jp, DeserializationContext ctxt,\n+                TypeDeserializer typeDeserializer)\n+            throws IOException, JsonProcessingException\n+        {\n+            return (SavedCookie) typeDeserializer.deserializeTypedFromObject(jp, ctxt);\n+        }\n+    }    \n+    \n     /*\n     /**********************************************************\n     /* Unit tests\n         JsonNode jsonNode = mapper.valueToTree(foo);\n         assertEquals(jsonNode.get(\"bar\").textValue(), foo.bar);\n     }\n+\n+    public void testIssue353() throws Exception\n+    {\n+        ObjectMapper mapper = new ObjectMapper();\n+\n+        mapper.enableDefaultTypingAsProperty(ObjectMapper.DefaultTyping.NON_FINAL, \"@class\");\n+\n+         SimpleModule testModule = new SimpleModule(\"MyModule\", new Version(1, 0, 0, null, \"TEST\", \"TEST\"));\n+         testModule.addDeserializer(SavedCookie.class, new SavedCookieDeserializer());\n+         mapper.registerModule(testModule);\n+\n+         SavedCookie savedCookie = new SavedCookie(\"key\", \"v\");\n+         String json = mapper.writeValueAsString(savedCookie);\n+         SavedCookie out = mapper.reader(SavedCookie.class).readValue(json);\n+\n+         assertEquals(\"key\", out.name);\n+         assertEquals(\"v\", out.value);\n+    }\n }", "timestamp": 1394826849, "metainfo": ""}