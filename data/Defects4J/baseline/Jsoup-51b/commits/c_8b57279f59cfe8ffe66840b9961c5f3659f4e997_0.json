{"sha": "8b57279f59cfe8ffe66840b9961c5f3659f4e997", "log": "Update of meta charset tags.", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Document.java\n+++ b/src/main/java/org/jsoup/nodes/Document.java\n     }\n \n     @Override\n+    public String html() {\n+        ensureMetaCharset();\n+        return super.html();\n+    }\n+\n+    @Override\n     public String outerHtml() {\n         return super.html(); // no outer wrapper tag\n     }\n         clone.outputSettings = this.outputSettings.clone();\n         return clone;\n     }\n+    \n+    private void ensureMetaCharset() {\n+        if( outputSettings.updateMetaCharset() ) {\n+            Element metaCharset = select(\"meta[charset]\").first();\n+            \n+            if( metaCharset != null ) {\n+                metaCharset.attr(\"charset\", outputSettings.charset().displayName());\n+                // TODO: Remove other charset tags / handle duplicates (?)\n+            }\n+            else {\n+                Element head = head();\n+                \n+                if( head != null ) {\n+                    head.appendElement(\"meta\").attr(\"charset\", outputSettings.charset().displayName());\n+                }\n+            }\n+        }\n+    }\n+    \n \n     /**\n      * A Document's output settings control the form of the text() and html() methods.\n         private boolean outline = false;\n         private int indentAmount = 1;\n         private Syntax syntax = Syntax.html;\n+        private boolean updateMetaCharset = false;\n \n         public OutputSettings() {}\n \n         public OutputSettings indentAmount(int indentAmount) {\n             Validate.isTrue(indentAmount >= 0);\n             this.indentAmount = indentAmount;\n+            return this;\n+        }\n+        \n+        public boolean updateMetaCharset() {\n+            return updateMetaCharset;\n+        }\n+        \n+        public OutputSettings updateMetaCharset(boolean updateMetaCharset) {\n+            this.updateMetaCharset = updateMetaCharset;\n             return this;\n         }\n ", "timestamp": 1414596508, "metainfo": ""}