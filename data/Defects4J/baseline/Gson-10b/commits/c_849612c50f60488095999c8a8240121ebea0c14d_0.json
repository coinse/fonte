{"sha": "849612c50f60488095999c8a8240121ebea0c14d", "log": "initial creation of the wsf project.", "commit": "\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/CallPath.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * Encapsulation of a Web service path that is sent by the client.\n+ * \n+ * @author inder\n+ */\n+public final class CallPath {\n+\n+  private final String path;\n+\n+  public CallPath(String path) {\n+    this.path = path;\n+  }\n+\n+  public String get() {\n+    return path;\n+  }\n+  \n+  @Override\n+  public int hashCode() {\n+    return path.hashCode();\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if (this == obj) {\n+      return true;\n+    }\n+    if (obj == null) {\n+      return false;\n+    }\n+    if (getClass() != obj.getClass()) {\n+      return false;\n+    }\n+    CallPath other = (CallPath) obj;\n+    if (path == null && other.path != null) { \n+      return false;\n+    } else if (!path.equals(other.path)) {\n+      return false;\n+    }\n+    return true;\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    return path;\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/CallPathMap.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.util.Map;\n+\n+import com.google.common.collect.Maps;\n+\n+/**\n+ * A generic Map of calls with relative path where the call is available as the key. \n+ * \n+ * @author inder\n+ *\n+ * @param <T> The target of the call path.\n+ */\n+public final class CallPathMap<T> {\n+  \n+  public static class Builder<T> {\n+    private final Map<CallPath, T> contents = Maps.newHashMap();\n+    private final T nullValue;\n+    \n+    public Builder(T nullValue) {\n+      this.nullValue = nullValue;\n+    }\n+    public <R extends T> Builder<T> put(CallPath path, R content) {\n+      contents.put(path, content);\n+      return this;\n+    }\n+    \n+    public CallPathMap<T> create() {\n+      return new CallPathMap<T>(contents, nullValue);\n+    }\n+  }\n+  \n+  private final Map<CallPath, T> contents;\n+  private final T nullValue;\n+  \n+  private CallPathMap(Map<CallPath, T> contents, T nullValue) {\n+    this.contents = contents;\n+    this.nullValue = nullValue;\n+  }\n+  \n+  public T get(CallPath path) {\n+    T content = contents.get(path);\n+    return content == null ? nullValue : content;\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder(\"{\");\n+    boolean first = true;\n+    for (Map.Entry<CallPath, T> entry : contents.entrySet()) {\n+      if (first) {\n+        first = false;\n+      } else {\n+        sb.append(\",\");\n+      }\n+      CallPath path = entry.getKey();\n+      sb.append(path.get()).append(\":\");\n+      sb.append(entry.getValue().toString());\n+    }\n+    sb.append(\"}\");\n+    return sb.toString();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/ContentBody.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.Maps;\n+\n+/**\n+ * Body of a request or response. The body contains a map of name-value pairs.\n+ * There is a {@link ContentBodySpec} associated with the body as well and only the name-value \n+ * pairs consistent with the specification are permitted.\n+ * \n+ * @author inder\n+ */\n+class ContentBody {\n+  \n+  protected final ContentBodySpec spec;\n+  protected final Map<String, Object> contents;\n+  \n+  ContentBody(ContentBodySpec spec) {\n+    this.spec = spec;\n+    this.contents = Maps.newLinkedHashMap();\n+  }\n+  \n+  ContentBody(ContentBodySpec spec, Map<String, Object> contents) {\n+    this.spec = spec;\n+    this.contents = contents;\n+  }\n+  \n+  public ContentBodySpec getSpec() {\n+    return spec;\n+  }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  public <T> T get(String key, Class<T> classOfValue) {\n+    Preconditions.checkArgument(spec.isCompatible(key, classOfValue));\n+    return (T) contents.get(key);\n+  }\n+  \n+  @SuppressWarnings(\"unchecked\")\n+  public <T> T get(String key, Type typeOfValue) {\n+    Preconditions.checkArgument(spec.isCompatible(key, typeOfValue));\n+    return (T) contents.get(key);\n+  }\n+  \n+  public Set<Map.Entry<String, Object>> entrySet() {\n+    return contents.entrySet();\n+  }\n+  \n+  public int size() {\n+    return contents.size();\n+  }\n+  \n+  public String getContentType() {\n+    return spec.getContentType();\n+  }\n+  \n+  public String getCharacterEncoding() {\n+    return spec.getCharacterEncoding();\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    return Util.toStringMap(contents);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/ContentBodySpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Base class for the specification of a {@link ContentBody}.\n+ * \n+ * @author inder\n+ */\n+class ContentBodySpec implements ParamMapSpec {\n+\n+  public static final String JSON_CONTENT_TYPE = \"application/json\";\n+  private static final String JSON_CHARACTER_ENCODING = \"utf-8\";\n+  \n+  private final Map<String, Type> paramsSpec;\n+\n+  protected ContentBodySpec(Map<String, Type> paramsSpec) {\n+    this.paramsSpec = Collections.unmodifiableMap(paramsSpec);\n+  }\n+  \n+  public Type getTypeFor(String paramName) {\n+    return paramsSpec.get(paramName);\n+  }\n+  \n+  public boolean isCompatible(String paramName, Type type) {\n+    return type.equals(getTypeFor(paramName));\n+  }\n+  \n+  public boolean isCompatible(String paramName, Object object) {\n+    return isCompatible(paramName, object.getClass());\n+  }\n+  \n+  public Set<Map.Entry<String, Type>> entrySet() {\n+    return paramsSpec.entrySet();\n+  }\n+  \n+  public int size() {\n+    return paramsSpec.size();\n+  }\n+  \n+  public String getContentType() {\n+    return JSON_CONTENT_TYPE;\n+  }\n+  \n+  public String getCharacterEncoding() {\n+    return JSON_CHARACTER_ENCODING;\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    return Util.toStringMapKeys(paramsSpec);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/HeaderMap.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.Maps;\n+\n+/**\n+ * Map of request or response header objects. There is a {@link HeaderMapSpec} associated with the\n+ * map as well and only those headers are allowed that are consistent with the specification.\n+ * \n+ * @author inder\n+ */\n+public final class HeaderMap {\n+\n+  private final Map<String, Object> contents;\n+  private final HeaderMapSpec spec;\n+  \n+  public HeaderMap(HeaderMapSpec spec) {\n+    this.spec = spec;\n+    contents = Maps.newHashMap();\n+  }  \n+  \n+  /**\n+   * If paramValue is a generic type, use {@link #put(String, Object, Type)} instead.\n+   * \n+   * @param headerName\n+   * @param headerValue\n+   */\n+  public void put(String headerName, Object headerValue) {\n+    Preconditions.checkArgument(spec.isCompatible(headerName, headerValue));\n+    contents.put(headerName, headerValue);\n+  }\n+  \n+  public void put(String headerName, Object headerValue, Type typeOfHeaderValue) {\n+    Preconditions.checkArgument(spec.isCompatible(headerName, typeOfHeaderValue));\n+    contents.put(headerName, headerValue);\n+  }\n+  \n+  public HeaderMapSpec getSpec() {\n+    return spec;\n+  }\n+\n+  public Object get(String headerName) {\n+    return contents.get(headerName);\n+  }\n+  \n+  public Type getSpec(String headerName) {\n+    return spec.getTypeFor(headerName);\n+  }\n+  \n+  public Set<Map.Entry<String, Object>> entrySet() {\n+    return contents.entrySet();\n+  }\n+  \n+  public int size() {\n+    return contents.size();\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    return Util.toStringMap(contents);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/HeaderMapSpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import com.google.common.collect.Maps;\n+\n+/**\n+ * Specification of a header map for {@link HeaderMap}. \n+ *\n+ * @author inder\n+ */\n+public final class HeaderMapSpec implements ParamMapSpec {\n+  \n+  public static class Builder {\n+    private final Map<String, Type> map = Maps.newLinkedHashMap();\n+  \n+    public void put(String headerName, Type headerType) {\n+      map.put(headerName, headerType);\n+    }\n+    \n+    public HeaderMapSpec create() {\n+      return new HeaderMapSpec(map);\n+    }\n+  }\n+  private final Map<String, Type> map;\n+  \n+  private HeaderMapSpec(Map<String, Type> map) {\n+    this.map = map;\n+  }  \n+  \n+  public Type getTypeFor(String headerName) {\n+    return map.get(headerName);\n+  }\n+  \n+  public Set<Map.Entry<String, Type>> entrySet() {\n+    return map.entrySet();\n+  }\n+  \n+  @Override\n+  public boolean isCompatible(String headerName, Type targetType) {\n+    Type typeOfHeader = getTypeFor(headerName);\n+    if (typeOfHeader == null) {\n+      return false;\n+    }\n+    Class<?> rawClassOfHeader = TypeUtils.toRawClass(typeOfHeader);\n+    Class<?> rawClassOfTargetType = TypeUtils.toRawClass(targetType);\n+    return rawClassOfHeader.isAssignableFrom(rawClassOfTargetType);\n+  }\n+\n+  public boolean isCompatible(String headerName, Object headerValue) {\n+    return isCompatible(headerName, headerValue.getClass());\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    return Util.toStringMapKeys(map);\n+  }\n+\n+  @Override\n+  public int size() {\n+    return map.size();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/HttpMethod.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * An enum of Http methods to provide strongly-typed versions instead of strings. \n+ * \n+ * @author inder\n+ */\n+public enum HttpMethod { \n+  GET, \n+  POST, \n+  PUT, \n+  DELETE;\n+  \n+  public static HttpMethod getMethod(String method) {\n+    return valueOf(method.trim().toUpperCase());\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/ParamMapSpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Specification of a parameter map. Both {@link ContentBody} and {@link HeaderMap} are \n+ * parameter maps.\n+ * \n+ * @author inder\n+ */\n+interface ParamMapSpec {\n+\n+  Type getTypeFor(String paramName);\n+\n+  boolean isCompatible(String paramName, Type type);\n+\n+  boolean isCompatible(String paramName, Object object);\n+  \n+  public Set<Map.Entry<String, Type>> entrySet();\n+\n+  public int size();\n+\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/RequestBody.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+\n+import com.google.common.collect.Maps;\n+import com.google.inject.Inject;\n+\n+/**\n+ * Definition of the request body of a {@link WebServiceCall}. The request body is what is sent out\n+ * in the output stream of the request (for example, with \n+ * {@link java.net.HttpURLConnection#getOutputStream()}) , and is read by the \n+ * {@link javax.servlet.http.HttpServletRequest#getInputStream()}.\n+ * \n+ * @author inder\n+ */\n+public final class RequestBody extends ContentBody {\n+\n+  public static class Builder {    \n+    private final Map<String, Object> contents = Maps.newLinkedHashMap();\n+    private final RequestBodySpec spec;\n+    \n+    @Inject\n+    public Builder(RequestBodySpec spec) {\n+      this.spec = spec;\n+    }\n+    \n+    public Builder add(String paramName, Object content) {\n+      return add(paramName, content, content.getClass());\n+    }\n+    \n+    public Builder add(String paramName, Object content, Type typeOfContent) {\n+      spec.isCompatible(paramName, typeOfContent);\n+      contents.put(paramName, content);\n+      return this;\n+    }\n+    \n+    public RequestBody create() {\n+      RequestBody requestBody = new RequestBody(spec, contents);\n+      return requestBody;\n+    }    \n+  }\n+\n+  public RequestBody(RequestBodySpec spec, Map<String, Object> contents) {\n+    super(spec, contents);\n+  }\n+  \n+  @Override\n+  public RequestBodySpec getSpec() {\n+    return (RequestBodySpec) spec;\n+  }  \n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/RequestBodySpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+\n+import com.google.common.collect.Maps;\n+\n+/**\n+ * Specification of a {@link RequestBody}.\n+ * \n+ * @author inder\n+ */\n+public final class RequestBodySpec extends ContentBodySpec {\n+  \n+  public static class Builder {\n+    private final Map<String, Type> paramsSpec = Maps.newLinkedHashMap();\n+    public Builder add(String paramName, Type type) {\n+      paramsSpec.put(paramName, type);\n+      return this;\n+    }\n+    \n+    public RequestBodySpec create() {\n+      RequestBodySpec spec = new RequestBodySpec(paramsSpec);\n+      return spec;\n+    }    \n+  }\n+  \n+  public RequestBodySpec(Map<String, Type> paramsSpec) {\n+    super(paramsSpec);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/RequestSpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import com.google.common.base.Preconditions;\n+\n+/**\n+ * Specification for a {@link WebServiceRequest}.\n+ * \n+ * @author inder\n+ */\n+public final class RequestSpec {\n+\n+  private final HeaderMapSpec headersSpec;\n+  private final RequestBodySpec bodySpec;\n+  \n+  public RequestSpec(HeaderMapSpec headersSpec, RequestBodySpec bodySpec) {\n+    Preconditions.checkNotNull(headersSpec);\n+    Preconditions.checkNotNull(bodySpec);\n+    \n+    this.headersSpec = headersSpec;\n+    this.bodySpec = bodySpec;\n+  }\n+  \n+  public HeaderMapSpec getHeadersSpec() {\n+    return headersSpec;\n+  }\n+ \n+  public RequestBodySpec getBodySpec() {\n+    return bodySpec;\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder(\"{headersSpec:\");\n+    sb.append(headersSpec).append(\",bodySpec:\");\n+    sb.append(bodySpec).append(\"}\");\n+    return sb.toString();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/ResponseBody.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+\n+import com.google.common.base.Preconditions;\n+\n+/**\n+ * body of the response. This is written out as JSON to be sent out to the client. \n+ * \n+ * @author inder\n+ */\n+public final class ResponseBody extends ContentBody {\n+\n+  public ResponseBody(ResponseBodySpec spec) {\n+    super(spec);\n+  }\n+  \n+  @Override\n+  public ResponseBodySpec getSpec() {\n+    return (ResponseBodySpec) spec;\n+  }\n+  \n+  /**\n+   * If value is a generic type, use {@link #put(String, Object, Type)} instead.\n+   * \n+   * @param key\n+   * @param value\n+   */\n+  public void put(String key, Object value) {\n+    put(key, value, value.getClass());\n+  }\n+    \n+  public void put(String key, Object value, Type typeOfValue) {\n+    Type expectedType = spec.getTypeFor(key);\n+    Preconditions.checkArgument(Util.isAssignableFrom(typeOfValue, expectedType));\n+    contents.put(key, value);\n+  }  \n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/ResponseBodySpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+\n+import com.google.common.collect.Maps;\n+\n+/**\n+ * Specification of a {@link ResponseBody}.\n+ * \n+ * @author inder\n+ */\n+public final class ResponseBodySpec extends ContentBodySpec {\n+  \n+  public static class Builder {\n+    private final Map<String, Type> paramsSpec = Maps.newLinkedHashMap();\n+    public Builder add(String paramName, Type type) {\n+      paramsSpec.put(paramName, type);\n+      return this;\n+    }\n+    \n+    public ResponseBodySpec create() {\n+      ResponseBodySpec spec = new ResponseBodySpec(paramsSpec);\n+      return spec;\n+    }    \n+  }\n+  \n+  public ResponseBodySpec(Map<String, Type> paramsSpec) {\n+    super(paramsSpec);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/ResponseSpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import com.google.common.base.Preconditions;\n+\n+/**\n+ * Specification for a {@link WebServiceResponse}.\n+ * \n+ * @author inder\n+ */\n+public final class ResponseSpec {\n+  private final HeaderMapSpec headersSpec;\n+  private final ResponseBodySpec bodySpec;\n+\n+  public ResponseSpec(HeaderMapSpec headersSpec, ResponseBodySpec bodySpec) {\n+    Preconditions.checkNotNull(headersSpec);\n+    Preconditions.checkNotNull(bodySpec);\n+    \n+    this.headersSpec = headersSpec;\n+    this.bodySpec = bodySpec;\n+  }\n+\n+  public ResponseBodySpec getBodySpec() {\n+    return bodySpec;\n+  }\n+\n+  public HeaderMapSpec getHeadersSpec() {\n+    return headersSpec;\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder(\"{headersSpec:\");\n+    sb.append(headersSpec).append(\",bodySpec:\");\n+    sb.append(bodySpec).append(\"}\");\n+    return sb.toString();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/TypeUtils.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+// Copied from com.google.gson.TypeUtils\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Array;\n+import java.lang.reflect.GenericArrayType;\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+\n+/**\n+ * Utility class containing some methods for obtaining information on types.\n+ *\n+ * @author Inderjeet Singh\n+ * @author Joel Leitch\n+ */\n+final class TypeUtils {\n+\n+  /**\n+   * Returns the actual type matching up with the first type variable.\n+   * So, for a {@code typeInfo} instance defined as:\n+   * <pre>\n+   *   class Foo<A, B> {\n+   *   }\n+   *   Type fooType = new TypeToken<Foo<Integer, String>>() {}.getType();\n+   * </pre>\n+   * <code>TypeUtils.getActualTypeForFirstTypeVariable(fooType)</code> will return Integer.class.\n+   */\n+  static Type getActualTypeForFirstTypeVariable(Type type) {\n+    if (type instanceof Class) {\n+      return Object.class;\n+    } else if (type instanceof ParameterizedType) {\n+      return ((ParameterizedType)type).getActualTypeArguments()[0];\n+    } else if (type instanceof GenericArrayType) {\n+      return getActualTypeForFirstTypeVariable(((GenericArrayType)type).getGenericComponentType());\n+    } else {\n+      throw new IllegalArgumentException(\"Type \\'\" + type + \"\\' is not a Class, \"\n+          + \"ParameterizedType, or GenericArrayType. Can't extract class.\");\n+    }\n+  }\n+\n+  static boolean isArray(Type type) {\n+    if (type instanceof Class) {\n+      return ((Class<?>)type).isArray();\n+    } else if (type instanceof GenericArrayType) {\n+      return true;\n+    } else {\n+      return false;\n+    }\n+  }\n+\n+  /**\n+   * This method returns the actual raw class associated with the specified type.\n+   */\n+  static Class<?> toRawClass(Type type) {\n+    if (type instanceof Class) {\n+      return (Class<?>) type;\n+    } else if (type instanceof ParameterizedType) {\n+      ParameterizedType actualType = (ParameterizedType)type;\n+      return toRawClass(actualType.getRawType());\n+    } else if (type instanceof GenericArrayType) {\n+      GenericArrayType actualType = (GenericArrayType) type;\n+      Class<?> rawClass = toRawClass(actualType.getGenericComponentType());\n+      return wrapWithArray(rawClass);\n+    } else {\n+      throw new IllegalArgumentException(\"Type \\'\" + type + \"\\' is not a Class, \"\n+          + \"ParameterizedType, or GenericArrayType. Can't extract class.\");\n+    }\n+  }\n+\n+  static Class<?> wrapWithArray(Class<?> rawClass) {\n+    return Array.newInstance(rawClass, 0).getClass();\n+  }\n+\n+  private TypeUtils() {\n+    // Class with just some static utility methods, should not be instantiated\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/Util.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+\n+final class Util {\n+  private Util() { }\n+  \n+  public static boolean isAssignableFrom(Type typeOfValue, Type expectedType) {\n+    return typeOfValue.equals(expectedType);\n+  }\n+  \n+  public static String toStringMapKeys(Map<String, ?> map) {\n+    StringBuilder sb = new StringBuilder(\"[\");\n+    boolean first = true;\n+    for (Map.Entry<String, ?> entry : map.entrySet()) {\n+      if (first) {\n+        first = false;\n+      } else {\n+        sb.append(\",\");\n+      }\n+      sb.append(entry.getKey());\n+    }\n+    sb.append(\"]\");\n+    return sb.toString();    \n+  }\n+  \n+  public static String toStringMapOfTypes(Map<String, Type> map) {\n+    StringBuilder sb = new StringBuilder(\"[\");\n+    boolean first = true;\n+    for (Map.Entry<String, ?> entry : map.entrySet()) {\n+      if (first) {\n+        first = false;\n+      } else {\n+        sb.append(\",\");\n+      }\n+      sb.append(entry.getKey()).append(\":\");\n+      Class<?> clazz = (Class<?>) entry.getValue();\n+      sb.append(clazz.getSimpleName());\n+    }\n+    sb.append(\"]\");\n+    return sb.toString();    \n+  }\n+  \n+  public static String toStringMap(Map<String, Object> map) {\n+    StringBuilder sb = new StringBuilder(\"[\");\n+    boolean first = true;\n+    for (Map.Entry<String, ?> entry : map.entrySet()) {\n+      if (first) {\n+        first = false;\n+      } else {\n+        sb.append(\",\");\n+      }\n+      sb.append(entry.getKey()).append(\":\").append(entry.getValue());\n+    }\n+    sb.append(\"]\");\n+    return sb.toString();    \n+  }\n+\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceAppException.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * Base class for exceptions thrown to indicate a Web service external or application error \n+ * condition. This can happen due to bad input, or illegal sequence of operations. This should\n+ * never be thrown to indicate a System error condition. For that purpose, use \n+ * {@link WebServiceSystemException} instead. \n+ * \n+ * @author inder\n+ */\n+public class WebServiceAppException extends RuntimeException {\n+\n+  private static final long serialVersionUID = 4422041697108937041L;\n+\n+  public WebServiceAppException(Exception cause) {\n+    super(cause);\n+  }\n+  \n+  public WebServiceAppException(String msg, Exception cause) {\n+\tsuper(msg, cause);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceCall.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * The data associated with a Web service call. This includes http request header parameters (form \n+ * and URL parameters), {@link RequestBody}, response header parameters, and {@link ResponseBody}. \n+ * \n+ * @author inder\n+ */\n+public final class WebServiceCall {\n+  \n+  private final WebServiceCallSpec callSpec;\n+  private final WebServiceRequest request;\n+  private final WebServiceResponse response;\n+  \n+  public WebServiceCall(WebServiceCallSpec callSpec, WebServiceRequest request, \n+      WebServiceResponse response) {\n+    this.callSpec = callSpec;\n+    this.request = request;\n+    this.response = response;\n+  }\n+\n+  public WebServiceCallSpec getSpec() {\n+    return callSpec;\n+  }\n+  \n+  public WebServiceRequest getRequest() {\n+    return request;\n+  }\n+\n+  public WebServiceResponse getResponse() {\n+    return response;\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceCallSpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+import java.lang.reflect.Type;\n+import java.util.Arrays;\n+import java.util.LinkedHashSet;\n+import java.util.Set;\n+\n+import com.google.common.base.Preconditions;\n+\n+\n+/**\n+ * Specification for a Json web service call. The call includes the relative path where the call \n+ * is available, the specification of requests, and responses. \n+ * \n+ * @author inder\n+ */\n+public final class WebServiceCallSpec {\n+  \n+  public static final WebServiceCallSpec NULL_SPEC = new Builder(new CallPath(\"\")).create();\n+  \n+  public static class Builder {\n+\tprivate final CallPath callPath;\n+\tprivate final Set<HttpMethod> supportedHttpMethods = new LinkedHashSet<HttpMethod>();\n+    private final HeaderMapSpec.Builder reqParamsSpecBuilder = new HeaderMapSpec.Builder();\n+    private final RequestBodySpec.Builder reqBodySpecBuilder = new RequestBodySpec.Builder();\n+    private final HeaderMapSpec.Builder resParamsSpecBuilder = new HeaderMapSpec.Builder();\n+    private final ResponseBodySpec.Builder resBodySpecBuilder = new ResponseBodySpec.Builder();\n+    \n+    public Builder(CallPath callPath) {\n+      this.callPath = callPath;      \n+    }\n+    \n+    /**\n+     * If this method is not invoked, then it is assumed that the WebServiceCall supports all\n+     * methods specified in {@link HttpMethod#values()}.\n+     * \n+     * @param httpMethods list of methods that this call supports.\n+     * @return self to follow the Builder pattern.\n+     */\n+    public Builder supportsHttpMethod(HttpMethod... httpMethods) {\n+      supportedHttpMethods.addAll(Arrays.asList(httpMethods));\n+      return this;\n+    }\n+    \n+    public Builder addRequestParam(String paramName, Type type) {\n+      reqParamsSpecBuilder.put(paramName, type);\n+      return this;\n+    }\n+    public Builder addRequestBodyParam(String paramName, Type type) {\n+      reqBodySpecBuilder.add(paramName, type);\n+      return this;\n+    }\n+    public Builder addResponseParam(String paramName, Type type) {\n+      resParamsSpecBuilder.put(paramName, type);\n+      return this;\n+    }\n+    public Builder addResponseBodyParam(String paramName, Type type) {\n+      resBodySpecBuilder.add(paramName, type);\n+      return this;\n+    }\n+    public WebServiceCallSpec create() {      \n+      if (supportedHttpMethods.isEmpty()) {\n+        supportedHttpMethods.addAll(Arrays.asList(HttpMethod.values()));\n+      }\n+      RequestSpec requestSpec = \n+        new RequestSpec(reqParamsSpecBuilder.create(), reqBodySpecBuilder.create());\n+      ResponseSpec responseSpec = \n+        new ResponseSpec(resParamsSpecBuilder.create(), resBodySpecBuilder.create());\n+      WebServiceCallSpec callSpec = new WebServiceCallSpec(supportedHttpMethods, callPath, \n+          requestSpec, responseSpec);\n+      return callSpec;\n+    }\n+  }\n+  \n+  private final Set<HttpMethod> supportedHttpMethods;\n+  private final CallPath path;\n+  private final ResponseSpec responseSpec;\n+  private final RequestSpec requestSpec;\n+  \n+  private WebServiceCallSpec(Set<HttpMethod> supportedHttpMethods, CallPath path, \n+      RequestSpec requestSpec, ResponseSpec responseSpec) {\n+    Preconditions.checkArgument(!supportedHttpMethods.isEmpty());\n+    Preconditions.checkNotNull(path);\n+    \n+    this.supportedHttpMethods = supportedHttpMethods;\n+    this.path = path;\n+    this.requestSpec = requestSpec;\n+    this.responseSpec = responseSpec;\n+  }\n+\n+  public CallPath getPath() {\n+    return path;\n+  }\n+  \n+  public Set<HttpMethod> getSupportedHttpMethods() {\n+    return supportedHttpMethods;\n+  }\n+\n+  public ResponseSpec getResponseSpec() {\n+    return responseSpec;\n+  }\n+  \n+  public RequestSpec getRequestSpec() {\n+    return requestSpec;\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder(\"{path:\");\n+    sb.append(path).append(\",supportedHttpMethods:\");\n+    boolean first = true;\n+    for (HttpMethod method : supportedHttpMethods) {\n+      if (first) {\n+        first = false;\n+      } else {\n+        sb.append(\",\");\n+      }\n+      sb.append(method);\n+    }\n+    sb.append(path).append(\",requestSpec:\");\n+    sb.append(requestSpec).append(\",responseSpec:\");\n+    sb.append(responseSpec).append(\"}\");\n+    return sb.toString();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceRequest.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * The data associated with a Web service request. This includes HTTP request header parameters \n+ * (form and URL parameters), and {@link RequestBody}. \n+ * \n+ * @author inder\n+ */\n+public final class WebServiceRequest {\n+  private final HttpMethod method;\n+  private final HeaderMap headers;\n+  private final RequestBody body;\n+  private final RequestSpec spec;\n+  \n+  public WebServiceRequest(HttpMethod method, HeaderMap requestHeaders, RequestBody requestBody) {\n+    this.method = method;\n+    this.body = requestBody;\n+    this.headers = requestHeaders;\n+    this.spec = new RequestSpec(requestHeaders.getSpec(), requestBody.getSpec());\n+  }\n+\n+  public HttpMethod getMethod() {\n+    return method;\n+  }\n+\n+  public RequestSpec getSpec() {\n+    return spec;\n+  }\n+\n+  public HttpMethod getHttpMethod() {\n+    return method;\n+  }\n+\n+  public RequestBody getBody() {\n+    return body;\n+  }\n+\n+  public HeaderMap getHeaders() {\n+    return headers;\n+  }\n+\n+  public String getContentType() {\n+    return ContentBodySpec.JSON_CONTENT_TYPE;\n+  }\n+  \n+  @SuppressWarnings(\"unchecked\")\n+  public <T> T getHeader(String headerName) {\n+    return (T) headers.get(headerName);\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder(\"{\");\n+    sb.append(method).append(\",\");\n+    sb.append(\",headers:\").append(headers);\n+    sb.append(\",body:\").append(body);\n+    sb.append(\"}\");\n+    return sb.toString();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceResponse.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * The data associated with a Web service response. This includes http response header parameters, \n+ * and {@link ResponseBody}. \n+ * \n+ * @author inder\n+ */\n+public final class WebServiceResponse {\n+  \n+  private final HeaderMap headers;\n+  private final ResponseBody body;\n+  private final ResponseSpec spec;\n+  \n+  public WebServiceResponse(ResponseSpec spec) {\n+    this.spec = spec;\n+    headers = new HeaderMap(spec.getHeadersSpec());\n+    body = new ResponseBody(spec.getBodySpec());\n+  }\n+  \n+  public WebServiceResponse(HeaderMap responseHeaders, ResponseBody responseBody) {\n+    this.spec = new ResponseSpec(responseHeaders.getSpec(), responseBody.getSpec());\n+    this.headers = responseHeaders;\n+    this.body = responseBody;\n+  }\n+\n+  public ResponseSpec getSpec() {\n+    return spec;\n+  }\n+\n+  public HeaderMap getHeaders() {\n+    return headers;\n+  }\n+  \n+  public ResponseBody getBody() {\n+    return body;\n+  }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  public <T> T getHeader(String headerName) {\n+    return (T) headers.get(headerName);\n+  }\n+  \n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder(\"{headers:\");\n+    sb.append(headers);\n+    sb.append(\",body:\").append(body);\n+    sb.append(\"}\");\n+    return sb.toString();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceSpec.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * Specification of the Web service. This contains a specification of all the \n+ * {@link WebServiceCall}s supported by this Web service.\n+ * \n+ * @author inder\n+ */\n+public interface WebServiceSpec {\n+  public CallPathMap<WebServiceCallSpec> getCalls();\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/WebServiceSystemException.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf;\n+\n+/**\n+ * Base class for all exceptions thrown by the Web service to indicate a system error condition. \n+ * This should never be thrown to indicate bad user input. For that purpose, use \n+ * {@link WebServiceAppException}.\n+ * \n+ * @author inder\n+ */\n+public class WebServiceSystemException extends RuntimeException {\n+\n+  private static final long serialVersionUID = -2511829073381716183L;\n+\n+  public WebServiceSystemException(Exception cause) {\n+    super(cause);\n+  }\n+  \n+  public WebServiceSystemException(String msg, Exception cause) {\n+\t  super(msg, cause);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/client/RequestSender.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.client;\n+\n+import java.io.IOException;\n+import java.io.PrintWriter;\n+import java.io.Writer;\n+import java.lang.reflect.Type;\n+import java.net.HttpURLConnection;\n+import java.util.Map;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.wsf.HeaderMap;\n+import com.google.gson.wsf.HeaderMapSpec;\n+import com.google.gson.wsf.RequestBody;\n+import com.google.gson.wsf.WebServiceRequest;\n+\n+/**\n+ * Class to send Web service requests on a {@link HttpURLConnection}.\n+ * \n+ * @author inder\n+ */\n+public final class RequestSender {\n+  private final Gson gson;\n+\n+  public RequestSender(Gson gson) {\n+    this.gson = gson;\n+  }\n+  \n+  public void send(HttpURLConnection conn, WebServiceRequest request) {    \n+    try {\n+      conn.setRequestMethod(request.getHttpMethod().toString());\n+      conn.setRequestProperty(\"Content-Type\", request.getContentType());\n+      addRequestParams(conn, request.getHeaders());\n+      RequestBody requestBody = request.getBody();\n+      if (requestBody.getSpec().size() > 0) {\n+        conn.setDoOutput(true);    \n+        addRequestBody(conn, requestBody);\n+      }\n+    } catch (IOException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+\n+  private void addRequestParams(HttpURLConnection conn, HeaderMap requestParams) {\n+    HeaderMapSpec spec = requestParams.getSpec();\n+    for (Map.Entry<String, Object> entry : requestParams.entrySet()) {\n+      String paramName = entry.getKey();\n+      Type type = spec.getTypeFor(paramName);\n+      Object value = entry.getValue();\n+      String json = gson.toJson(value, type);\n+      conn.addRequestProperty(paramName, json);\n+    }\n+  }\n+  \n+  private void addRequestBody(HttpURLConnection conn, RequestBody body) throws IOException {\n+    Writer writer = new PrintWriter(conn.getOutputStream());\n+    gson.toJson(body, writer);\n+    writer.close();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/client/ResponseReceiver.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.client;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.Reader;\n+import java.lang.reflect.Type;\n+import java.net.HttpURLConnection;\n+import java.util.Map;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.gson.Gson;\n+import com.google.gson.wsf.HeaderMap;\n+import com.google.gson.wsf.HeaderMapSpec;\n+import com.google.gson.wsf.ResponseBody;\n+import com.google.gson.wsf.ResponseBodySpec;\n+import com.google.gson.wsf.ResponseSpec;\n+import com.google.gson.wsf.WebServiceResponse;\n+\n+/**\n+ * Receives a response coming on an {@link HttpURLConnection}.\n+ * \n+ * @author inder\n+ */\n+public final class ResponseReceiver {\n+  private final Gson gson;\n+  private final ResponseSpec spec;\n+\n+  public ResponseReceiver(Gson gson, ResponseSpec spec) {\n+    this.gson = gson;\n+    this.spec = spec;\n+  }\n+  \n+  public WebServiceResponse receive(HttpURLConnection conn) {\n+    try {\n+      HeaderMapSpec paramSpec = spec.getHeadersSpec();\n+      ResponseBodySpec bodySpec = spec.getBodySpec();\n+      if (bodySpec.size() > 0) {\n+        conn.setDoInput(true);\n+      }\n+      // read response\n+      HeaderMap responseParams = readResponseHeaders(conn, paramSpec);\n+      ResponseBody responseBody = readResponseBody(conn, bodySpec);\n+      return new WebServiceResponse(responseParams, responseBody);\n+    } catch (IOException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+\n+  private HeaderMap readResponseHeaders(HttpURLConnection conn, HeaderMapSpec paramsSpec) {    \n+    HeaderMap params = new HeaderMap(paramsSpec);    \n+    for (Map.Entry<String, Type> entry : paramsSpec.entrySet()) {\n+      String paramName = entry.getKey();\n+      String json = conn.getHeaderField(paramName);\n+      if (json != null) {\n+        Type typeOfT = paramsSpec.getTypeFor(paramName);\n+        Object value = gson.fromJson(json, typeOfT);\n+        params.put(paramName, value, typeOfT);\n+      }\n+    }\n+    return params;\n+  }\n+\n+  private ResponseBody readResponseBody(HttpURLConnection conn, ResponseBodySpec bodySpec) \n+      throws IOException {\n+    if (bodySpec.size() == 0) {\n+      return new ResponseBody(bodySpec);\n+    }\n+    String connContentType = conn.getContentType();\n+    Preconditions.checkArgument(connContentType.contains(bodySpec.getContentType()));\n+    Reader reader = new BufferedReader(new InputStreamReader(conn.getInputStream()));\n+    ResponseBody body = gson.fromJson(reader, ResponseBody.class);\n+    return body;\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/client/WebServiceClient.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.client;\n+\n+import java.io.IOException;\n+import java.net.HttpURLConnection;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.wsf.WebServiceCallSpec;\n+import com.google.gson.wsf.WebServiceRequest;\n+import com.google.gson.wsf.WebServiceResponse;\n+\n+/**\n+ * Main class used by clients to access a Gson Web service.\n+ * \n+ * @author inder\n+ */\n+public final class WebServiceClient {\n+  private final WebServiceConfig config;\n+  private final WebServiceCallSpec callSpec;\n+  private final Gson gson;\n+\n+  public WebServiceClient(Gson gson, WebServiceConfig serverConfig, WebServiceCallSpec callSpec) {\n+    this.gson = gson;\n+    this.config = serverConfig;\n+    this.callSpec = callSpec;\n+  }\n+  \n+  private URL getWebServiceUrl() {\n+    String url = config.getServiceBaseUrl() + callSpec.getPath().get();\n+    try {\n+      return new URL(url);\n+    } catch (MalformedURLException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+  \n+  public WebServiceResponse getResponse(WebServiceRequest request) {\n+    try {\n+      HttpURLConnection conn = (HttpURLConnection) getWebServiceUrl().openConnection();\n+      RequestSender requestSender = new RequestSender(gson);\n+      requestSender.send(conn, request);\n+      ResponseReceiver responseReceiver = new ResponseReceiver(gson, callSpec.getResponseSpec());\n+      return responseReceiver.receive(conn);\n+    } catch (IOException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/client/WebServiceConfig.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.client;\n+\n+/**\n+ * Configuration needed to access a Gson web service.\n+ * \n+ * @author inder\n+ */\n+public final class WebServiceConfig {\n+  private final String serviceBaseUrl;\n+\n+  public WebServiceConfig(String serviceBaseUrl) {\n+    this.serviceBaseUrl = serviceBaseUrl;\n+  }\n+\n+  public String getServiceBaseUrl() {\n+    return serviceBaseUrl;\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/inject/CallPathProvider.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.inject;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import com.google.gson.wsf.CallPath;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * Guice provider for {@link CallPath} for an incoming web service request.\n+ * \n+ * @author inder\n+ */\n+final class CallPathProvider implements Provider<CallPath> {\n+  private final HttpServletRequest request;\n+\n+  @Inject \n+  public CallPathProvider(HttpServletRequest request) {\n+    this.request = request;\n+  }\n+\n+  @Override\n+  public CallPath get() {\n+    String pathInfo = request.getPathInfo();\n+    System.out.println(\"Incoming request with pathInfo: \" + pathInfo);\n+    String callPath = pathInfo;\n+    return new CallPath(callPath);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/inject/RequestBodySpecProvider.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.inject;\n+\n+import com.google.gson.wsf.RequestBodySpec;\n+import com.google.gson.wsf.RequestSpec;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * Guice provider for the {@link RequestBodySpec} to map to the incoming requests.\n+ * \n+ * @author inder\n+ */\n+final class RequestBodySpecProvider implements Provider<RequestBodySpec> {\n+\n+  private final RequestSpec requestSpec;\n+\n+  @Inject\n+  public RequestBodySpecProvider(RequestSpec requestSpec) {\n+    this.requestSpec = requestSpec;\n+  }\n+  \n+  @Override\n+  public RequestBodySpec get() {\n+    return requestSpec.getBodySpec();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/inject/RequestSpecProvider.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.inject;\n+\n+import com.google.gson.wsf.RequestSpec;\n+import com.google.gson.wsf.WebServiceCallSpec;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * Guice provider for the {@link RequestSpec} to map to the incoming requests.\n+ * \n+ * @author inder\n+ */\n+final class RequestSpecProvider implements Provider<RequestSpec> {\n+\n+  private final WebServiceCallSpec webServiceCallSpec;\n+\n+  @Inject\n+  public RequestSpecProvider(WebServiceCallSpec webServiceCallSpec) {\n+    this.webServiceCallSpec = webServiceCallSpec;\n+  }\n+  \n+  @Override\n+  public RequestSpec get() {\n+    return webServiceCallSpec.getRequestSpec();\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/inject/WebServiceCallProvider.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.inject;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.wsf.WebServiceCall;\n+import com.google.gson.wsf.WebServiceCallSpec;\n+import com.google.gson.wsf.WebServiceRequest;\n+import com.google.gson.wsf.WebServiceResponse;\n+import com.google.gson.wsf.server.RequestReceiver;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * Guice provider for {@link WebServiceCall} to be used by a server-side implementation.\n+ *\n+ * @author inder\n+ */\n+final class WebServiceCallProvider implements Provider<WebServiceCall> {\n+  private final Gson gson;\n+  private final WebServiceCallSpec callSpec;\n+  private final HttpServletRequest request;\n+\n+  @Inject\n+  public WebServiceCallProvider(Gson gson, HttpServletRequest request, \n+      WebServiceCallSpec callSpec) {\n+    this.callSpec = callSpec;\n+    this.gson = gson;\n+    this.request = request;\n+  }\n+\n+  @Override\n+  public WebServiceCall get() {\n+    RequestReceiver receiver = new RequestReceiver(gson, callSpec.getRequestSpec());\n+    WebServiceRequest wsRequest = receiver.receive(request);           \n+    \n+    // No need to populate response headers or response body       \n+    WebServiceResponse wsResponse = new WebServiceResponse(callSpec.getResponseSpec());\n+\n+    return new WebServiceCall(callSpec, wsRequest, wsResponse);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/inject/WebServiceCallSpecProvider.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.inject;\n+\n+import com.google.gson.wsf.CallPath;\n+import com.google.gson.wsf.WebServiceCallSpec;\n+import com.google.gson.wsf.WebServiceSpec;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * Guice provider for {@link WebServiceCallSpec}.\n+ *\n+ * @author inder\n+ */\n+final class WebServiceCallSpecProvider implements Provider<WebServiceCallSpec> {\n+  private final CallPath callPath;\n+  private final WebServiceSpec webServiceSpec;\n+  \n+  @Inject\n+  WebServiceCallSpecProvider(CallPath callPath, WebServiceSpec webServiceSpec) {\n+    this.callPath = callPath;\n+    this.webServiceSpec = webServiceSpec;\n+  }\n+\n+  @Override\n+  public WebServiceCallSpec get() {\n+    return webServiceSpec.getCalls().get(callPath);\n+  }    \n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/server/RequestReceiver.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.server;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.Reader;\n+import java.lang.reflect.Type;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.servlet.http.HttpServletRequest;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonParseException;\n+import com.google.gson.wsf.HeaderMap;\n+import com.google.gson.wsf.HeaderMapSpec;\n+import com.google.gson.wsf.HttpMethod;\n+import com.google.gson.wsf.RequestBody;\n+import com.google.gson.wsf.RequestBodySpec;\n+import com.google.gson.wsf.RequestSpec;\n+import com.google.gson.wsf.WebServiceRequest;\n+import com.google.gson.wsf.WebServiceSystemException;\n+\n+/**\n+ * Receives and parses a request at the server side on a {@link HttpServletRequest}.  \n+ * \n+ * @author inder\n+ */\n+public final class RequestReceiver {\n+\n+  private final Gson gson;\n+  private final RequestSpec spec;\n+\n+  public RequestReceiver(Gson gson, RequestSpec spec) {\n+    this.gson = gson;\n+    this.spec = spec;\n+  }\n+  \n+  public WebServiceRequest receive(HttpServletRequest request) {\n+    try {\n+      HeaderMap requestParams = buildRequestParams(request);\n+      RequestBody requestBody = buildRequestBody(request);\n+      \n+      HttpMethod method = HttpMethod.getMethod(request.getMethod());\n+      return new WebServiceRequest(method, requestParams, requestBody);\n+    } catch (IOException e) {\n+      throw new WebServiceSystemException(e);\n+    } catch (JsonParseException e) {\n+      // Not a Web service request\n+      throw new WebServiceSystemException(e);\n+    }\n+  }\n+  \n+  private HeaderMap buildRequestParams(HttpServletRequest request) {\n+    HeaderMapSpec paramsSpec = this.spec.getHeadersSpec();\n+    HeaderMap params = new HeaderMap(paramsSpec);\n+    for (Map.Entry<String, Type> param : paramsSpec.entrySet()) {\n+      String name = param.getKey();\n+      Type type = param.getValue();\n+      String header = request.getHeader(name);\n+      if (header == null || header.equals(\"\")) {\n+        // check parameter map for the value\n+        header = request.getParameter(name);\n+      }\n+      if (header != null && !header.equals(\"\")) { \n+        Object value = gson.fromJson(header, type);\n+        params.put(name, value);\n+      }\n+    }\n+    return params;\n+  }\n+  \n+  private RequestBody buildRequestBody(HttpServletRequest request) throws IOException {\n+    RequestBodySpec bodySpec = spec.getBodySpec();\n+    if (bodySpec.size() == 0) {\n+      return createEmptyRequestBody(bodySpec);\n+    }\n+    Reader reader = new BufferedReader(new InputStreamReader(request.getInputStream()));\n+    RequestBody requestBody = gson.fromJson(reader, RequestBody.class);\n+    return requestBody;\n+  }\n+\n+  private RequestBody createEmptyRequestBody(RequestBodySpec bodySpec) {\n+    return new RequestBody(bodySpec, new HashMap<String, Object>());\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/server/ResponseSender.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.server;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+import java.util.logging.Logger;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.wsf.HeaderMap;\n+import com.google.gson.wsf.HeaderMapSpec;\n+import com.google.gson.wsf.ResponseBody;\n+import com.google.gson.wsf.WebServiceResponse;\n+\n+/**\n+ * Sends a JSON web service response on {@link HttpServletResponse}.\n+ * \n+ * @author inder\n+ */\n+public final class ResponseSender {\n+  private static final Logger logger = Logger.getLogger(ResponseSender.class.getCanonicalName());\n+\n+  private Gson gson;\n+\n+  public ResponseSender(Gson gson) {\n+    this.gson = gson;\n+  }\n+  \n+  public void send(HttpServletResponse conn, WebServiceResponse response) {\n+    try {\n+      sendHeaders(conn, response.getHeaders());\n+      sendBody(conn, response.getBody());\n+    } catch (IOException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+ \n+  private void sendHeaders(HttpServletResponse conn, HeaderMap responseParams) {\n+    HeaderMapSpec spec = responseParams.getSpec();\n+    for (Map.Entry<String, Object> param : responseParams.entrySet()) {\n+      String paramName = param.getKey();\n+      Object paramValue = param.getValue();\n+      Type paramType = spec.getTypeFor(paramName);\n+      String json = gson.toJson(paramValue, paramType);\n+      logger.fine(\"RESPONSE HEADER:{\" + paramName + \", \" + json + \"}\");\n+      conn.addHeader(paramName, json);\n+    }\n+  }\n+\n+  private void sendBody(HttpServletResponse conn, ResponseBody responseBody) throws IOException {\n+    conn.setContentType(responseBody.getContentType());\n+    conn.setCharacterEncoding(responseBody.getCharacterEncoding());\n+    String json = gson.toJson(responseBody);\n+    logger.fine(\"RESPONSE BODY:\" + json);\n+    conn.getWriter().append(json);\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/typeadapters/RequestBodyGsonConverter.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.typeadapters;\n+\n+import java.lang.reflect.Type;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import com.google.gson.InstanceCreator;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+import com.google.gson.JsonSerializationContext;\n+import com.google.gson.JsonSerializer;\n+import com.google.gson.wsf.RequestBody;\n+import com.google.gson.wsf.RequestBodySpec;\n+\n+/**\n+ * Gson type adapter for {@link RequestBody}. \n+ * \n+ * @author inder\n+ */\n+public class RequestBodyGsonConverter implements JsonSerializer<RequestBody>, \n+  JsonDeserializer<RequestBody>, InstanceCreator<RequestBody> {\n+\n+  private final RequestBodySpec spec;\n+\n+  public RequestBodyGsonConverter(RequestBodySpec spec) {\n+    this.spec = spec;\n+  }\n+  \n+  @Override\n+  public JsonElement serialize(RequestBody src, Type typeOfSrc, \n+      JsonSerializationContext context) {\n+    JsonObject root = new JsonObject();\n+    for(Map.Entry<String, Object> entry : src.entrySet()) {\n+      String key = entry.getKey();\n+      Type entryType = src.getSpec().getTypeFor(key);\n+      JsonElement value = context.serialize(entry.getValue(), entryType);\n+      root.add(key, value);        \n+    }\n+    return root;\n+  }\n+\n+  @Override\n+  public RequestBody deserialize(JsonElement json, Type typeOfT, \n+      JsonDeserializationContext context) throws JsonParseException {\n+    RequestBody.Builder builder = new RequestBody.Builder(spec);\n+    for (Map.Entry<String, JsonElement> entry : json.getAsJsonObject().entrySet()) {\n+      String key = entry.getKey();\n+      Type entryType = spec.getTypeFor(key);\n+      Object value = context.deserialize(entry.getValue(), entryType);\n+      builder.add(key, value);\n+    }\n+    return builder.create();\n+  }\n+\n+  @Override\n+  public RequestBody createInstance(Type type) {\n+    return new RequestBody(spec, new HashMap<String, Object>());\n+  }\n+}\n--- /dev/null\n+++ b/wsf/src/main/java/com/google/gson/wsf/typeadapters/ResponseBodyGsonConverter.java\n+/*\n+ * Copyright (C) 2008 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.wsf.typeadapters;\n+\n+import java.lang.reflect.Type;\n+import java.util.Map;\n+\n+import com.google.gson.InstanceCreator;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+import com.google.gson.JsonSerializationContext;\n+import com.google.gson.JsonSerializer;\n+import com.google.gson.wsf.RequestBody;\n+import com.google.gson.wsf.ResponseBody;\n+import com.google.gson.wsf.ResponseBodySpec;\n+\n+/**\n+ * Gson type adapter for {@link ResponseBody}. \n+ * \n+ * @author inder\n+ */\n+public final class ResponseBodyGsonConverter implements JsonSerializer<ResponseBody>, \n+  JsonDeserializer<ResponseBody>, InstanceCreator<ResponseBody> {\n+\n+  private final ResponseBodySpec spec;\n+\n+  public ResponseBodyGsonConverter(ResponseBodySpec spec) {\n+    this.spec = spec;\n+  }\n+  \n+  @Override\n+  public JsonElement serialize(ResponseBody src, Type typeOfSrc, \n+      JsonSerializationContext context) {\n+    JsonObject root = new JsonObject();\n+    for(Map.Entry<String, Object> entry : src.entrySet()) {\n+      String key = entry.getKey();\n+      Type entryType = src.getSpec().getTypeFor(key);\n+      JsonElement value = context.serialize(entry.getValue(), entryType);\n+      root.add(key, value);        \n+    }\n+    return root;\n+  }\n+\n+  @Override\n+  public ResponseBody deserialize(JsonElement json, Type typeOfT, \n+      JsonDeserializationContext context) throws JsonParseException {\n+    ResponseBody responseBody = new ResponseBody(spec);\n+    for (Map.Entry<String, JsonElement> entry : json.getAsJsonObject().entrySet()) {\n+      String key = entry.getKey();\n+      Type entryType = spec.getTypeFor(key);\n+      Object value = context.deserialize(entry.getValue(), entryType);\n+      responseBody.put(key, value, entryType);\n+    }\n+    return responseBody;\n+  }\n+\n+  @Override\n+  public ResponseBody createInstance(Type type) {\n+    return new ResponseBody(spec);\n+  }\n+}", "timestamp": 1220276254, "metainfo": ""}