{"sha": "1cad54f7b15974fb415a7ac5b63621a7460e3862", "log": "Fix pretty printing of interlacing arrays and objects.", "commit": "\n--- a/gson/src/main/java/com/google/gson/JsonPrintFormatter.java\n+++ b/gson/src/main/java/com/google/gson/JsonPrintFormatter.java\n   }\n \n   private class PrintFormattingVisitor implements JsonElementVisitor {\n-    private final Map<Integer, Boolean> first;\n+    private final Map<Integer, Boolean> firstArrayElement;\n+    private final Map<Integer, Boolean> firstObjectMember;\n     private final JsonWriter writer;\n     private final boolean serializeNulls;\n     private int level = 0;\n     PrintFormattingVisitor(JsonWriter writer, boolean serializeNulls) {\n       this.writer = writer;\n       this.serializeNulls = serializeNulls;\n-      this.first = new HashMap<Integer, Boolean>();\n-    }\n-\n-    private void addCommaCheckingFirst() {\n+      this.firstArrayElement = new HashMap<Integer, Boolean>();\n+      this.firstObjectMember = new HashMap<Integer, Boolean>();\n+    }\n+\n+    private void addCommaCheckingFirst(Map<Integer, Boolean> first) {\n       if (first.get(level) != Boolean.FALSE) {\n         first.put(level, false);\n       } else {\n     }\n \n     public void startArray(JsonArray array) {\n-      first.put(++level, true);\n+      firstArrayElement.put(++level, true);\n       writer.beginArray();\n     }\n \n     public void visitArrayMember(JsonArray parent, JsonPrimitive member, boolean isFirst) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstArrayElement);\n       writer.value(member.toString());\n     }\n \n     public void visitArrayMember(JsonArray parent, JsonArray member, boolean first) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstArrayElement);\n     }\n \n     public void visitArrayMember(JsonArray parent, JsonObject member, boolean first) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstArrayElement);\n     }\n \n     public void visitNullArrayMember(JsonArray parent, boolean isFirst) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstArrayElement);\n     }\n \n     public void endArray(JsonArray array) {\n     }\n \n     public void startObject(JsonObject object) {\n+      firstObjectMember.put(level, true);\n       writer.beginObject();\n     }\n \n     public void visitObjectMember(JsonObject parent, String memberName, JsonPrimitive member, \n         boolean isFirst) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstObjectMember);\n       writer.key(memberName);\n       writer.fieldSeparator();\n       writer.value(member.toString());\n \n     public void visitObjectMember(JsonObject parent, String memberName, JsonArray member, \n         boolean isFirst) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstObjectMember);\n       writer.key(memberName);\n       writer.fieldSeparator();\n     }\n \n     public void visitObjectMember(JsonObject parent, String memberName, JsonObject member, \n         boolean isFirst) {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(firstObjectMember);\n       writer.key(memberName);\n       writer.fieldSeparator();\n     }", "timestamp": 1222542105, "metainfo": ""}