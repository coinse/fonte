{"sha": "d5741b321f6a1c543fb330a8bc11a9fc882748d7", "log": "Don't exclude enum constants, even if they are anonymous. See issue 226.", "commit": "\n--- a/gson/src/main/java/com/google/gson/AnonymousAndLocalClassExclusionStrategy.java\n+++ b/gson/src/main/java/com/google/gson/AnonymousAndLocalClassExclusionStrategy.java\n   }\n \n   private boolean isAnonymousOrLocal(Class<?> clazz) {\n-    return clazz.isAnonymousClass() || clazz.isLocalClass();\n+    return !Enum.class.isAssignableFrom(clazz)\n+        && (clazz.isAnonymousClass() || clazz.isLocalClass());\n   }\n }\n--- a/gson/src/test/java/com/google/gson/functional/EnumTest.java\n+++ b/gson/src/test/java/com/google/gson/functional/EnumTest.java\n import com.google.gson.common.MoreAsserts;\n import com.google.gson.reflect.TypeToken;\n \n+import java.util.Arrays;\n+import java.util.EnumSet;\n+import java.util.List;\n+import java.util.Set;\n import junit.framework.TestCase;\n \n import java.lang.reflect.Type;\n       return \"{\\\"value1\\\":\\\"\" + value1 + \"\\\",\\\"value2\\\":\\\"\" + value2 + \"\\\"}\";\n     }\n   }\n+\n+  /**\n+   * Test for issue 226.\n+   */\n+  public void testEnumSubclass() {\n+    assertFalse(Roshambo.class == Roshambo.ROCK.getClass());\n+    assertEquals(\"\\\"ROCK\\\"\", gson.toJson(Roshambo.ROCK));\n+    assertEquals(\"[\\\"ROCK\\\",\\\"PAPER\\\",\\\"SCISSORS\\\"]\", gson.toJson(EnumSet.allOf(Roshambo.class)));\n+    assertEquals(Roshambo.ROCK, gson.fromJson(\"\\\"ROCK\\\"\", Roshambo.class));\n+    assertEquals(EnumSet.allOf(Roshambo.class),\n+        gson.fromJson(\"[\\\"ROCK\\\",\\\"PAPER\\\",\\\"SCISSORS\\\"]\", new TypeToken<Set<Roshambo>>() {}.getType()));\n+  }\n+\n+  private enum Roshambo {\n+    ROCK {\n+      @Override Roshambo defeats() {\n+        return SCISSORS;\n+      }\n+    },\n+    PAPER {\n+      @Override Roshambo defeats() {\n+        return ROCK;\n+      }\n+    },\n+    SCISSORS {\n+      @Override Roshambo defeats() {\n+        return PAPER;\n+      }\n+    };\n+\n+    abstract Roshambo defeats();\n+  }\n }", "timestamp": 1282893995, "metainfo": ""}