{"sha": "77c2c29316dd1d8fc7ea608dd6f67585bb6b006c", "log": "Implementing code review feedback from r454: using isFirst instead of the Stack to keep track of whether to add commas or not.", "commit": "\n--- a/gson/src/main/java/com/google/gson/JsonPrintFormatter.java\n+++ b/gson/src/main/java/com/google/gson/JsonPrintFormatter.java\n   }\n \n   private class PrintFormattingVisitor implements JsonElementVisitor {\n-    private final Stack<Boolean> firstElementInLevel;\n     private final JsonWriter writer;\n     private final Escaper escaper;\n     private final boolean serializeNulls;\n       this.writer = writer;\n       this.escaper = escaper;\n       this.serializeNulls = serializeNulls;\n-      this.firstElementInLevel = new Stack<Boolean>();\n-    }\n-\n-    private void addCommaCheckingFirst() throws IOException {\n-      if (firstElementInLevel.peek()) {\n-        // No longer first\n-        firstElementInLevel.pop();\n-        firstElementInLevel.push(false);\n-      } else {\n+    }\n+\n+    private void addCommaCheckingFirst(boolean first) throws IOException {\n+      if (!first) {\n         writer.elementSeparator();\n       }\n     }\n \n     public void startArray(JsonArray array) throws IOException {\n-      firstElementInLevel.push(true);\n       writer.beginArray();\n     }\n \n     public void visitArrayMember(JsonArray parent, JsonPrimitive member, \n         boolean isFirst) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(isFirst);\n       writer.value(escapeJsonPrimitive(member));\n     }\n \n     public void visitArrayMember(JsonArray parent, JsonArray member, \n         boolean first) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(first);\n     }\n \n     public void visitArrayMember(JsonArray parent, JsonObject member, \n         boolean first) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(first);\n     }\n \n     public void visitNullArrayMember(JsonArray parent, boolean isFirst) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(isFirst);\n     }\n \n     public void endArray(JsonArray array) {\n       writer.endArray();\n-      firstElementInLevel.pop();\n     }\n \n     public void startObject(JsonObject object) throws IOException {\n-      firstElementInLevel.push(true);\n       writer.beginObject();\n     }\n \n     public void visitObjectMember(JsonObject parent, String memberName, JsonPrimitive member, \n         boolean isFirst) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(isFirst);\n       writer.key(memberName);\n       writer.fieldSeparator();\n       writer.value(escapeJsonPrimitive(member));\n \n     public void visitObjectMember(JsonObject parent, String memberName, JsonArray member, \n         boolean isFirst) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(isFirst);\n       writer.key(memberName);\n       writer.fieldSeparator();\n     }\n \n     public void visitObjectMember(JsonObject parent, String memberName, JsonObject member, \n         boolean isFirst) throws IOException {\n-      addCommaCheckingFirst();\n+      addCommaCheckingFirst(isFirst);\n       writer.key(memberName);\n       writer.fieldSeparator();\n     }\n     \n     public void endObject(JsonObject object) {\n       writer.endObject();\n-      firstElementInLevel.pop();\n     }\n \n     public void visitPrimitive(JsonPrimitive primitive) throws IOException {", "timestamp": 1254358675, "metainfo": ""}