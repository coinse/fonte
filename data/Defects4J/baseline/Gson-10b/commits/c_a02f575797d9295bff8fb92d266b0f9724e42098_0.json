{"sha": "a02f575797d9295bff8fb92d266b0f9724e42098", "log": "Merge pull request #806 from qwwdfsad/master  Gson synchronized map replaced with concurrent hash map", "commit": "\n--- a/gson/src/main/java/com/google/gson/Gson.java\n+++ b/gson/src/main/java/com/google/gson/Gson.java\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.atomic.AtomicLong;\n import java.util.concurrent.atomic.AtomicLongArray;\n \n   static final boolean DEFAULT_COMPLEX_MAP_KEYS = false;\n   static final boolean DEFAULT_SPECIALIZE_FLOAT_VALUES = false;\n \n+  private static final TypeToken<?> NULL_KEY_SURROGATE = new TypeToken<Object>() {};\n   private static final String JSON_NON_EXECUTABLE_PREFIX = \")]}'\\n\";\n \n   /**\n   private final ThreadLocal<Map<TypeToken<?>, FutureTypeAdapter<?>>> calls\n       = new ThreadLocal<Map<TypeToken<?>, FutureTypeAdapter<?>>>();\n \n-  private final Map<TypeToken<?>, TypeAdapter<?>> typeTokenCache\n-      = Collections.synchronizedMap(new HashMap<TypeToken<?>, TypeAdapter<?>>());\n+  private final Map<TypeToken<?>, TypeAdapter<?>> typeTokenCache = new ConcurrentHashMap<TypeToken<?>, TypeAdapter<?>>();\n \n   private final List<TypeAdapterFactory> factories;\n   private final ConstructorConstructor constructorConstructor;\n    */\n   @SuppressWarnings(\"unchecked\")\n   public <T> TypeAdapter<T> getAdapter(TypeToken<T> type) {\n-    TypeAdapter<?> cached = typeTokenCache.get(type);\n+    TypeAdapter<?> cached = typeTokenCache.get(type == null ? NULL_KEY_SURROGATE : type);\n     if (cached != null) {\n       return (TypeAdapter<T>) cached;\n     }", "timestamp": 1457214852, "metainfo": ""}