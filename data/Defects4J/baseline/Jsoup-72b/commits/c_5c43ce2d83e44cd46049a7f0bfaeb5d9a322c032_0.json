{"sha": "5c43ce2d83e44cd46049a7f0bfaeb5d9a322c032", "log": "Fixed NPE in Parser.parseFragment() when context parameter is null.  Fixes #195.", "commit": "\n--- a/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java\n+++ b/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java\n \n     List<Node> parseFragment(String inputFragment, Element context, String baseUri, ParseErrorList errors) {\n         // context may be null\n+        state = HtmlTreeBuilderState.Initial;\n         initialiseParse(inputFragment, baseUri, errors);\n         contextElement = context;\n         fragmentParsing = true;\n--- a/src/test/java/org/jsoup/parser/HtmlParserTest.java\n+++ b/src/test/java/org/jsoup/parser/HtmlParserTest.java\n \n import org.jsoup.Jsoup;\n import org.jsoup.TextUtil;\n-import org.jsoup.nodes.Comment;\n-import org.jsoup.nodes.Document;\n-import org.jsoup.nodes.Element;\n-import org.jsoup.nodes.TextNode;\n+import org.jsoup.helper.StringUtil;\n+import org.jsoup.nodes.*;\n import org.jsoup.select.Elements;\n import org.junit.Test;\n \n                 \"  // -->\\n\" +\n                 \"</script>\", node.body().html());\n     }\n+\n+    @Test public void handleNullContextInParseFragment() {\n+        String html = \"<ol><li>One</li></ol><p>Two</p>\";\n+        List<Node> nodes = Parser.parseFragment(html, null, \"http://example.com/\");\n+        assertEquals(1, nodes.size()); // returns <html> node (not document) -- no context means doc gets created\n+        assertEquals(\"html\", nodes.get(0).nodeName());\n+        assertEquals(\"<html> <head></head> <body> <ol> <li>One</li> </ol> <p>Two</p> </body> </html>\", StringUtil.normaliseWhitespace(nodes.get(0).outerHtml()));\n+    }\n }", "timestamp": 1338066740, "metainfo": ""}