{"sha": "c33ba536da04e5b22a1c2740ce38761300dd13a9", "log": "fixed issue #916 (#928)  * fixed issue #916\r \r fixed issue #916 InputStream not closed in class org.jsoup.nodes.Entities.\r use jdk7 try-with-resources to close \"BufferReader input\".\r \r * fixed issue #916\r \r try-with-resources makes use of Throwable.addSuppressed(Throwable) which was officially added with API 19.\r using normal try-catch block instead.", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Entities.java\n+++ b/src/main/java/org/jsoup/nodes/Entities.java\n             throw new IllegalStateException(\"Could not read resource \" + file + \". Make sure you copy resources for \" + Entities.class.getCanonicalName());\n \n         int i = 0;\n-        BufferedReader input = new BufferedReader(new InputStreamReader(stream, ASCII));\n-        CharacterReader reader = new CharacterReader(input);\n-\n-        while (!reader.isEmpty()) {\n-            // NotNestedLessLess=10913,824;1887\n-\n-            final String name = reader.consumeTo('=');\n-            reader.advance();\n-            final int cp1 = Integer.parseInt(reader.consumeToAny(codeDelims), codepointRadix);\n-            final char codeDelim = reader.current();\n-            reader.advance();\n-            final int cp2;\n-            if (codeDelim == ',') {\n-                cp2 = Integer.parseInt(reader.consumeTo(';'), codepointRadix);\n+        BufferedReader input = null;\n+        try {\n+            input = new BufferedReader(new InputStreamReader(stream, ASCII));\n+            CharacterReader reader = new CharacterReader(input);\n+\n+            while (!reader.isEmpty()) {\n+                // NotNestedLessLess=10913,824;1887\n+\n+                final String name = reader.consumeTo('=');\n                 reader.advance();\n-            } else {\n-                cp2 = empty;\n-            }\n-            String indexS = reader.consumeTo('\\n');\n-            // default git checkout on windows will add a \\r there, so remove\n-            if (indexS.charAt(indexS.length() - 1) == '\\r') {\n-                indexS = indexS.substring(0, indexS.length() - 1);\n-            }\n-            final int index = Integer.parseInt(indexS, codepointRadix);\n-            reader.advance();\n-\n-            e.nameKeys[i] = name;\n-            e.codeVals[i] = cp1;\n-            e.codeKeys[index] = cp1;\n-            e.nameVals[index] = name;\n-\n-            if (cp2 != empty) {\n-                multipoints.put(name, new String(new int[]{cp1, cp2}, 0, 2));\n-            }\n-            i++;\n+                final int cp1 = Integer.parseInt(reader.consumeToAny(codeDelims), codepointRadix);\n+                final char codeDelim = reader.current();\n+                reader.advance();\n+                final int cp2;\n+                if (codeDelim == ',') {\n+                    cp2 = Integer.parseInt(reader.consumeTo(';'), codepointRadix);\n+                    reader.advance();\n+                } else {\n+                    cp2 = empty;\n+                }\n+                String indexS = reader.consumeTo('\\n');\n+                // default git checkout on windows will add a \\r there, so remove\n+                if (indexS.charAt(indexS.length() - 1) == '\\r') {\n+                    indexS = indexS.substring(0, indexS.length() - 1);\n+                }\n+                final int index = Integer.parseInt(indexS, codepointRadix);\n+                reader.advance();\n+\n+                e.nameKeys[i] = name;\n+                e.codeVals[i] = cp1;\n+                e.codeKeys[index] = cp1;\n+                e.nameVals[index] = name;\n+\n+                if (cp2 != empty) {\n+                    multipoints.put(name, new String(new int[]{cp1, cp2}, 0, 2));\n+                }\n+                i++;\n+            }\n+        } finally {\n+            try {\n+                if (input != null) {\n+                    input.close();\n+                }\n+            } catch (IOException e1) {\n+                //ignore exception\n+            }\n         }\n         Validate.isTrue(i == size, \"Unexpected count of entities loaded for \" + file);\n     }", "timestamp": 1507415246, "metainfo": ""}