{"sha": "aeaf3c1a03fe4d5bfda4d63824a1f97dcec42e74", "log": "Search further up the stack for <pre>  Fixes #722", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Element.java\n+++ b/src/main/java/org/jsoup/nodes/Element.java\n     }\n \n     static boolean preserveWhitespace(Node node) {\n-        // looks only at this element and one level up, to prevent recursion & needless stack searches\n+        // looks only at this element and five levels up, to prevent recursion & needless stack searches\n         if (node != null && node instanceof Element) {\n-            Element element = (Element) node;\n-            return element.tag.preserveWhitespace() ||\n-                element.parent() != null && element.parent().tag.preserveWhitespace();\n+            Element el = (Element) node;\n+            int i = 0;\n+            do {\n+                if (el.tag.preserveWhitespace())\n+                    return true;\n+                el = el.parent();\n+                i++;\n+            } while (i < 6 && el != null);\n         }\n         return false;\n     }\n--- a/src/test/java/org/jsoup/nodes/ElementTest.java\n+++ b/src/test/java/org/jsoup/nodes/ElementTest.java\n         Document doc = Jsoup.parse(h);\n         assertEquals(\"code\\n\\ncode\", doc.text());\n         assertEquals(\"<pre><code>code\\n\\ncode</code></pre>\", doc.body().html());\n+    }\n+\n+    @Test public void testKeepsPreTextAtDepth() {\n+        String h = \"<pre><code><span><b>code\\n\\ncode</b></span></code></pre>\";\n+        Document doc = Jsoup.parse(h);\n+        assertEquals(\"code\\n\\ncode\", doc.text());\n+        assertEquals(\"<pre><code><span><b>code\\n\\ncode</b></span></code></pre>\", doc.body().html());\n     }\n \n     @Test public void testBrHasSpace() {", "timestamp": 1510531351, "metainfo": ""}