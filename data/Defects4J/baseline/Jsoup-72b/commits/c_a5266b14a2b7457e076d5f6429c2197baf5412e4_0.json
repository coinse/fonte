{"sha": "a5266b14a2b7457e076d5f6429c2197baf5412e4", "log": "Consider all meta elements until a charset is found", "commit": "\n--- a/src/main/java/org/jsoup/helper/DataUtil.java\n+++ b/src/main/java/org/jsoup/helper/DataUtil.java\n import org.jsoup.nodes.Element;\n import org.jsoup.nodes.XmlDeclaration;\n import org.jsoup.parser.Parser;\n+import org.jsoup.select.Elements;\n \n import java.io.ByteArrayOutputStream;\n import java.io.File;\n             // look for <meta http-equiv=\"Content-Type\" content=\"text/html;charset=gb2312\"> or HTML5 <meta charset=\"gb2312\">\n             docData = Charset.forName(defaultCharset).decode(byteData).toString();\n             doc = parser.parseInput(docData, baseUri);\n-            Element meta = doc.select(\"meta[http-equiv=content-type], meta[charset]\").first();\n+            Elements metaElements = doc.select(\"meta[http-equiv=content-type], meta[charset]\");\n             String foundCharset = null; // if not found, will keep utf-8 as best attempt\n-            if (meta != null) {\n+            for (Element meta : metaElements) {\n                 if (meta.hasAttr(\"http-equiv\")) {\n                     foundCharset = getCharsetFromContentType(meta.attr(\"content\"));\n                 }\n                 if (foundCharset == null && meta.hasAttr(\"charset\")) {\n                     foundCharset = meta.attr(\"charset\");\n                 }\n-            }\n+                if (foundCharset != null) {\n+                    break;\n+                }\n+            }\n+\n             // look for <?xml encoding='ISO-8859-1'?>\n             if (foundCharset == null && doc.childNodeSize() > 0 && doc.childNode(0) instanceof XmlDeclaration) {\n                 XmlDeclaration prolog = (XmlDeclaration) doc.childNode(0);\n--- a/src/test/java/org/jsoup/helper/DataUtilTest.java\n+++ b/src/test/java/org/jsoup/helper/DataUtilTest.java\n     }\n \n     @Test\n+    public void firstMetaElementWithCharsetShouldBeUsedForDecoding() throws Exception {\n+        ByteBuffer inBuffer = ByteBuffer.wrap((\"<html><head>\" +\n+                \"<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=iso-8859-1\\\">\" +\n+                \"<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=koi8-u\\\">\" +\n+                \"</head><body>\u00dcbergr\u00f6\u00dfentr\u00e4ger</body></html>\").getBytes(\"iso-8859-1\"));\n+\n+        Document doc = DataUtil.parseByteData(inBuffer, null, \"http://example.com\", Parser.htmlParser());\n+\n+        assertEquals(\"\u00dcbergr\u00f6\u00dfentr\u00e4ger\", doc.body().text());\n+    }\n+\n+    @Test\n     public void supportsBOMinFiles() throws IOException {\n         // test files from http://www.i18nl10n.com/korean/utftest/\n         File in = getFile(\"/bomtests/bom_utf16be.html\");", "timestamp": 1487756074, "metainfo": ""}