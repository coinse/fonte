{"sha": "4d78e0316e1eae331bc0b460f367ce878688d6d2", "log": "Sort at write time, not start time", "commit": "\n--- a/src/main/java/org/jsoup/parser/TokeniserState.java\n+++ b/src/main/java/org/jsoup/parser/TokeniserState.java\n package org.jsoup.parser;\n \n import org.jsoup.nodes.DocumentType;\n-\n-import java.util.Arrays;\n \n /**\n  * States and transition activations for the Tokeniser.\n     abstract void read(Tokeniser t, CharacterReader r);\n \n     static final char nullChar = '\\u0000';\n-    private static final char[] attributeSingleValueCharsSorted = new char[]{'\\'', '&', nullChar};\n-    private static final char[] attributeDoubleValueCharsSorted = new char[]{'\"', '&', nullChar};\n-    private static final char[] attributeNameCharsSorted = new char[]{'\\t', '\\n', '\\r', '\\f', ' ', '/', '=', '>', nullChar, '\"', '\\'', '<'};\n-    private static final char[] attributeValueUnquoted = new char[]{'\\t', '\\n', '\\r', '\\f', ' ', '&', '>', nullChar, '\"', '\\'', '<', '=', '`'};\n+    // char searches. must be sorted, used in inSorted. MUST update TokenisetStateTest if more arrays are added.\n+    static final char[] attributeSingleValueCharsSorted = new char[]{nullChar, '&', '\\''};\n+    static final char[] attributeDoubleValueCharsSorted = new char[]{nullChar, '\"', '&'};\n+    static final char[] attributeNameCharsSorted = new char[]{nullChar, '\\t', '\\n', '\\f', '\\r', ' ', '\"', '\\'', '/', '<', '=', '>'};\n+    static final char[] attributeValueUnquoted = new char[]{nullChar, '\\t', '\\n', '\\f', '\\r', ' ', '\"', '&', '\\'', '<', '=', '>', '`'};\n \n     private static final char replacementChar = Tokeniser.replacementChar;\n     private static final String replacementStr = String.valueOf(Tokeniser.replacementChar);\n     private static final char eof = CharacterReader.EOF;\n-\n-    static {\n-        Arrays.sort(attributeSingleValueCharsSorted);\n-        Arrays.sort(attributeDoubleValueCharsSorted);\n-        Arrays.sort(attributeNameCharsSorted);\n-        Arrays.sort(attributeValueUnquoted);\n-    }\n \n     /**\n      * Handles RawtextEndTagName, ScriptDataEndTagName, and ScriptDataEscapedEndTagName. Same body impl, just\n--- /dev/null\n+++ b/src/test/java/org/jsoup/parser/TokenisetStateTest.java\n+package org.jsoup.parser;\n+\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+\n+import static org.junit.Assert.assertArrayEquals;\n+\n+public class TokenisetStateTest {\n+    @Test\n+    public void ensureSearchArraysAreSorted() {\n+        char[][] arrays = {\n+            TokeniserState.attributeSingleValueCharsSorted,\n+            TokeniserState.attributeDoubleValueCharsSorted,\n+            TokeniserState.attributeNameCharsSorted,\n+            TokeniserState.attributeValueUnquoted\n+        };\n+\n+        for (char[] array : arrays) {\n+            char[] copy = Arrays.copyOf(array, array.length);\n+            Arrays.sort(array);\n+            assertArrayEquals(array, copy);\n+        }\n+    }\n+}", "timestamp": 1510525390, "metainfo": ""}