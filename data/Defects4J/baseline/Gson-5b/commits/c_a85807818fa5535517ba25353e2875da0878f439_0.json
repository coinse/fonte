{"sha": "a85807818fa5535517ba25353e2875da0878f439", "log": "Invoking Gson toJson and fromJson with-in the Android application. Gson.fromJson does not currently work in this application with proguard enabled: The reason seems to be that Cart's field List<LineItem> gets rewritten as raw List type.", "commit": "\n--- a/examples/android-proguard-example/src/com/google/gson/examples/android/GsonProguardExampleActivity.java\n+++ b/examples/android-proguard-example/src/com/google/gson/examples/android/GsonProguardExampleActivity.java\n  */\n package com.google.gson.examples.android;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n import android.app.Activity;\n import android.os.Bundle;\n import android.widget.TextView;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.examples.android.model.Cart;\n+import com.google.gson.examples.android.model.LineItem;\n \n /**\n  * Activity class illustrating how to use proguard with Gson\n     super.onCreate(icicle);\n     setContentView(R.layout.main);\n     TextView tv = (TextView) findViewById(R.id.tv);\n-    tv.setText(\"Hello World\");\n+    Gson gson = new Gson();\n+    Cart cart = buildCart();\n+    StringBuilder sb = new StringBuilder();\n+    sb.append(\"Gson.toJson() example: \\n\");\n+    sb.append(\"  Cart Object: \").append(cart).append(\"\\n\");\n+    sb.append(\"  Cart JSON: \").append(gson.toJson(cart)).append(\"\\n\");\n+    sb.append(\"\\n\\nGson.fromJson() example: \\n\");\n+    String json = \"{buyer:'Happy Camper',creditCard:'4111-1111-1111-1111',\"\n+      + \"lineItems:[{name:'nails',priceInMicros:100000,quantity:100,currencyCode:'USD'}]}\";\n+    sb.append(\"Cart JSON: \").append(json).append(\"\\n\");\n+    sb.append(\"Cart Object: \").append(gson.fromJson(json, Cart.class)).append(\"\\n\");\n+    tv.setText(sb.toString());\n     tv.invalidate();\n   }\n+\n+  private Cart buildCart() {\n+    List<LineItem> lineItems = new ArrayList<LineItem>();\n+    lineItems.add(new LineItem(\"hammer\", 1, 12000000, \"USD\"));\n+    return new Cart(lineItems, \"Happy Buyer\", \"4111-1111-1111-1111\");\n+  }\n }\n--- /dev/null\n+++ b/examples/android-proguard-example/src/com/google/gson/examples/android/model/Cart.java\n+/*\n+ * Copyright (C) 2011 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.examples.android.model;\n+\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+import java.lang.reflect.WildcardType;\n+import java.util.List;\n+\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * A model object representing a cart that can be posted to an order-processing server\n+ * \n+ * @author Inderjeet Singh\n+ */\n+public class Cart {\n+  public final List<LineItem> lineItems;\n+\n+  @SerializedName(\"buyer\")\n+  private final String buyerName;\n+\n+  private final String creditCard;\n+\n+  public Cart(List<LineItem> lineItems, String buyerName, String creditCard) {\n+    this.lineItems = lineItems;\n+    this.buyerName = buyerName;\n+    this.creditCard = creditCard;\n+  }\n+\n+  public List<LineItem> getLineItems() {\n+    return lineItems;\n+  }\n+\n+  public String getBuyerName() {\n+    return buyerName;\n+  }\n+\n+  public String getCreditCard() {\n+    return creditCard;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder itemsText = new StringBuilder();\n+    boolean first = true;\n+    if (lineItems != null) {\n+      try {\n+        Class<?> fieldType = Cart.class.getField(\"lineItems\").getType();\n+        System.out.println(\"LineItems CLASS: \" + getSimpleTypeName(fieldType));\n+      } catch (SecurityException e) {\n+      } catch (NoSuchFieldException e) {\n+      }\n+      for (LineItem item : lineItems) {\n+        if (first) {\n+          first = false;\n+        } else {\n+          itemsText.append(\"; \");\n+        }\n+        itemsText.append(item);\n+      }\n+    }\n+    return \"[BUYER: \" + buyerName + \"; CC: \" + creditCard + \"; \"\n+    + \"LINE_ITEMS: \" + itemsText.toString() + \"]\";\n+  }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  public static String getSimpleTypeName(Type type) {\n+    if (type == null) {\n+      return \"null\";\n+    }\n+    if (type instanceof Class) {\n+      return ((Class)type).getSimpleName();\n+    } else if (type instanceof ParameterizedType) {\n+      ParameterizedType pType = (ParameterizedType) type;\n+      StringBuilder sb = new StringBuilder(getSimpleTypeName(pType.getRawType()));\n+      sb.append('<');\n+      boolean first = true;\n+      for (Type argumentType : pType.getActualTypeArguments()) {\n+        if (first) {\n+          first = false;\n+        } else {\n+          sb.append(',');\n+        }\n+        sb.append(getSimpleTypeName(argumentType));\n+      }\n+      sb.append('>');\n+      return sb.toString();\n+    } else if (type instanceof WildcardType) {\n+      return \"?\";\n+    }\n+    return type.toString();\n+  }\n+\n+}\n--- /dev/null\n+++ b/examples/android-proguard-example/src/com/google/gson/examples/android/model/LineItem.java\n+/*\n+ * Copyright (C) 2011 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.google.gson.examples.android.model;\n+\n+/**\n+ * A line item in a cart. This is not a rest resource, just a dependent object\n+ *\n+ * @author Inderjeet Singh\n+ */\n+public class LineItem {\n+  private final String name;\n+  private final int quantity;\n+  private final long priceInMicros;\n+  private final String currencyCode;\n+\n+  public LineItem(String name, int quantity, long priceInMicros, String currencyCode) {\n+    this.name = name;\n+    this.quantity = quantity;\n+    this.priceInMicros = priceInMicros;\n+    this.currencyCode = currencyCode;\n+  }\n+\n+  public String getName() {\n+    return name;\n+  }\n+\n+  public int getQuantity() {\n+    return quantity;\n+  }\n+\n+  public long getPriceInMicros() {\n+    return priceInMicros;\n+  }\n+\n+  public String getCurrencyCode() {\n+    return currencyCode;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return String.format(\"(item: %s, qty: %s, price: %.2f %s)\",\n+        name, quantity, priceInMicros/(double)1000000, currencyCode);\n+  }\n+}", "timestamp": 1311383314, "metainfo": ""}