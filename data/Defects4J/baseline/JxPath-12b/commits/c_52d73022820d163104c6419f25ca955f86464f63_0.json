{"sha": "52d73022820d163104c6419f25ca955f86464f63", "log": "[JXPATH-97] enable externally-registered namespaces on XML attributes  ", "commit": "\n--- a/src/java/org/apache/commons/jxpath/ri/model/dom/DOMAttributeIterator.java\n+++ b/src/java/org/apache/commons/jxpath/ri/model/dom/DOMAttributeIterator.java\n import java.util.ArrayList;\n import java.util.List;\n \n+import org.apache.commons.jxpath.ri.NamespaceResolver;\n import org.apache.commons.jxpath.ri.QName;\n import org.apache.commons.jxpath.ri.model.NodeIterator;\n import org.apache.commons.jxpath.ri.model.NodePointer;\n         String testNS = null;\n \n         if (testPrefix != null) {\n-            testNS = parent.getNamespaceURI(testPrefix);\n+            NamespaceResolver nsr = parent.getNamespaceResolver();\n+            testNS = nsr == null ? null : nsr.getNamespaceURI(testPrefix);\n+            testNS = testNS == null ? parent.getNamespaceURI(testPrefix) : testNS;\n         }\n \n         if (testNS != null) {\n--- a/src/java/org/apache/commons/jxpath/ri/model/jdom/JDOMAttributeIterator.java\n+++ b/src/java/org/apache/commons/jxpath/ri/model/jdom/JDOMAttributeIterator.java\n import java.util.Collections;\n import java.util.List;\n \n+import org.apache.commons.jxpath.ri.NamespaceResolver;\n import org.apache.commons.jxpath.ri.QName;\n import org.apache.commons.jxpath.ri.model.NodeIterator;\n import org.apache.commons.jxpath.ri.model.NodePointer;\n         if (parent.getNode() instanceof Element) {\n             Element element = (Element) parent.getNode();\n             String prefix = name.getPrefix();\n-            Namespace ns;\n+            Namespace ns = null;\n             if (prefix != null) {\n                 if (prefix.equals(\"xml\")) {\n                     ns = Namespace.XML_NAMESPACE;\n                 }\n                 else {\n-                    ns = element.getNamespace(prefix);\n+                    NamespaceResolver nsr = parent.getNamespaceResolver();\n+                    if (nsr != null) {\n+                        String uri = nsr.getNamespaceURI(prefix);\n+                        if (uri != null) {\n+                            ns = Namespace.getNamespace(prefix, uri);\n+                        }\n+                    }\n                     if (ns == null) {\n-                        // TBD: no attributes\n-                        attributes = Collections.EMPTY_LIST;\n-                        return;\n+                        ns = element.getNamespace(prefix);\n+                        if (ns == null) {\n+                            // TBD: no attributes\n+                            attributes = Collections.EMPTY_LIST;\n+                            return;\n+                        }\n                     }\n                 }\n             }\n--- a/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java\n+++ b/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java\n                 \"count(vendor/product/rate:*)\", \n                 new Double(2));\n \n+        assertXPathValue(context,\n+                \"vendor[1]/product[1]/rate:amount[1]/@rate:discount\", \"10%\");\n+        assertXPathValue(context,\n+                \"vendor[1]/product[1]/rate:amount[1]/@price:discount\", \"10%\");\n+        assertXPathValue(context,\n+                \"vendor[1]/product[1]/price:amount[1]/@rate:discount\", \"10%\");\n+        assertXPathValue(context,\n+                \"vendor[1]/product[1]/price:amount[1]/@price:discount\", \"10%\");\n+\n         // Preference for externally registered namespace prefix\n         assertXPathValueAndPointer(context,\n                 \"//product:name\",", "timestamp": 1185218866, "metainfo": ""}