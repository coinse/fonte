{"sha": "2d4907ebb2c652cb55dc145cff9f9cce097e3fb8", "log": "Fixed document order problem for the descendant-or-self axis   ", "commit": "\n--- a/src/java/org/apache/commons/jxpath/ri/EvalContext.java\n+++ b/src/java/org/apache/commons/jxpath/ri/EvalContext.java\n /*\n- * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//jxpath/src/java/org/apache/commons/jxpath/ri/EvalContext.java,v 1.24 2003/03/25 02:41:33 dmitri Exp $\n- * $Revision: 1.24 $\n- * $Date: 2003/03/25 02:41:33 $\n+ * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//jxpath/src/java/org/apache/commons/jxpath/ri/EvalContext.java,v 1.25 2003/06/26 02:18:46 dmitri Exp $\n+ * $Revision: 1.25 $\n+ * $Date: 2003/06/26 02:18:46 $\n  *\n  * ====================================================================\n  * The Apache Software License, Version 1.1\n import org.apache.commons.jxpath.JXPathException;\n import org.apache.commons.jxpath.NodeSet;\n import org.apache.commons.jxpath.Pointer;\n+import org.apache.commons.jxpath.ri.axes.*;\n+import org.apache.commons.jxpath.ri.axes.AncestorContext;\n+import org.apache.commons.jxpath.ri.axes.DescendantContext;\n import org.apache.commons.jxpath.ri.axes.RootContext;\n import org.apache.commons.jxpath.ri.model.NodePointer;\n \n  * implement behavior of various XPath axes: \"child::\", \"parent::\" etc.\n  *\n  * @author Dmitri Plotnikov\n- * @version $Revision: 1.24 $ $Date: 2003/03/25 02:41:33 $\n+ * @version $Revision: 1.25 $ $Date: 2003/06/26 02:18:46 $\n  */\n public abstract class EvalContext implements ExpressionContext, Iterator {\n     protected EvalContext parentContext;\n      *  0 - does not require ordering\n      */\n     public int getDocumentOrder() {\n-        // Default behavior: if the parent needs to be ordered,\n-        // this one needs to be ordered too\n-        if (parentContext != null && parentContext.getDocumentOrder() != 0) {\n+        if (parentContext != null && parentContext.isChildOrderingRequired()) {\n             return 1;\n         }\n         return 0;\n+    }\n+    \n+    /**\n+     * Even if this context has the natural ordering and therefore does\n+     * not require collecting and sorting all nodes prior to returning them,\n+     * such operation may be required for any child context.\n+     */\n+    public boolean isChildOrderingRequired() {\n+        // Default behavior: if this context needs to be ordered,\n+        // the children need to be ordered too\n+        if (getDocumentOrder() != 0) {\n+            return true;\n+        }\n+        return false;\n     }\n \n     /**\n--- a/src/java/org/apache/commons/jxpath/ri/axes/DescendantContext.java\n+++ b/src/java/org/apache/commons/jxpath/ri/axes/DescendantContext.java\n /*\n- * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//jxpath/src/java/org/apache/commons/jxpath/ri/axes/DescendantContext.java,v 1.13 2003/05/04 23:53:19 dmitri Exp $\n- * $Revision: 1.13 $\n- * $Date: 2003/05/04 23:53:19 $\n+ * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//jxpath/src/java/org/apache/commons/jxpath/ri/axes/DescendantContext.java,v 1.14 2003/06/26 02:18:47 dmitri Exp $\n+ * $Revision: 1.14 $\n+ * $Date: 2003/06/26 02:18:47 $\n  *\n  * ====================================================================\n  * The Apache Software License, Version 1.1\n  * axes.\n  *\n  * @author Dmitri Plotnikov\n- * @version $Revision: 1.13 $ $Date: 2003/05/04 23:53:19 $\n+ * @version $Revision: 1.14 $ $Date: 2003/06/26 02:18:47 $\n  */\n public class DescendantContext extends EvalContext {\n     private NodeTest nodeTest;\n         super(parentContext);\n         this.includeSelf = includeSelf;\n         this.nodeTest = nodeTest;\n+    }\n+\n+    public boolean isChildOrderingRequired() {\n+        return true;\n     }\n \n     public NodePointer getCurrentNodePointer() {\n--- a/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java\n+++ b/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java\n /*\n- * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//jxpath/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java,v 1.10 2003/03/11 00:59:38 dmitri Exp $\n- * $Revision: 1.10 $\n- * $Date: 2003/03/11 00:59:38 $\n+ * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//jxpath/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java,v 1.11 2003/06/26 02:18:46 dmitri Exp $\n+ * $Revision: 1.11 $\n+ * $Date: 2003/06/26 02:18:46 $\n  *\n  * ====================================================================\n  * The Apache Software License, Version 1.1\n \n package org.apache.commons.jxpath.ri.model;\n \n+import java.util.Iterator;\n+\n import org.apache.commons.jxpath.AbstractFactory;\n import org.apache.commons.jxpath.IdentityManager;\n import org.apache.commons.jxpath.JXPathContext;\n  * DOM, JDOM etc.\n  *\n  * @author Dmitri Plotnikov\n- * @version $Revision: 1.10 $ $Date: 2003/03/11 00:59:38 $\n+ * @version $Revision: 1.11 $ $Date: 2003/06/26 02:18:46 $\n  */\n \n public abstract class XMLModelTestCase extends JXPathTestCase {\n             \"vendor/location\",\n             1);\n     }\n+    \n \n     public void testSetValue() {\n         assertXPathSetValue(\n             \"vendor//promotion[../@stores = 'all']\",\n             list(\"\"));\n     }\n+    \n+//    public void testAxisDescendantDocumentOrder() {\n+//        Iterator iter = context.iteratePointers(\"//*\");\n+//        while (iter.hasNext()) {\n+//            System.err.println(iter.next());\n+//        }\n+//    }\n \n     public void testAxisParent() {\n         // parent::", "timestamp": 1056593927, "metainfo": ""}