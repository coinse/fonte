{"sha": "a7eb98e24f8b9edd8b18aad012480ac8b8418673", "log": "Initial cut of ...jxpath.servlet   ", "commit": "\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/Constants.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.ServletContext;\n+import java.util.*;\n+\n+/**\n+ * String constants for this package.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public final class Constants {\n+\n+    /**\n+     * Variable name for ServletContext.\n+     */\n+    public static final String APPLICATION_SCOPE = \"application\";\n+\n+    /**\n+     * Variable name for HttpSession.\n+     */\n+    public static final String SESSION_SCOPE = \"session\";\n+\n+    /**\n+     * Variable name for ServletRequest.\n+     */\n+    public static final String REQUEST_SCOPE = \"request\";\n+\n+    /**\n+     * Variable name for PageContext.\n+     */\n+    public static final String PAGE_SCOPE = \"page\";\n+\n+    /**\n+     * Attribute name used in page context, requst, session, and servlet context to store\n+     * the corresponding JXPathContext.\n+     */\n+    public static final String JXPATH_CONTEXT = \"org.apache.commons.jxpath.JXPATH_CONTEXT\";\n+\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/HttpSessionHandler.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.http.HttpSession;\n+import java.util.*;\n+\n+/**\n+ * Implementation of the DynamicPropertyHandler interface that provides\n+ * access to attributes of a HttpSession.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class HttpSessionHandler implements DynamicPropertyHandler {\n+\n+    public String[] getPropertyNames(Object session){\n+        Enumeration e = ((HttpSession)session).getAttributeNames();\n+        return Util.toStrings(e);\n+    }\n+\n+    public Object getProperty(Object session, String property){\n+        return ((HttpSession)session).getAttribute(property);\n+    }\n+\n+    public void setProperty(Object session, String property, Object value){\n+        ((HttpSession)session).setAttribute(property, value);\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/JXPathServletContexts.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.ServletRequest;\n+import javax.servlet.ServletContext;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpSession;\n+import javax.servlet.jsp.PageContext;\n+\n+/**\n+ * Static methods that allocate and cache JXPathContexts bound to PageContext,\n+ * ServletRequest, HttpSession and ServletContext.\n+ * <p>\n+ * The JXPathContext returned by {@link #getPageContext getPageContext()}\n+ * provides access to all scopes via the PageContext.findAttribute()\n+ * method.  Thus, an expression like \"foo\" will first look for the attribute\n+ * named \"foo\" in the \"page\" context, then the \"request\" context, then\n+ * the \"session\" one and finally in the \"application\" context.\n+ * <p>\n+ * If you need to limit the attibute lookup to just one scope, you can use the\n+ * pre-definded variables \"page\", \"request\", \"session\" and \"application\".\n+ * For example, the expression \"$session/foo\" extracts the value of the\n+ * session attribute named \"foo\".\n+ * <p>\n+ * Following are some implementation details.\n+ * There is a separate JXPathContext for each of the four scopes. These contexts are chained\n+ * according to the nesting of the scopes.  So, the parent of the \"page\"\n+ * JXPathContext is a \"request\" JXPathContext, whose parent is a \"session\"\n+ * JXPathContext (that is if there is a session), whose parent is an \"application\"\n+ * context.\n+ * <p>\n+ * The XPath context node for each context is the corresponding object: PageContext,\n+ * ServletRequest, HttpSession or ServletContext.  This feature can be used by\n+ * servlets.  A servlet can use one of the methods declared by this class and\n+ * work with a specific JXPathContext for any scope.\n+ * <p>\n+ * Since JXPath chains lookups for variables and extension functions, variables\n+ * and extension function declared in the outer scopes are also available in\n+ * the inner scopes.\n+ * <p>\n+ * Each of the four context declares exactly one variable, the value of which is the corresponding\n+ * object: PageContext, etc.\n+ * <p>\n+ * The \"session\" variable will be undefined if there is no session for this servlet.\n+ * JXPath does not automatically create sessions.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public final class JXPathServletContexts {\n+\n+    private static JXPathContextFactory factory;\n+\n+    static {\n+        JXPathIntrospector.registerDynamicClass(PageScopeContext.class, PageScopeContextHandler.class);\n+        factory = JXPathContextFactory.newInstance();\n+    }\n+\n+    /**\n+     * Returns a JXPathContext bound to the \"page\" scope. Caches that context\n+     * within the PageContext itself.\n+     */\n+    public static JXPathContext getPageContext(PageContext pageContext){\n+        JXPathContext context = (JXPathContext)pageContext.getAttribute(Constants.JXPATH_CONTEXT);\n+        if (context == null){\n+            JXPathIntrospector.registerDynamicClass(pageContext.getClass(), PageContextHandler.class);\n+            JXPathContext parentContext = getRequestContext(\n+                    pageContext.getRequest(), pageContext.getServletContext());\n+            context = factory.newContext(parentContext, pageContext);\n+            context.setVariables(new KeywordVariables(Constants.PAGE_SCOPE, new PageScopeContext(pageContext)));\n+            pageContext.setAttribute(Constants.JXPATH_CONTEXT, context);\n+        }\n+        return context;\n+    }\n+\n+    /**\n+     * Returns a JXPathContext bound to the \"request\" scope. Caches that context\n+     * within the request itself.\n+     */\n+    public static JXPathContext getRequestContext(ServletRequest request, ServletContext servletContext){\n+        JXPathContext context = (JXPathContext)request.getAttribute(Constants.JXPATH_CONTEXT);\n+        if (context == null){\n+            JXPathContext parentContext = null;\n+            if (request instanceof HttpServletRequest){\n+                HttpSession session = ((HttpServletRequest)request).getSession(false);\n+                if (session != null){\n+                    parentContext = getSessionContext(session, servletContext);\n+                }\n+                else {\n+                    parentContext = getApplicationContext(servletContext);\n+                }\n+            }\n+            JXPathIntrospector.registerDynamicClass(request.getClass(), ServletRequestHandler.class);\n+            context = factory.newContext(parentContext, request);\n+            context.setVariables(new KeywordVariables(Constants.REQUEST_SCOPE, request));\n+            request.setAttribute(Constants.JXPATH_CONTEXT, context);\n+        }\n+        return context;\n+    }\n+\n+    /**\n+     * Returns a JXPathContext bound to the \"session\" scope. Caches that context\n+     * within the session itself.\n+     */\n+    public static JXPathContext getSessionContext(HttpSession session, ServletContext servletContext){\n+        JXPathContext context = (JXPathContext)session.getAttribute(Constants.JXPATH_CONTEXT);\n+        if (context == null){\n+            JXPathIntrospector.registerDynamicClass(session.getClass(), HttpSessionHandler.class);\n+            JXPathContext parentContext = getApplicationContext(servletContext);\n+            context = factory.newContext(parentContext, session);\n+            context.setVariables(new KeywordVariables(Constants.SESSION_SCOPE, session));\n+            session.setAttribute(Constants.JXPATH_CONTEXT, context);\n+        }\n+        return context;\n+    }\n+\n+    /**\n+     * Returns a JXPathContext bound to the \"application\" scope. Caches that context\n+     * within the servlet context itself.\n+     */\n+    public static JXPathContext getApplicationContext(ServletContext servletContext){\n+        JXPathContext context = (JXPathContext)servletContext.getAttribute(Constants.JXPATH_CONTEXT);\n+        if (context == null){\n+            JXPathIntrospector.registerDynamicClass(servletContext.getClass(), ServletContextHandler.class);\n+            context = factory.newContext(null, servletContext);\n+            context.setVariables(new KeywordVariables(Constants.APPLICATION_SCOPE, servletContext));\n+            servletContext.setAttribute(Constants.JXPATH_CONTEXT, context);\n+        }\n+        return context;\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/KeywordVariables.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.ServletContext;\n+import java.util.*;\n+\n+/**\n+ * Implementation of the Variables interface that provides access\n+ * to a single object using a reserved name (keyword).\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class KeywordVariables implements Variables {\n+\n+    private String keyword;\n+    private Object object;\n+\n+    public KeywordVariables(String keyword, Object object){\n+        this.keyword = keyword;\n+        this.object = object;\n+    }\n+\n+    public boolean isDeclaredVariable(String variable){\n+        return variable.equals(keyword);\n+    }\n+\n+    public Object getVariable(String variable){\n+        if (variable.equals(keyword)){\n+            return object;\n+        }\n+        return null;\n+    }\n+\n+    public void declareVariable(String variable, Object value){\n+        throw new UnsupportedOperationException(\"Cannot declare new keyword variables.\");\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/PageContextHandler.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.jsp.*;\n+import java.util.*;\n+\n+/**\n+ * Implementation of the DynamicPropertyHandler interface that provides\n+ * access to attributes of a PageContext in all scopes.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class PageContextHandler implements DynamicPropertyHandler {\n+\n+    public String[] getPropertyNames(Object pageContext){\n+        ArrayList list = new ArrayList();\n+        Enumeration e = ((PageContext)pageContext).getAttributeNamesInScope(PageContext.PAGE_SCOPE);\n+        while (e.hasMoreElements()){\n+            list.add(e.nextElement());\n+        }\n+        e = ((PageContext)pageContext).getAttributeNamesInScope(PageContext.REQUEST_SCOPE);\n+        while (e.hasMoreElements()){\n+            list.add(e.nextElement());\n+        }\n+        e = ((PageContext)pageContext).getAttributeNamesInScope(PageContext.SESSION_SCOPE);\n+        while (e.hasMoreElements()){\n+            list.add(e.nextElement());\n+        }\n+        e = ((PageContext)pageContext).getAttributeNamesInScope(PageContext.APPLICATION_SCOPE);\n+        while (e.hasMoreElements()){\n+            list.add(e.nextElement());\n+        }\n+        return (String[])list.toArray(new String[0]);\n+    }\n+\n+    /**\n+     * Returns <code>pageContext.findAttribute(property)</code>.\n+     */\n+    public Object getProperty(Object pageContext, String property){\n+        return ((PageContext)pageContext).findAttribute(property);\n+    }\n+\n+    public void setProperty(Object pageContext, String property, Object value){\n+        ((PageContext)pageContext).setAttribute(property, value, PageContext.PAGE_SCOPE);\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/PageScopeContext.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.jsp.*;\n+import java.util.*;\n+\n+/**\n+ * A lightweight wrapper for PageContext that restricts access\n+ * to attributes of the \"page\" scope.  This object is needed so that\n+ * XPath \"foo\" would lookup the attribute \"foo\" in all scopes, while\n+ * \"$page/foo\" would only look in the \"page\" scope.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class PageScopeContext {\n+    private PageContext pageContext;\n+\n+    public PageScopeContext(PageContext pageContext){\n+        this.pageContext = pageContext;\n+    }\n+\n+    /**\n+     * Returns attributes of the pageContext declared in the \"page\" scope.\n+     */\n+    public Enumeration getAttributeNames(){\n+        return pageContext.getAttributeNamesInScope(PageContext.PAGE_SCOPE);\n+    }\n+\n+    public Object getAttribute(String attribute){\n+        return pageContext.getAttribute(attribute, PageContext.PAGE_SCOPE);\n+    }\n+\n+    public void setAttribute(String attribute, Object value){\n+        pageContext.setAttribute(attribute, value, PageContext.PAGE_SCOPE);\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/PageScopeContextHandler.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.jsp.*;\n+import java.util.*;\n+\n+/**\n+ * Implementation of the DynamicPropertyHandler interface that provides\n+ * access to attributes of a PageScopeContext.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class PageScopeContextHandler implements DynamicPropertyHandler {\n+\n+    public String[] getPropertyNames(Object pageScope){\n+        Enumeration e = ((PageScopeContext)pageScope).getAttributeNames();\n+        return Util.toStrings(e);\n+    }\n+\n+    public Object getProperty(Object pageScope, String property){\n+        return ((PageScopeContext)pageScope).getAttribute(property);\n+    }\n+\n+    public void setProperty(Object pageScope, String property, Object value){\n+        ((PageScopeContext)pageScope).setAttribute(property, value);\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/ServletContextHandler.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.ServletContext;\n+import java.util.*;\n+\n+/**\n+ * Implementation of the DynamicPropertyHandler interface that provides\n+ * access to attributes of a ServletContext.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class ServletContextHandler implements DynamicPropertyHandler {\n+\n+    public String[] getPropertyNames(Object context){\n+        Enumeration e = ((ServletContext)context).getAttributeNames();\n+        return Util.toStrings(e);\n+    }\n+\n+    public Object getProperty(Object context, String property){\n+        return ((ServletContext)context).getAttribute(property);\n+    }\n+\n+    public void setProperty(Object context, String property, Object value){\n+        ((ServletContext)context).setAttribute(property, value);\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/ServletRequestHandler.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import org.apache.commons.jxpath.*;\n+import javax.servlet.ServletRequest;\n+import java.util.*;\n+\n+/**\n+ * Implementation of the DynamicPropertyHandler interface that provides\n+ * access to attributes of a ServletRequest.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public class ServletRequestHandler implements DynamicPropertyHandler {\n+\n+    public String[] getPropertyNames(Object request){\n+        Enumeration e = ((ServletRequest)request).getAttributeNames();\n+        return Util.toStrings(e);\n+    }\n+\n+    public Object getProperty(Object request, String property){\n+        return ((ServletRequest)request).getAttribute(property);\n+    }\n+\n+    public void setProperty(Object request, String property, Object value){\n+        ((ServletRequest)request).setAttribute(property, value);\n+    }\n+}\n--- /dev/null\n+++ b/src/java/org/apache/commons/jxpath/servlet/Util.java\n+/*\n+ * The Apache Software License, Version 1.1\n+ *\n+ * Copyright (c) 1999 The Apache Software Foundation.  All rights\n+ * reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions\n+ * are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright\n+ *    notice, this list of conditions and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright\n+ *    notice, this list of conditions and the following disclaimer in\n+ *    the documentation and/or other materials provided with the\n+ *    distribution.\n+ *\n+ * 3. The end-user documentation included with the redistribution, if\n+ *    any, must include the following acknowlegement:\n+ *       \"This product includes software developed by the\n+ *        Apache Software Foundation (http://www.apache.org/).\"\n+ *    Alternately, this acknowlegement may appear in the software itself,\n+ *    if and wherever such third-party acknowlegements normally appear.\n+ *\n+ * 4. The names \"The Jakarta Project\", \"Tomcat\", and \"Apache Software\n+ *    Foundation\" must not be used to endorse or promote products derived\n+ *    from this software without prior written permission. For written\n+ *    permission, please contact apache@apache.org.\n+ *\n+ * 5. Products derived from this software may not be called \"Apache\"\n+ *    nor may \"Apache\" appear in their names without prior written\n+ *    permission of the Apache Group.\n+ *\n+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED\n+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR\n+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF\n+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n+ * SUCH DAMAGE.\n+ * ====================================================================\n+ *\n+ * This software consists of voluntary contributions made by many\n+ * individuals on behalf of the Apache Software Foundation.  For more\n+ * information on the Apache Software Foundation, please see\n+ * <http://www.apache.org/>.\n+ *\n+ */\n+\n+package org.apache.commons.jxpath.servlet;\n+\n+import java.util.*;\n+\n+/**\n+ * Turns an Enumeration of Strings into an array of Strings.\n+ *\n+ * @author Dmitri Plotnikov\n+ * @version $Revision: 1.1 $ $Date: 2001/09/08 21:01:00 $\n+ */\n+public final class Util {\n+\n+    private static final String[] STRING_ARRAY = new String[0];\n+\n+    public static String[] toStrings(Enumeration e){\n+        ArrayList list = new ArrayList(16);\n+        while (e.hasMoreElements()){\n+            list.add(e.nextElement());\n+        }\n+        return (String[])list.toArray(STRING_ARRAY);\n+    }\n+}", "timestamp": 999982860, "metainfo": ""}