{"sha": "b75a08c7fb0d7088cd263606b2322cdb41740833", "log": "GroupImpl now respects the required attribute of the child options (bug identified by Andrew Ferguson) Switch only adds the option to the commandline once.   ", "commit": "\n--- a/src/java/org/apache/commons/cli2/option/GroupImpl.java\n+++ b/src/java/org/apache/commons/cli2/option/GroupImpl.java\n         \n         for (final Iterator i = options.iterator(); i.hasNext();) {\n             final Option option = (Option) i.next();\n+            // if the child option is required then validate it\n+            if(option.isRequired()){\n+                option.validate(commandLine);\n+            }\n+            // if the child option is present then validate it\n             if (commandLine.hasOption(option)) {\n                 if (++present > maximum) {\n                     unexpected = option;\n--- a/src/java/org/apache/commons/cli2/option/Switch.java\n+++ b/src/java/org/apache/commons/cli2/option/Switch.java\n         final String arg = (String)arguments.next();\n \n         if (canProcess(arg)) {\n-            commandLine.addOption(this);\n             if (arg.startsWith(enabledPrefix)) {\n                 commandLine.addSwitch(this, true);\n                 arguments.set(enabledPrefix + preferredName);\n--- a/src/test/org/apache/commons/cli2/CommandLineTestCase.java\n+++ b/src/test/org/apache/commons/cli2/CommandLineTestCase.java\n                     \"--help\",\n                     \"login\",\n                     \"rob\",\n+                    \"+display\",\n                     \"--help\",\n                     \"--help\",\n                     \"target1\",\n         assertEquals(1, cl.getOptionCount(login));\n         assertEquals(3, cl.getOptionCount(help));\n         assertEquals(2, cl.getOptionCount(targets));\n-        assertEquals(0, cl.getOptionCount(display));\n+        assertEquals(1, cl.getOptionCount(display));\n     }\n \n     public final void testGetOptionCount_Strings() throws OptionException {\n                     \"--help\",\n                     \"login\",\n                     \"rob\",\n+                    \"+display\",\n                     \"--help\",\n                     \"--help\",\n                     \"target1\",\n \n         assertEquals(1, cl.getOptionCount(\"login\"));\n         assertEquals(3, cl.getOptionCount(\"-?\"));\n-        assertEquals(0, cl.getOptionCount(\"+display\"));\n+        assertEquals(1, cl.getOptionCount(\"+display\"));\n     }\n }\n--- a/src/test/org/apache/commons/cli2/option/GroupTest.java\n+++ b/src/test/org/apache/commons/cli2/option/GroupTest.java\n import org.apache.commons.cli2.Option;\n import org.apache.commons.cli2.OptionException;\n import org.apache.commons.cli2.WriteableCommandLine;\n+import org.apache.commons.cli2.builder.DefaultOptionBuilder;\n+import org.apache.commons.cli2.builder.GroupBuilder;\n \n /**\n  * @author Rob Oxspring\n             assertEquals(option, moe.getOption());\n         }\n     }\n+    \n+    public void testValidate_RequiredChild() throws OptionException {\n+        final Option required = new DefaultOptionBuilder().withLongName(\"required\").withRequired(true).create();\n+        final Option optional = new DefaultOptionBuilder().withLongName(\"optional\").withRequired(false).create();\n+        final Group group = new GroupBuilder()\n+            .withOption(required)\n+            .withOption(optional)\n+            .withMinimum(1)\n+            .create();\n+\n+        WriteableCommandLine commandLine;\n+        \n+        commandLine = commandLine(group, list());\n+        try {\n+            group.validate(commandLine);\n+            fail(\"Missing option 'required'\");\n+        }\n+        catch (OptionException moe) {\n+            assertEquals(required, moe.getOption());\n+        }\n+        \n+        commandLine = commandLine(group, list());\n+        commandLine.addOption(optional);\n+        try {\n+            group.validate(commandLine);\n+            fail(\"Missing option 'required'\");\n+        }\n+        catch (OptionException moe) {\n+            assertEquals(required, moe.getOption());\n+        }\n+        \n+        commandLine = commandLine(group, list());\n+        commandLine.addOption(required);\n+        group.validate(commandLine);\n+        \n+    }\n \n     /*\n      * (non-Javadoc)", "timestamp": 1096722981, "metainfo": ""}