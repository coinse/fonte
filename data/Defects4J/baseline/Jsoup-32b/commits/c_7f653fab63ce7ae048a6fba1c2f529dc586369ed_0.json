{"sha": "7f653fab63ce7ae048a6fba1c2f529dc586369ed", "log": "Handle empty (self closing) blocks.  <div/><div></div> was parsing as <div><div></div></div>. No longer.", "commit": "\n--- a/src/main/java/org/jsoup/parser/Parser.java\n+++ b/src/main/java/org/jsoup/parser/Parser.java\n         StartTag startTag = new StartTag(tag, baseUri, attributes);\n         Element child = new Element(startTag);\n \n-        if (!tq.matchChomp(\"/>\")) { // close empty element or tag\n+        boolean isEmptyElement = tag.isEmpty(); // empty element if empty tag (e.g. img) or self-closed el (<div/>\n+        if (tq.matchChomp(\"/>\")) { // close empty element or tag\n+            isEmptyElement = true;\n+        } else {\n             tq.matchChomp(\">\");\n         }\n \n             baseUri = child.absUrl(\"href\");\n         }\n \n-        addChildToParent(child);\n+        addChildToParent(child, isEmptyElement);\n     }\n \n     private Attribute parseAttribute() {\n         last().addChild(textNode);\n     }\n \n-    private Element addChildToParent(Element child) {\n+    private Element addChildToParent(Element child, boolean isEmptyElement) {\n         Element parent = popStackToSuitableContainer(child.getTag());\n         Tag childTag = child.getTag();\n         boolean validAncestor = stackHasValidParent(childTag);\n             implicit.addChild(child);\n \n             // recurse to ensure somewhere to put parent\n-            Element root = addChildToParent(implicit);\n-            stack.addLast(child);\n+            Element root = addChildToParent(implicit, false);\n+            if (!isEmptyElement)\n+                stack.addLast(child);\n             return root;\n         }\n \n         parent.addChild(child);\n \n-        if (!childTag.isEmpty())\n+        if (!isEmptyElement)\n             stack.addLast(child);\n         return parent;\n     }\n--- a/src/test/java/org/jsoup/parser/ParserTest.java\n+++ b/src/test/java/org/jsoup/parser/ParserTest.java\n         assertEquals(\"qux\", foos.last().attr(\"title\"));\n         assertEquals(\"there\", foos.last().text());\n     }\n+    \n+    @Test public void handlesEmptyBlocks() {\n+        String h = \"<div id=1/><div id=2><img /></div>\";\n+        Document doc = Jsoup.parse(h);\n+        Element div1 = doc.getElementById(\"1\");\n+        assertTrue(div1.children().isEmpty());\n+    }\n \n \n }", "timestamp": 1309605103, "metainfo": ""}