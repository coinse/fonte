{"sha": "73d32c1fd118f14d5d76423a8df9f8e076688f27", "log": "Fixed a bad interaction between step handlers and event handlers in ODE integrators.  The problem was due to an internal array from the step interpolator that was changed by the step handlers. These array was expected to contain the state at event time, but was overridden later on. the solution is simply to clone the array. Note that the fact the array is reused *is* documented in the javadoc and is a feature of the interpolators ...  JIRA: MATH-706  ", "commit": "\n--- a/src/main/java/org/apache/commons/math/ode/AbstractIntegrator.java\n+++ b/src/main/java/org/apache/commons/math/ode/AbstractIntegrator.java\n \n                 // trigger the event\n                 interpolator.setInterpolatedTime(eventT);\n-                final double[] eventY = interpolator.getInterpolatedState();\n+                final double[] eventY = interpolator.getInterpolatedState().clone();\n                 currentEvent.stepAccepted(eventT, eventY);\n                 isLastStep = currentEvent.stop();\n ", "timestamp": 1321054774, "metainfo": ""}