{"sha": "4f1e69b5313761cb95909359a408d13e6aa29635", "log": "Eliminated redundant endpoint function evaluations in BrentSolver, SecantSolver. BZ #35042.  ", "commit": "\n--- a/src/java/org/apache/commons/math/analysis/BrentSolver.java\n+++ b/src/java/org/apache/commons/math/analysis/BrentSolver.java\n /*\n- * Copyright 2003-2004 The Apache Software Foundation.\n+ * Copyright 2003-2005 The Apache Software Foundation.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n         FunctionEvaluationException {\n         \n         clearResult();\n-        verifyBracketing(min, max, f);\n+        verifyInterval(min, max);\n         \n         // Index 0 is the old approximation for the root.\n         // Index 1 is the last calculated approximation  for the root.\n         double y1;\n         y0 = f.value(x0);\n         y1 = f.value(x1);\n+        \n+        // Verify bracketing\n+        if (y0 * y1 >= 0) {\n+            throw new IllegalArgumentException\n+            (\"Function values at endpoints do not have different signs.\" +\n+                    \"  Endpoints: [\" + min + \",\" + max + \"]\" + \n+                    \"  Values: [\" + y0 + \",\" + y1 + \"]\");       \n+        }\n    \n         double x2 = x0;\n         double y2 = y0;\n--- a/src/java/org/apache/commons/math/analysis/SecantSolver.java\n+++ b/src/java/org/apache/commons/math/analysis/SecantSolver.java\n         FunctionEvaluationException {\n         \n         clearResult();\n-        verifyBracketing(min, max, f);\n+        verifyInterval(min, max);\n         \n         // Index 0 is the old approximation for the root.\n         // Index 1 is the last calculated approximation  for the root.\n         double x1 = max;\n         double y0 = f.value(x0);\n         double y1 = f.value(x1);\n+        \n+        // Verify bracketing\n+        if (y0 * y1 >= 0) {\n+            throw new IllegalArgumentException\n+            (\"Function values at endpoints do not have different signs.\" +\n+                    \"  Endpoints: [\" + min + \",\" + max + \"]\" + \n+                    \"  Values: [\" + y0 + \",\" + y1 + \"]\");       \n+        }\n+        \n         double x2 = x0;\n         double y2 = y0;\n         double oldDelta = x2 - x1;\n--- a/src/test/org/apache/commons/math/analysis/BrentSolverTest.java\n+++ b/src/test/org/apache/commons/math/analysis/BrentSolverTest.java\n         result = UnivariateRealSolverUtils.solve(f, 0.85, 5);\n         assertEquals(result, 1.0, 1E-6);\n     }\n+    \n+    public void testBadEndpoints() throws Exception {\n+        UnivariateRealFunction f = new SinFunction();\n+        UnivariateRealSolver solver = new BrentSolver(f);\n+        try {  // bad interval\n+            solver.solve(1, -1);\n+            fail(\"Expecting IllegalArgumentException - bad interval\");\n+        } catch (IllegalArgumentException ex) {\n+            // expected\n+        }\n+        try {  // no bracket\n+            solver.solve(1, 1.5);\n+            fail(\"Expecting IllegalArgumentException - non-bracketing\");\n+        } catch (IllegalArgumentException ex) {\n+            // expected\n+        }\n+    }\n }", "timestamp": 1117863402, "metainfo": ""}