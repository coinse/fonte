{"sha": "c00ac8120a4215125e49775cd9351e689586b467", "log": "Fixed conversion problems to/from 0 in Decimal Floating Point (Dfp) class.  JIRA: MATH-567  ", "commit": "\n--- a/src/main/java/org/apache/commons/math/dfp/Dfp.java\n+++ b/src/main/java/org/apache/commons/math/dfp/Dfp.java\n     /** Mantissa. */\n     protected int[] mant;\n \n-    /** Sign bit: & for positive, -1 for negative. */\n+    /** Sign bit: 1 for positive, -1 for negative. */\n     protected byte sign;\n \n     /** Exponent. */\n         if (exponent == -1023) {\n             // Zero or sub-normal\n             if (x == 0) {\n+                // make sure 0 has the right sign\n+                if ((bits & 0x8000000000000000L) != 0) {\n+                    sign = -1;\n+                }\n                 return;\n             }\n \n \n         Dfp y = this;\n         boolean negate = false;\n-        if (lessThan(getZero())) {\n+        int cmp0 = compare(this, getZero());\n+        if (cmp0 == 0) {\n+            return sign < 0 ? -0.0 : +0.0;\n+        } else if (cmp0 < 0) {\n             y = negate();\n             negate = true;\n         }\n--- a/src/test/java/org/apache/commons/math/dfp/DfpTest.java\n+++ b/src/test/java/org/apache/commons/math/dfp/DfpTest.java\n \n package org.apache.commons.math.dfp;\n \n+import org.apache.commons.math.util.FastMath;\n+import org.apache.commons.math.util.MathUtils;\n import org.junit.After;\n import org.junit.Assert;\n import org.junit.Before;\n              DfpField.FLAG_INVALID, \"Sqrt #9\");\n     }\n \n+    @Test\n+    public void testIssue567() {\n+        DfpField field = new DfpField(100);\n+        Assert.assertEquals(0.0, field.getZero().toDouble(), MathUtils.SAFE_MIN);\n+        Assert.assertEquals(0.0, field.newDfp(0.0).toDouble(), MathUtils.SAFE_MIN);\n+        Assert.assertEquals(-1, FastMath.copySign(1, field.newDfp(-0.0).toDouble()), MathUtils.EPSILON);\n+        Assert.assertEquals(+1, FastMath.copySign(1, field.newDfp(+0.0).toDouble()), MathUtils.EPSILON);\n+    }\n+\n }", "timestamp": 1304624488, "metainfo": ""}