{"sha": "6eec202b7d66dbeb4e2c2b4fa4214b359134ea2f", "log": "handle NaN and infinities correctly in the MathUtils.equals method with tolerance  ", "commit": "\n--- a/src/java/org/apache/commons/math/util/MathUtils.java\n+++ b/src/java/org/apache/commons/math/util/MathUtils.java\n     /**\n      * Returns true iff both arguments are equal or within the range of allowed\n      * error (inclusive).\n+     * <p>\n+     * Two NaNs are considered equals, as are two infinities with same size.\n+     * </p>\n      * \n      * @param x first value\n      * @param y second value\n      * @return true if the values are equal or within range of each other\n      */\n     public static boolean equals(double x, double y, double eps) {\n-      return x == y || (x < y && (x + eps) >= y) || (x > y && x <= (y + eps));\n+      return equals(x, y) || (Math.abs(y - x) <= eps);\n     }\n     \n     /**\n--- a/src/test/org/apache/commons/math/util/MathUtilsTest.java\n+++ b/src/test/org/apache/commons/math/util/MathUtilsTest.java\n     }\n \n     public void testEqualsWithAllowedDelta() {\n-        assertTrue(MathUtils.equals(153.0000, 153.0000, .0001));\n-        assertTrue(MathUtils.equals(153.0000, 153.0001, .0001));\n-        assertTrue(MathUtils.equals(152.9999, 153.0000, .0001));\n-        assertFalse(MathUtils.equals(153.0000, 153.0001, .00001));\n-        assertFalse(MathUtils.equals(152.9998, 153.0000, .0001));\n+        assertTrue(MathUtils.equals(153.0000, 153.0000, .0625));\n+        assertTrue(MathUtils.equals(153.0000, 153.0625, .0625));\n+        assertTrue(MathUtils.equals(152.9375, 153.0000, .0625));\n+        assertTrue(MathUtils.equals(Double.NaN, Double.NaN, 1.0));\n+        assertTrue(MathUtils.equals(Double.POSITIVE_INFINITY, Double.POSITIVE_INFINITY, 1.0));\n+        assertTrue(MathUtils.equals(Double.NEGATIVE_INFINITY, Double.NEGATIVE_INFINITY, 1.0));\n+        assertFalse(MathUtils.equals(Double.NEGATIVE_INFINITY, Double.POSITIVE_INFINITY, 1.0));\n+        assertFalse(MathUtils.equals(153.0000, 153.0625, .0624));\n+        assertFalse(MathUtils.equals(152.9374, 153.0000, .0625));\n     }\n     \n     public void testArrayEquals() {", "timestamp": 1235247396, "metainfo": ""}