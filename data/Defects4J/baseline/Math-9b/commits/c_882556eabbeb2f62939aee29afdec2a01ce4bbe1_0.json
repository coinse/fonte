{"sha": "882556eabbeb2f62939aee29afdec2a01ce4bbe1", "log": "Fixed array indexing error in Variance evaluate method for computing the weighted variance of an array segment.  JIRA: MATH-704 Reported by Leonid Ilyevsky Patched by Thomas Niedhart    ", "commit": "\n--- a/src/main/java/org/apache/commons/math/stat/descriptive/moment/Variance.java\n+++ b/src/main/java/org/apache/commons/math/stat/descriptive/moment/Variance.java\n                 }\n \n                 double sumWts = 0;\n-                for (int i = 0; i < weights.length; i++) {\n+                for (int i = begin; i < begin + length; i++) {\n                     sumWts += weights[i];\n                 }\n \n--- a/src/test/java/org/apache/commons/math/stat/descriptive/UnivariateStatisticAbstractTest.java\n+++ b/src/test/java/org/apache/commons/math/stat/descriptive/UnivariateStatisticAbstractTest.java\n         System.arraycopy(testArray, testArray.length - 5, arrayEnd, 0, 5);\n         Assert.assertEquals(stat.evaluate(arrayEnd), stat.evaluate(testArray, testArray.length - 5, 5), 0);\n     }\n+    \n+    @Test\n+    public void testEvaluateArraySegmentWeighted() {\n+        // See if this statistic computes weighted statistics\n+        // If not, skip this test\n+        UnivariateStatistic statistic = getUnivariateStatistic();\n+        if (!(statistic instanceof WeightedEvaluation)) {\n+            return;\n+        }\n+        final WeightedEvaluation stat = (WeightedEvaluation) getUnivariateStatistic();\n+        final double[] arrayZero = new double[5];\n+        final double[] weightZero = new double[5];\n+        System.arraycopy(testArray, 0, arrayZero, 0, 5);\n+        System.arraycopy(testWeightsArray, 0, weightZero, 0, 5);\n+        Assert.assertEquals(stat.evaluate(arrayZero, weightZero),\n+                stat.evaluate(testArray, testWeightsArray, 0, 5), 0);\n+        final double[] arrayOne = new double[5];\n+        final double[] weightOne = new double[5];\n+        System.arraycopy(testArray, 5, arrayOne, 0, 5);\n+        System.arraycopy(testWeightsArray, 5, weightOne, 0, 5);\n+        Assert.assertEquals(stat.evaluate(arrayOne, weightOne),\n+                stat.evaluate(testArray, testWeightsArray, 5, 5), 0);\n+        final double[] arrayEnd = new double[5];\n+        final double[] weightEnd = new double[5];\n+        System.arraycopy(testArray, testArray.length - 5, arrayEnd, 0, 5);\n+        System.arraycopy(testWeightsArray, testArray.length - 5, weightEnd, 0, 5);\n+        Assert.assertEquals(stat.evaluate(arrayEnd, weightEnd),\n+                stat.evaluate(testArray, testWeightsArray, testArray.length - 5, 5), 0);\n+    }\n \n     @Test\n     public void testCopy() throws Exception {", "timestamp": 1322634244, "metainfo": ""}