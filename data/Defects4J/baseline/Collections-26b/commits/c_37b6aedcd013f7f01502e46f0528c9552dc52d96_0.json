{"sha": "37b6aedcd013f7f01502e46f0528c9552dc52d96", "log": "Fix so putAll works with an empty map bug 34686, reported by Marc Lottman  ", "commit": "\n--- a/src/java/org/apache/commons/collections/map/TransformedMap.java\n+++ b/src/java/org/apache/commons/collections/map/TransformedMap.java\n      * @throws the transformed object\n      */\n     protected Map transformMap(Map map) {\n+        if (map.isEmpty()) {\n+            return map;\n+        }\n         Map result = new LinkedMap(map.size());\n         for (Iterator it = map.entrySet().iterator(); it.hasNext(); ) {\n             Map.Entry entry = (Map.Entry) it.next();\n--- a/src/test/org/apache/commons/collections/map/AbstractTestMap.java\n+++ b/src/test/org/apache/commons/collections/map/AbstractTestMap.java\n             return;\n         }\n \n+        // check putAll OK adding empty map to empty map\n         resetEmpty();\n-\n+        assertEquals(0, map.size());\n+        map.putAll(new HashMap());\n+        assertEquals(0, map.size());\n+\n+        // check putAll OK adding empty map to non-empty map\n+        resetFull();\n+        int size = map.size();\n+        map.putAll(new HashMap());\n+        assertEquals(size, map.size());\n+\n+        // check putAll OK adding non-empty map to empty map\n+        resetEmpty();\n         Map m2 = makeFullMap();\n-\n         map.putAll(m2);\n         confirmed.putAll(m2);\n         verify();\n \n+        // check putAll OK adding non-empty JDK map to empty map\n         resetEmpty();\n-\n         m2 = makeConfirmedMap();\n         Object[] keys = getSampleKeys();\n         Object[] values = getSampleValues();\n         for(int i = 0; i < keys.length; i++) {\n             m2.put(keys[i], values[i]);\n         }\n-\n+        map.putAll(m2);\n+        confirmed.putAll(m2);\n+        verify();\n+\n+        // check putAll OK adding non-empty JDK map to non-empty map\n+        resetEmpty();\n+        m2 = makeConfirmedMap();\n+        map.put(keys[0], values[0]);\n+        confirmed.put(keys[0], values[0]);\n+        verify();\n+        for(int i = 1; i < keys.length; i++) {\n+            m2.put(keys[i], values[i]);\n+        }\n         map.putAll(m2);\n         confirmed.putAll(m2);\n         verify();", "timestamp": 1115486020, "metainfo": ""}