{"sha": "bef34f2326b7ae0a80c0039b7d3211993b877d32", "log": "Make LazyMap/LazySortedMap Serializable [18815]   ", "commit": "\n--- a/src/java/org/apache/commons/collections/map/LazyMap.java\n+++ b/src/java/org/apache/commons/collections/map/LazyMap.java\n  */\n package org.apache.commons.collections.map;\n \n+import java.io.IOException;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n+import java.io.Serializable;\n import java.util.Map;\n \n import org.apache.commons.collections.Factory;\n  * instance is mapped to the \"NOW\" key in the map.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.4 $ $Date: 2004/02/18 01:13:19 $\n+ * @version $Revision: 1.5 $ $Date: 2004/04/07 23:05:37 $\n  * \n  * @author Stephen Colebourne\n  * @author Paul Jack\n  */\n public class LazyMap\n-        extends AbstractMapDecorator implements Map {\n+        extends AbstractMapDecorator\n+        implements Map, Serializable {\n+\n+    /** Serialization version */\n+    private static final long serialVersionUID = 7990956402564206740L;\n \n     /** The factory to use to construct elements */\n     protected final Transformer factory;\n     }\n \n     //-----------------------------------------------------------------------\n+    /**\n+     * Write the map out using a custom routine.\n+     */\n+    private void writeObject(ObjectOutputStream out) throws IOException {\n+        out.defaultWriteObject();\n+        out.writeObject(map);\n+    }\n+\n+    /**\n+     * Read the map in using a custom routine.\n+     */\n+    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n+        in.defaultReadObject();\n+        map = (Map) in.readObject();\n+    }\n+\n+    //-----------------------------------------------------------------------\n     public Object get(Object key) {\n         // create value for key if key is not currently in the map\n         if (map.containsKey(key) == false) {\n--- a/src/java/org/apache/commons/collections/map/LazySortedMap.java\n+++ b/src/java/org/apache/commons/collections/map/LazySortedMap.java\n  */\n package org.apache.commons.collections.map;\n \n+import java.io.IOException;\n+import java.io.ObjectInputStream;\n+import java.io.ObjectOutputStream;\n+import java.io.Serializable;\n import java.util.Comparator;\n+import java.util.Map;\n import java.util.SortedMap;\n \n import org.apache.commons.collections.Factory;\n  * instance is mapped to the \"NOW\" key in the map.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.4 $ $Date: 2004/02/18 01:13:19 $\n+ * @version $Revision: 1.5 $ $Date: 2004/04/07 23:05:37 $\n  * \n  * @author Stephen Colebourne\n  * @author Paul Jack\n  */\n public class LazySortedMap\n-        extends LazyMap implements SortedMap {\n+        extends LazyMap\n+        implements SortedMap, Serializable {\n+\n+    /** Serialization version */\n+    private static final long serialVersionUID = 2715322183617658933L;\n \n     /**\n      * Factory method to create a lazily instantiated sorted map.\n         super(map, factory);\n     }\n \n+    //-----------------------------------------------------------------------\n+    /**\n+     * Write the map out using a custom routine.\n+     */\n+    private void writeObject(ObjectOutputStream out) throws IOException {\n+        out.defaultWriteObject();\n+        out.writeObject(map);\n+    }\n+\n+    /**\n+     * Read the map in using a custom routine.\n+     */\n+    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {\n+        in.defaultReadObject();\n+        map = (Map) in.readObject();\n+    }\n+\n     /**\n      * Gets the map being decorated.\n      * \n--- a/src/test/org/apache/commons/collections/map/TestLazyMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestLazyMap.java\n  * {@link LazyMap} implementation.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.5 $ $Date: 2004/02/18 01:20:38 $\n+ * @version $Revision: 1.6 $ $Date: 2004/04/07 23:05:37 $\n  * \n  * @author Phil Steitz\n  */\n         assertEquals(null,o);\n         assertEquals(1, map.size());\n         \n-    }       \n+    }\n+    \n+    public String getCompatibilityVersion() {\n+        return \"3.1\";\n+    }\n+\n+//    public void testCreate() throws Exception {\n+//        resetEmpty();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/LazyMap.emptyCollection.version3.1.obj\");\n+//        resetFull();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/LazyMap.fullCollection.version3.1.obj\");\n+//    }\n }\n--- a/src/test/org/apache/commons/collections/map/TestLazySortedMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestLazySortedMap.java\n  * {@link LazySortedMap} implementation.\n  *\n  * @since Commons Collections 3.0\n- * @version $Revision: 1.4 $ $Date: 2004/02/18 01:20:38 $\n+ * @version $Revision: 1.5 $ $Date: 2004/04/07 23:05:37 $\n  * \n  * @author Phil Steitz\n  */\n             // expected\n         } \n     }\n+    \n+    public String getCompatibilityVersion() {\n+        return \"3.1\";\n+    }\n+\n+//    public void testCreate() throws Exception {\n+//        resetEmpty();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/LazySortedMap.emptyCollection.version3.1.obj\");\n+//        resetFull();\n+//        writeExternalFormToDisk(\n+//            (java.io.Serializable) map,\n+//            \"D:/dev/collections/data/test/LazySortedMap.fullCollection.version3.1.obj\");\n+//    }\n }", "timestamp": 1081379137, "metainfo": ""}