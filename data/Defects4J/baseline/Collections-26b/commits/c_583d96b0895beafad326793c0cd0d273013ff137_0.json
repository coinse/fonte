{"sha": "583d96b0895beafad326793c0cd0d273013ff137", "log": "[COLLECTIONS-555] Added clarification to TreeBag#add(Object) wrt null arguments. Thanks to M Kim.  ", "commit": "\n--- a/src/main/java/org/apache/commons/collections4/bag/TreeBag.java\n+++ b/src/main/java/org/apache/commons/collections4/bag/TreeBag.java\n      *\n      * @throws IllegalArgumentException if the object to be added does not implement\n      * {@link Comparable} and the {@link TreeBag} is using natural ordering\n+     * @throws NullPointerException if the specified key is null and this bag uses\n+     * natural ordering, or its comparator does not permit null keys\n      */\n     @Override\n     public boolean add(final E object) {\n         if(comparator() == null && !(object instanceof Comparable)) {\n+            if (object == null) {\n+                throw new NullPointerException();\n+            }\n             throw new IllegalArgumentException(\"Objects of type \" + object.getClass() + \" cannot be added to \" +\n                                                \"a naturally ordered TreeBag as it does not implement Comparable\");\n         }\n--- a/src/test/java/org/apache/commons/collections4/bag/TreeBagTest.java\n+++ b/src/test/java/org/apache/commons/collections4/bag/TreeBagTest.java\n  * limitations under the License.\n  */\n package org.apache.commons.collections4.bag;\n+\n+import java.util.Comparator;\n \n import junit.framework.Test;\n \n         }\n     }\n \n+    public void testCollections555() {\n+        final Bag<Object> bag = new TreeBag<Object>();\n+        try {\n+            bag.add(null);\n+            fail(\"NullPointerException expected\");\n+        } catch(final NullPointerException npe) {\n+            // expected;\n+        }\n+        \n+        final Bag<String> bag2 = new TreeBag<String>(new Comparator<String>() {\n+            @Override\n+            public int compare(String o1, String o2) {\n+                return o1.compareTo(o2);\n+            }\n+        });\n+        try {\n+            // jdk bug: adding null to an empty TreeMap works\n+            // thus ensure that the bag is not empty before adding null\n+            bag2.add(\"a\");\n+            bag2.add(null);\n+            fail(\"NullPointerException expected\");\n+        } catch(final NullPointerException npe) {\n+            // expected;\n+        }\n+    }\n+\n     public void testOrdering() {\n         final Bag<T> bag = setupBag();\n         assertEquals(\"Should get elements in correct order\", \"A\", bag.toArray()[0]);", "timestamp": 1424210579, "metainfo": ""}