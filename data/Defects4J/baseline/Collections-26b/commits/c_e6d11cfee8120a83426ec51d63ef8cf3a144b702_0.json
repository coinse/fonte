{"sha": "e6d11cfee8120a83426ec51d63ef8cf3a144b702", "log": "Ensure that the keySet and values views handle removed elements bug 25551, from Joe Raysa   ", "commit": "\n--- a/src/java/org/apache/commons/collections/ReferenceMap.java\n+++ b/src/java/org/apache/commons/collections/ReferenceMap.java\n /*\n- * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//collections/src/java/org/apache/commons/collections/ReferenceMap.java,v 1.19 2003/12/06 13:03:15 scolebourne Exp $\n+ * $Header: /home/jerenkrantz/tmp/commons/commons-convert/cvs/home/cvs/jakarta-commons//collections/src/java/org/apache/commons/collections/ReferenceMap.java,v 1.20 2003/12/29 15:35:54 scolebourne Exp $\n  * ====================================================================\n  *\n  * The Apache Software License, Version 1.1\n  * \n  * @deprecated Moved to map subpackage. Due to be removed in v4.0.\n  * @since Commons Collections 2.1\n- * @version $Revision: 1.19 $ $Date: 2003/12/06 13:03:15 $\n+ * @version $Revision: 1.20 $ $Date: 2003/12/29 15:35:54 $\n  * \n  * @author Paul Jack\n  */\n         if (keySet != null) return keySet;\n         keySet = new AbstractSet() {\n             public int size() {\n-                return size;\n+                return ReferenceMap.this.size();\n             }\n \n             public Iterator iterator() {\n                 ReferenceMap.this.clear();\n             }\n \n+            public Object[] toArray() {\n+                return toArray(new Object[0]);\n+            }\n+\n+            public Object[] toArray(Object[] array) {\n+                Collection c = new ArrayList(size());\n+                for (Iterator it = iterator(); it.hasNext(); ) {\n+                    c.add(it.next());\n+                }\n+                return c.toArray(array);\n+            }\n         };\n         return keySet;\n     }\n         if (values != null) return values;\n         values = new AbstractCollection()  {\n             public int size() {\n-                return size;\n+                return ReferenceMap.this.size();\n             }\n \n             public void clear() {\n \n             public Iterator iterator() {\n                 return new ValueIterator();\n+            }\n+\n+            public Object[] toArray() {\n+                return toArray(new Object[0]);\n+            }\n+\n+            public Object[] toArray(Object[] array) {\n+                Collection c = new ArrayList(size());\n+                for (Iterator it = iterator(); it.hasNext(); ) {\n+                    c.add(it.next());\n+                }\n+                return c.toArray(array);\n             }\n         };\n         return values;", "timestamp": 1072712154, "metainfo": ""}