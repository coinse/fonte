{"sha": "f9045aedf369299cc82048ff592ab510853ae2b3", "log": "Fix AbstractHeashedMap initialization to calculate correct threshold bug 35012, by Christian Siefkes  ", "commit": "\n--- a/src/java/org/apache/commons/collections/map/AbstractHashedMap.java\n+++ b/src/java/org/apache/commons/collections/map/AbstractHashedMap.java\n /*\n- *  Copyright 2003-2004 The Apache Software Foundation\n+ *  Copyright 2003-2005 The Apache Software Foundation\n  *\n  *  Licensed under the Apache License, Version 2.0 (the \"License\");\n  *  you may not use this file except in compliance with the License.\n  *\n  * @author java util HashMap\n  * @author Stephen Colebourne\n+ * @author Christian Siefkes\n  */\n public class AbstractHashedMap extends AbstractMap implements IterableMap {\n     \n             throw new IllegalArgumentException(\"Load factor must be greater than 0\");\n         }\n         this.loadFactor = loadFactor;\n+        initialCapacity = calculateNewCapacity(initialCapacity);\n         this.threshold = calculateThreshold(initialCapacity, loadFactor);\n-        initialCapacity = calculateNewCapacity(initialCapacity);\n         this.data = new HashEntry[initialCapacity];\n         init();\n     }\n--- a/src/test/org/apache/commons/collections/map/TestHashedMap.java\n+++ b/src/test/org/apache/commons/collections/map/TestHashedMap.java\n /*\n- *  Copyright 2001-2004 The Apache Software Foundation\n+ *  Copyright 2001-2005 The Apache Software Foundation\n  *\n  *  Licensed under the Apache License, Version 2.0 (the \"License\");\n  *  you may not use this file except in compliance with the License.\n         assertEquals(map.size(), cloned.size());\n         assertSame(map.get(\"1\"), cloned.get(\"1\"));\n     }\n-    \n+\n+    public void testInternalState() {\n+        HashedMap map = new HashedMap(42, 0.75f);\n+        assertEquals(0.75f, map.loadFactor, 0.1f);\n+        assertEquals(0, map.size);\n+        assertEquals(64, map.data.length);\n+        assertEquals(48, map.threshold);\n+        assertEquals(0, map.modCount);\n+    }\n+\n //    public void testCreate() throws Exception {\n //        resetEmpty();\n //        writeExternalFormToDisk((java.io.Serializable) map, \"D:/dev/collections/data/test/HashedMap.emptyCollection.version3.obj\");", "timestamp": 1116784136, "metainfo": ""}