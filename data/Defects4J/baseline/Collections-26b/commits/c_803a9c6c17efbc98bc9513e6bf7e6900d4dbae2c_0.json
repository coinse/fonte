{"sha": "803a9c6c17efbc98bc9513e6bf7e6900d4dbae2c", "log": "[COLLECTIONS-310] SetUniqueList#subList now returns an unmodifiable list.  ", "commit": "\n--- a/src/main/java/org/apache/commons/collections4/list/SetUniqueList.java\n+++ b/src/main/java/org/apache/commons/collections4/list/SetUniqueList.java\n import java.util.ListIterator;\n import java.util.Set;\n \n+import org.apache.commons.collections4.ListUtils;\n import org.apache.commons.collections4.set.UnmodifiableSet;\n import org.apache.commons.collections4.iterators.AbstractIteratorDecorator;\n import org.apache.commons.collections4.iterators.AbstractListIteratorDecorator;\n         return new SetListListIterator<E>(super.listIterator(index), set);\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     * <p>\n+     * NOTE: from 4.0, an unmodifiable list will be returned, as changes to the\n+     * subList can invalidate the parent list. \n+     */\n     @Override\n     public List<E> subList(final int fromIndex, final int toIndex) {\n         final List<E> superSubList = super.subList(fromIndex, toIndex);\n         final Set<E> subSet = createSetBasedOnList(set, superSubList);\n-        return new SetUniqueList<E>(superSubList, subSet);\n+        return ListUtils.unmodifiableList(new SetUniqueList<E>(superSubList, subSet));\n     }\n \n     /**\n--- a/src/test/java/org/apache/commons/collections4/list/SetUniqueListTest.java\n+++ b/src/test/java/org/apache/commons/collections4/list/SetUniqueListTest.java\n         return new SetUniqueList<E>(new ArrayList<E>(), new HashSet<E>());\n     }\n \n+    //-----------------------------------------------------------------------\n     @Override\n     public void testListIteratorSet() {\n         // override to block\n         assertEquals(4, decoratedList.size());\n     }\n \n+    public void testSubListIsUnmodifiable() {\n+        resetFull();\n+        List<E> subList = getCollection().subList(1, 3);\n+        try {\n+            subList.remove(0);\n+            fail(\"subList should be unmodifiable\");\n+        } catch (UnsupportedOperationException e) {\n+            // expected\n+        }\n+    }\n     @SuppressWarnings(\"unchecked\")\n     public void testCollections307() {\n         List<E> list = new ArrayList<E>();", "timestamp": 1367063821, "metainfo": ""}