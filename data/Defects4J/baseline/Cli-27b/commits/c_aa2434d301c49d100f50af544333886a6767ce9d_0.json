{"sha": "aa2434d301c49d100f50af544333886a6767ce9d", "log": "Applying Jorg Schaible's patch from CLI-177 to fix the OptionBuilder's not resetting when an Exception is thrown  ", "commit": "\n--- a/src/java/org/apache/commons/cli/OptionBuilder.java\n+++ b/src/java/org/apache/commons/cli/OptionBuilder.java\n     {\n         if (longopt == null)\n         {\n+            OptionBuilder.reset();\n             throw new IllegalArgumentException(\"must specify longopt\");\n         }\n \n      */\n     public static Option create(String opt) throws IllegalArgumentException\n     {\n-        // create the option\n-        Option option = new Option(opt, description);\n-\n-        // set the option properties\n-        option.setLongOpt(longopt);\n-        option.setRequired(required);\n-        option.setOptionalArg(optionalArg);\n-        option.setArgs(numberOfArgs);\n-        option.setType(type);\n-        option.setValueSeparator(valuesep);\n-        option.setArgName(argName);\n-\n-\n-        // reset the OptionBuilder properties\n-        OptionBuilder.reset();\n+        Option option = null;\n+        try {\n+            // create the option\n+            option = new Option(opt, description);\n+\n+            // set the option properties\n+            option.setLongOpt(longopt);\n+            option.setRequired(required);\n+            option.setOptionalArg(optionalArg);\n+            option.setArgs(numberOfArgs);\n+            option.setType(type);\n+            option.setValueSeparator(valuesep);\n+            option.setArgName(argName);\n+        } finally {\n+            // reset the OptionBuilder properties\n+            OptionBuilder.reset();\n+        }\n \n         // return the Option instance\n         return option;\n--- a/src/test/org/apache/commons/cli/OptionBuilderTest.java\n+++ b/src/test/org/apache/commons/cli/OptionBuilderTest.java\n         catch (IllegalArgumentException e)\n         {\n             // expected\n+            \n+            // implicitly reset the builder\n+            OptionBuilder.create( \"opt\" );\n         }\n     }\n+\n+    public void testBuilderIsResettedAlways() {\n+        try\n+        {\n+            OptionBuilder.withDescription(\"JUnit\").create('\"');\n+            fail(\"IllegalArgumentException expected\");\n+        }\n+        catch (IllegalArgumentException e)\n+        {\n+            // expected\n+        }\n+        assertNull(\"we inherited a description\", OptionBuilder.create('x').getDescription());\n+\n+        try\n+        {\n+            OptionBuilder.withDescription(\"JUnit\").create();\n+            fail(\"IllegalArgumentException expected\");\n+        }\n+        catch (IllegalArgumentException e)\n+        {\n+            // expected\n+        }\n+        assertNull(\"we inherited a description\", OptionBuilder.create('x').getDescription());\n+    }\n }", "timestamp": 1237188404, "metainfo": ""}