{"sha": "880a9f6c45dbcb14215bb35de21fdbbfaeb89c2e", "log": "Changing the current OutOfMemoryError to a RuntimeException per CLI-162. A new ticket for the RuntimeException is at CLI-174  ", "commit": "\n--- a/src/java/org/apache/commons/cli/HelpFormatter.java\n+++ b/src/java/org/apache/commons/cli/HelpFormatter.java\n \n         while (true)\n         {\n+            int lastPos = pos;\n             text = padding + text.substring(pos).trim();\n             pos = findWrapPos(text, width, 0);\n \n                 sb.append(text);\n \n                 return sb;\n+            } else\n+            if (pos == lastPos)\n+            {\n+                throw new RuntimeException(\"Text too long for line - throwing exception to avoid infinite loop [CLI-162]: \" + text);\n             }\n \n             sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n--- /dev/null\n+++ b/src/test/org/apache/commons/cli/bug/BugCLI162Test.java\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ * \n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+package org.apache.commons.cli.bug;\n+\n+import org.apache.commons.cli.CommandLine;\n+import org.apache.commons.cli.CommandLineParser;\n+import org.apache.commons.cli.HelpFormatter;\n+import org.apache.commons.cli.MissingArgumentException;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.Options;\n+import org.apache.commons.cli.PosixParser;\n+\n+import junit.framework.TestCase;\n+\n+public class BugCLI162Test extends TestCase {\n+\n+    private Options options;\n+\n+    public void setUp() {\n+        options = new Options();\n+        options.addOption(\"h\", \"help\", false, \"This is a looooong description\");\n+    }\n+\n+    public void testInfiniteLoop() {\n+        HelpFormatter formatter = new HelpFormatter();\n+        formatter.setWidth(20);\n+        try {\n+            formatter.printHelp(\"app\", options); // hang & crash\n+        } catch(RuntimeException re) {\n+            assertTrue(re.getMessage().startsWith(\"Text too long for line - throwing exception to avoid infinite loop [CLI-162]: \"));\n+        }\n+    }\n+\n+}", "timestamp": 1232184653, "metainfo": ""}