{"sha": "496e6a1e56c3af11c8071820c74565bc55f1850d", "log": "Preserve whitespace in children of <pre>", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Element.java\n+++ b/src/main/java/org/jsoup/nodes/Element.java\n                 TextNode textNode = (TextNode) child;\n                 String text = textNode.getWholeText();\n \n-                if (!tag.preserveWhitespace()) {\n+                if (!preserveWhitespace()) {\n                     text = TextNode.normaliseWhitespace(text);\n                     if (TextNode.lastCharIsWhitespace(accum))\n                         text = TextNode.stripLeadingWhitespace(text);\n                 element.text(accum);\n             }\n         }\n+    }\n+\n+    boolean preserveWhitespace() {\n+        return tag.preserveWhitespace() || parent() != null && parent().preserveWhitespace();\n     }\n \n     /**\n--- a/src/main/java/org/jsoup/nodes/TextNode.java\n+++ b/src/main/java/org/jsoup/nodes/TextNode.java\n \n     void outerHtml(StringBuilder accum) {\n         String html = StringEscapeUtils.escapeHtml(getWholeText());\n-        if (parent() instanceof Element && !((Element) parent()).tag().preserveWhitespace()) {\n+        if (parent() instanceof Element && !((Element) parent()).preserveWhitespace()) {\n             html = normaliseWhitespace(html);\n         }\n \n--- a/src/test/java/org/jsoup/nodes/ElementTest.java\n+++ b/src/test/java/org/jsoup/nodes/ElementTest.java\n         String h = \"<p>Hello \\n \\n there.</p> <div><pre>  What's \\n\\n  that?</pre>\";\n         Document doc = Jsoup.parse(h);\n         assertEquals(\"Hello there.   What's \\n\\n  that?\", doc.text());\n+    }\n+\n+    @Test public void testKeepsPreTextInCode() {\n+        String h = \"<pre><code>code\\n\\ncode</code></pre>\";\n+        Document doc = Jsoup.parse(h);\n+        assertEquals(\"code\\n\\ncode\", doc.text());\n+        assertEquals(\"<pre><code>code\\n\\ncode</code></pre>\", doc.body().html());\n     }\n \n     @Test public void testGetSiblings() {", "timestamp": 1309605107, "metainfo": ""}