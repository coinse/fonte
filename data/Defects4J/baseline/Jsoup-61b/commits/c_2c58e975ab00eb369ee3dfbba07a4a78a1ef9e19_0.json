{"sha": "2c58e975ab00eb369ee3dfbba07a4a78a1ef9e19", "log": "Remove attributes using iterator to avoid CMEs.  Fixes #759", "commit": "\n--- a/src/main/java/org/jsoup/nodes/Attributes.java\n+++ b/src/main/java/org/jsoup/nodes/Attributes.java\n         Validate.notEmpty(key);\n         if (attributes == null)\n             return;\n-        for (String attrKey : attributes.keySet()) {\n+        for (Iterator<String> it = attributes.keySet().iterator(); it.hasNext(); ) {\n+            String attrKey = it.next();\n             if (attrKey.equalsIgnoreCase(key))\n-                attributes.remove(attrKey);\n+                it.remove();\n         }\n     }\n \n--- a/src/test/java/org/jsoup/nodes/AttributesTest.java\n+++ b/src/test/java/org/jsoup/nodes/AttributesTest.java\n package org.jsoup.nodes;\n \n-import static org.junit.Assert.*;\n+import org.junit.Test;\n \n import java.util.Iterator;\n \n-import org.junit.Test;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * Tests for Attributes.\n  * @author Jonathan Hedley\n  */\n public class AttributesTest {\n-    \n-    @Test public void html() {\n+\n+    @Test\n+    public void html() {\n         Attributes a = new Attributes();\n         a.put(\"Tot\", \"a&p\");\n         a.put(\"Hello\", \"There\");\n         iterator.remove();\n         assertEquals(2, a.size());\n     }\n-    \n+\n     @Test\n     public void testIterator() {\n         Attributes a = new Attributes();\n         String[][] datas = {{\"Tot\", \"raul\"},\n-                {\"Hello\", \"pismuth\"},\n-                {\"data-name\", \"Jsoup\"}};\n+            {\"Hello\", \"pismuth\"},\n+            {\"data-name\", \"Jsoup\"}};\n         for (String[] atts : datas) {\n             a.put(atts[0], atts[1]);\n         }\n-        \n+\n         Iterator<Attribute> iterator = a.iterator();\n         assertTrue(iterator.hasNext());\n         int i = 0;\n         }\n         assertEquals(datas.length, i);\n     }\n-    \n+\n     @Test\n     public void testIteratorEmpty() {\n         Attributes a = new Attributes();\n-        \n \n         Iterator<Attribute> iterator = a.iterator();\n         assertFalse(iterator.hasNext());\n     }\n \n+    @Test\n+    public void removeCaseSensitive() {\n+        Attributes a = new Attributes();\n+        a.put(\"Tot\", \"a&p\");\n+        a.put(\"tot\", \"one\");\n+        a.put(\"Hello\", \"There\");\n+        a.put(\"hello\", \"There\");\n+        a.put(\"data-name\", \"Jsoup\");\n+\n+        assertEquals(5, a.size());\n+        a.remove(\"Tot\");\n+        a.remove(\"Hello\");\n+        assertEquals(3, a.size());\n+        assertTrue(a.hasKey(\"tot\"));\n+        assertFalse(a.hasKey(\"Tot\"));\n+    }\n+\n }\n--- a/src/test/java/org/jsoup/nodes/ElementTest.java\n+++ b/src/test/java/org/jsoup/nodes/ElementTest.java\n         assertEquals(1, els.size());\n         assertEquals(\"html > body > fb|comments\", els.get(0).cssSelector());\n     }\n+\n+    @Test\n+    public void testChainedRemoveAttributes() {\n+        String html = \"<a one two three four>Text</a>\";\n+        Document doc = Jsoup.parse(html);\n+        Element a = doc.select(\"a\").first();\n+        a\n+            .removeAttr(\"zero\")\n+            .removeAttr(\"one\")\n+            .removeAttr(\"two\")\n+            .removeAttr(\"three\")\n+            .removeAttr(\"four\")\n+            .removeAttr(\"five\");\n+        assertEquals(\"<a>Text</a>\", a.outerHtml());\n+    }\n }", "timestamp": 1477511904, "metainfo": ""}