{"sha": "a3d03f9a1ffbc4e9ba5bcbe991ca6ac2e5207f6b", "log": "Throw exception if trying to parse non-text content  Closes #17", "commit": "\n--- a/src/main/java/org/jsoup/DataUtil.java\n+++ b/src/main/java/org/jsoup/DataUtil.java\n         int res = conn.getResponseCode();\n         if (res != HttpURLConnection.HTTP_OK)\n             throw new IOException(res + \" error loading URL \" + url.toString());\n+        \n+        String contentType = conn.getContentType();\n+        if (contentType == null || !contentType.startsWith(\"text/\"))\n+            throw new IOException(String.format(\"Unhandled content type \\\"%s\\\" on URL %s. Must be text/*\", \n+                    contentType, url.toString()));\n+        \n         InputStream inStream = new BufferedInputStream(conn.getInputStream());\n         String charSet = \"UTF-8\"; // todo[must]: get from content-encoding, or http-equiv (two-pass?)\n \n--- a/src/test/java/org/jsoup/integration/UrlConnectTest.java\n+++ b/src/test/java/org/jsoup/integration/UrlConnectTest.java\n         Document doc = Jsoup.parse(new URL(url), 10*1000);\n         assertTrue(doc.title().contains(\"Google\"));\n     } \n+    \n+    // @Test // uncomment to enable\n+    public void exceptOnUnknownContentType() {\n+        String url = \"http://jsoup.org/rez/osi_logo.png\"; // not text/* but image/png, should throw\n+        boolean threw = false;\n+        try {\n+            Document doc = Jsoup.parse(new URL(url), 3000);\n+        } catch (IOException e) {\n+            threw = true;\n+        }\n+        assertTrue(threw);\n+    }\n \n     @Test public void noop() {}\n }", "timestamp": 1309605112, "metainfo": ""}