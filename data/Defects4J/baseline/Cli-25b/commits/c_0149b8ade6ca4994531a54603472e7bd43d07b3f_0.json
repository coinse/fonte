{"sha": "0149b8ade6ca4994531a54603472e7bd43d07b3f", "log": "Simplified the GnuParser by removing the unused code due to mutually exclusive conditions. Also added some comments to the code. Cobertura coverage is now 100%  ", "commit": "\n--- a/src/java/org/apache/commons/cli/GnuParser.java\n+++ b/src/java/org/apache/commons/cli/GnuParser.java\n      * flattening when a non option has been encountered\n      * @return a String array of the flattened arguments\n      */\n-    protected String[] flatten(Options options, String[] arguments, \n-                               boolean stopAtNonOption)\n+    protected String[] flatten(Options options, String[] arguments, boolean stopAtNonOption)\n     {\n         List tokens = new ArrayList();\n \n         boolean eatTheRest = false;\n-        Option currentOption = null;\n \n         for (int i = 0; i < arguments.length; i++)\n         {\n-            if (\"--\".equals(arguments[i]))\n+            String arg = arguments[i];\n+\n+            if (\"--\".equals(arg))\n             {\n                 eatTheRest = true;\n                 tokens.add(\"--\");\n             }\n-            else if (\"-\".equals(arguments[i]))\n+            else if (\"-\".equals(arg))\n             {\n                 tokens.add(\"-\");\n             }\n-            else if (arguments[i].startsWith(\"-\"))\n+            else if (arg.startsWith(\"-\"))\n             {\n-                Option option = options.getOption(arguments[i]);\n+                Option option = options.getOption(arg);\n+\n+                String head = arg.substring(0, 2); // \"--\" if --foo, \"-f\" if -foo\n+                String tail = arg.substring(2);    // \"foo\" if -foo, \"oo\" if -foo\n \n                 // this is not an Option\n                 if (option == null)\n                 {\n-                    // handle special properties Option\n-                    Option specialOption = \n-                            options.getOption(arguments[i].substring(0, 2));\n+                    // handle special properties Option (-Dproperty=value for example)\n+                    Option specialOption = options.getOption(head);\n \n                     if (specialOption != null)\n                     {\n-                        tokens.add(arguments[i].substring(0, 2));\n-                        tokens.add(arguments[i].substring(2));\n-                    }\n-                    else if (stopAtNonOption)\n-                    {\n-                        eatTheRest = true;\n-                        tokens.add(arguments[i]);\n+                        tokens.add(head); // -D\n+                        tokens.add(tail); // property=value\n                     }\n                     else\n                     {\n-                        tokens.add(arguments[i]);\n+                        eatTheRest = stopAtNonOption;\n+                        tokens.add(arg);\n                     }\n                 }\n                 else\n                 {\n-                    // WARNING: Findbugs reports major problems with the following code. \n-                    //          As option cannot be null, currentOption cannot and \n-                    //          much of the code below is never going to be run.\n-\n-                    currentOption = option;\n-\n-                    // special option\n-                    Option specialOption = \n-                            options.getOption(arguments[i].substring(0, 2));\n-\n-                    if ((specialOption != null) && (option == null))\n-                    {\n-                        tokens.add(arguments[i].substring(0, 2));\n-                        tokens.add(arguments[i].substring(2));\n-                    }\n-                    else if ((currentOption != null) && currentOption.hasArg())\n-                    {\n-                        if (currentOption.hasArg())\n-                        {\n-                            tokens.add(arguments[i]);\n-                            currentOption = null;\n-                        }\n-                        else if (currentOption.hasArgs())\n-                        {\n-                            tokens.add(arguments[i]);\n-                        }\n-                        else if (stopAtNonOption)\n-                        {\n-                            eatTheRest = true;\n-                            tokens.add(\"--\");\n-                            tokens.add(arguments[i]);\n-                        }\n-                        else\n-                        {\n-                            tokens.add(arguments[i]);\n-                        }\n-                    }\n-                    else if (currentOption != null)\n-                    {\n-                        tokens.add(arguments[i]);\n-                    }\n-                    else if (stopAtNonOption)\n-                    {\n-                        eatTheRest = true;\n-                        tokens.add(\"--\");\n-                        tokens.add(arguments[i]);\n-                    }\n-                    else\n-                    {\n-                        tokens.add(arguments[i]);\n-                    }\n+                    tokens.add(arg);\n                 }\n             }\n             else\n             {\n-                tokens.add(arguments[i]);\n+                tokens.add(arg);\n             }\n \n             if (eatTheRest)", "timestamp": 1212137340, "metainfo": ""}